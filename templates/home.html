<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://use.typekit.net/hlp6dyd.css">
	<style type="text/css">
		:root {
			--black-line-width: 6px;
		}
		.bely-display{
			font-family: bely-display,sans-serif;
			font-weight: 400;
			font-style: normal;
		}
		.bely-regular{
			font-family: bely,serif;
			font-weight: 400;
			font-style: normal;
		}
		.bely-italic {
			font-family: bely, serif;
			font-weight: 400;
			font-style: italic;
		}
		.bely-bold {
			font-family: bely,serif;
			font-weight: 700;
			font-style: normal;
		}
		.bely-bold-italic {
			font-family: bely,serif;
			font-weight: 700;
			font-style: italic;
		}
		body{
			font-family: bely,serif;
			font-weight: 400;
			font-style: normal;
			background: #F7EDDA;
			margin-top: 0px;
			margin-left: 0px;
			margin-right: 0px;
		}
		.left-margin{
			margin-left: 10%;
		}
		.blade{
			width: 100vw;
			height: 90vh;
			border-top: black;
			border-width: 0px;
			border-left-width: 0px;
			border-right-width: 0px;
			border-bottom-width: 1px;
			border-style: dashed;
			/* border-width: 0px; */
		}
		#taxonomy-title {
			padding-top: 8vh;
			height: 80vh;
			width: 80vw;
			background: 
			linear-gradient(black, black) right / var(--black-line-width) 35%;
			background-repeat: no-repeat;
			background-position-y: top;
		}
		#subtitle {
			height: 8vw;
			width: 25vh;
			margin-left: 1vw;
			font-size: 2vh;
		}
		.column-title {
			display: inline;
		}
		#learn-more {
			width: 8vw;
			margin-top: 10vh;
			display: block;
			margin-left: 1vw;
		}
		.centered {
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
		.parent {
			display: grid;
			grid-template-columns: 250px 1fr;
			grid-template-rows: 150px 1fr;
			width: 80vw;
		}
		.child {
			grid-area: 1 / 1 / 2 / 2;
			opacity: 0.8;
			height: 550vh;
			width: 20px;
			border-left: var(--black-line-width) solid black;
			margin: -18vw 5vw;
		}
		.spread-container{
			display: grid;
			grid-gap: 3%;
			grid-template-columns: auto auto auto;
			/* padding: 3%; */
			width: 80%;
			height: 90%;
			margin-top: 0px;
			margin-left: 12%;
		}
		.column-within-blade {
			text-align: center;
			padding: 2%;
			border-style: dashed;
			border-width: 1px;
			/* border-width: 0px; */
		}
		.a {
			grid-column: 1;
			grid-row: 1 / 3;
		}
		.b {
			grid-column: 2;
			grid-row: 1 / 3;
		}
		.c {
			grid-column: 3;
			grid-row: 1 / 3;
		}
		.desktop{
			display:block;
		}
		.mobile{
			display:none;
		}
		.play-button {
        	border-radius: 3px;
	  		/* background: black; */
			/* color: white; */
			color: black;
			background: none;
			border: none;
			/* border: 1px solid black; */
			padding: 5px;
			display: inline;
      	}
		button:focus{
			outline: 0;
		}
		svg {
			height: 100%;
			width: 100%;
		}
		.choreo-radial{
			width: 100%;
			height: 50%;
		}
		@media (max-width: 720px) and (min-width: 0px){
			.desktop{
				display:none;
			}
			.mobile{
				display:block;
			}
			#taxonomy-title {
				padding-top: .5vh;
				height: 95vh;
				width: 95vw;
				background: 
				linear-gradient(black, black) right / var(--black-line-width) 25%;
				background-repeat: no-repeat;
				background-position-y: top;
			}
			#subtitle{
				height: 8vw;
				width: 35vh;
				margin-left: 1vw;
				font-size: 2.5vh;
			}
			.child {
				grid-area: 1 / 1 / 2 / 2;
				opacity: 0.8;
				height: 350vh;
				width: 20px;
				border-left: var(--black-line-width) solid black;
				margin: -30vw 5vw;
			}
			#learn-more {
				width: 19vw;
				margin-top: 16vh;
				display: block;
				margin-left: 1vw;
			}
			.a {
				grid-row: 1;
				grid-column: 1 / 3;
			}
			.b {
				grid-row: 2;
				grid-column: 1 / 3;
			}
			.c {
				grid-row: 3;
				grid-column: 1 / 3;
			}
			.choreo-radial{
				width: 100%;
    			height: 50%;
			}
		}
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script><script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js" integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ==" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<audio id="songs-audio" src="{{ url_for('static', filename='audio/songs.mp3') }}"></audio>
	<audio id="artifact-audio" src="{{ url_for('static', filename='audio/artifact.mp3') }}"></audio>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
	<meta http-equiv="Pragma" content="no-cache"/>
	<meta http-equiv="Expires" content="0"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<div id='title' class='blade'>
		<img id='taxonomy-title' class='centered mobile' src="{{ url_for('static', filename='assets/taxonomy-of-dance-vertical.svg') }}" alt="taxonomy of dance">
		<img id='taxonomy-title' class='centered desktop' src="{{ url_for('static', filename='assets/taxonomy-title-AND-backdrop.svg') }}" alt="taxonomy of dance">
	</div>
	<div id='intro' class='blade'>
		<div class='parent'>
			<div class='child'>
				<div id='subtitle' class='bely-regular'>
					Using Labanotation, Taxonomy of Dance attempts to discover an underlying visual
					structure in western choreography across three periods of dance: <b>classical</b>, <b>contemporary</b>, and <b>postmodern</b>.
				</div>
				<div id='learn-more'>
					<img src="{{ url_for('static', filename='assets/learn-more-2.svg') }}">
				</div>
			</div>	
		</div>
		<div style='margin-top: -5vh;'>
			<p class='left-margin'>INTRODUCTION</p>
		</div>
	</div>
	<div id='methodology' class='blade'>
		<p class='left-margin'>METHODOLOGY</p>
	</div>
	<div id='classical-era-illustration-spread' class='blade'>
		<div class='spread-container'>
			FEATURE ONE HIGHLY ILLUSTRATED HERE
			<br>TALK ABOUT CLASSICAL DANCE IN GENERAL
		</div>
	</div>
	<div id='classical-era-vis-spread' class='blade'>
			<div class='spread-container'>
				<div id='coppelia-column' class="column-within-blade a">
					<!-- <button id="coppelia-play-button" class='play-button' onclick="document.getElementById('coppelia-audio').play()">&#9658;</button> -->
					<!-- TODO ADD SLIDER -->
					<!-- TODO ADD PAUSE -->
					<p class='column-title'>Coppélia 1870</p>
					<div id="coppelia-choreo-radial" class='choreo-radial'></div>
					<p class='column-paragraph'>Coppélia was originally choreographed by Arthur Saint-Léon for the St. Petersburg Imperial Ballet in 
						Russia, though it debuted in Paris in 1870. The ballet tells the comic story of an inventor who creates a doll so lifelike 
						that a village boy becomes infatuated with it. Coppélia is still frequently performed today, and is known for its fast 
						footwork as well as its historic use of mime and visual motif to tell a story.</p>
				</div>
				<div id='sleepingbeauty-column' class="column-within-blade b">
						<p class='column-title'>Sleeping Beauty 1890</p>
						<div id='sleepingbeauty-choreo-radial' class='choreo-radial'></div>
						<p class='column-paragraph'>Coppélia was originally choreographed by Arthur Saint-Léon for the St. Petersburg Imperial Ballet in 
							Russia, though it debuted in Paris in 1870. The ballet tells the comic story of an inventor who creates a doll so lifelike 
							that a village boy becomes infatuated with it. Coppélia is still frequently performed today, and is known for its fast 
							footwork as well as its historic use of mime and visual motif to tell a story.</p>
				</div>
				<div id='raymonda-column' class="column-within-blade c">
						<p class='column-title'>Raymonda 1898</p>
						<div id='raymonda-choreo-radial' class='choreo-radial'></div>
						<p class='column-paragraph'>Set in Hungary, Raymonda tells a typically romantic story for a classical ballet about royalty, magic, 
							vision and drama. It was choreographed by the renowned ballet master Marius Petipa of the St. Petersburg Imperial ballet and 
							debuted in 1898 at the Mariinsky Theater in St. Petersburg.  Raymonda is a foundational and strongly classic ballet, though 
							in its many productions since the late 19th century it has been greatly altered to suit modern taste and dancers. 
							</p>
				</div>
			</div>
	</div>
	<div id='postmodern-era-vis-spread' class='blade'>
			<div class='spread-container'>
				<div id='songs-column' class="column-within-blade b">
						<button id="songs-play-button" class='play-button' onclick="document.getElementById('songs-audio').play()">&#9658;</button>
						<p class='column-title'>Songs 1956</p>
						<div id='songs-choreo-radial' class='choreo-radial'></div>
						<p class='column-paragraph'>Mary Anthony<br>Set in Hungary, Raymonda tells a typically romantic story for a classical ballet about royalty, magic, 
								vision and drama. It was choreographed by the renowned ballet master Marius Petipa of the St. Petersburg Imperial ballet and 
								debuted in 1898 at the Mariinsky Theater in St. Petersburg.  Raymonda is a foundational and strongly classic ballet, though 
								in its many productions since the late 19th century it has been greatly altered to suit modern taste and dancers. </p>
				</div>
				<div id='moods-column' class="column-within-blade c">
						<p class='column-title'>Moods 1975</p>
						<div id='moods-choreo-radial' class='choreo-radial'></div>
						<p class='column-paragraph'>Anna Sokolow<br>Set in Hungary, Raymonda tells a typically romantic story for a classical ballet about royalty, magic, 
								vision and drama. It was choreographed by the renowned ballet master Marius Petipa of the St. Petersburg Imperial ballet and 
								debuted in 1898 at the Mariinsky Theater in St. Petersburg.  Raymonda is a foundational and strongly classic ballet, though 
								in its many productions since the late 19th century it has been greatly altered to suit modern taste and dancers. </p>
				</div>
				<div id='artifact-column' class="column-within-blade a">
						<span>
							<button id="artifact-play-button" class='play-button' onclick="document.getElementById('artifact-audio').play()">&#9658;</button>
							<p class='column-title'>Artifact 1984</p>
						</span>
						<div id="artifact-choreo-radial" class='choreo-radial'></div>
						<p class='column-paragraph'>William Forsythe<br>Set in Hungary, Raymonda tells a typically romantic story for a classical ballet about royalty, magic, 
								vision and drama. It was choreographed by the renowned ballet master Marius Petipa of the St. Petersburg Imperial ballet and 
								debuted in 1898 at the Mariinsky Theater in St. Petersburg.  Raymonda is a foundational and strongly classic ballet, though 
								in its many productions since the late 19th century it has been greatly altered to suit modern taste and dancers. </p>
				</div>
			</div>
	</div>
	<main>
	{% block main %}{% endblock %}
	</main>
	{% block script %}{% endblock %}
</body>
<script>
	$(function() { // This function runs as soon as page is loaded.
		console.log('On load function.')
	});
	const datapath = "static/data/"
	var stepCircleColor = "black"
	var stepCircleAlpha = 0.3
	var dataset; // global
	var numRadialSpokes = 8
	var randJitter = false
	// var lineRes = 0.005
	var lineRes = 0.05
	var curveAlpha = 0.55
	var radialLineWidth = 0.5
	var radiusMult = 150 //this has to do with the spikes
	var radiusOutwardMult = 1.8 //scaling to the page
	var curveType = 'basis'
	var stepLengthMultipier = 2
	function getRandomNumber(start, end) {
		return (Math.random() * (end-start) * 100)/100 + start;
	}
	function degrees_to_radians(degrees) {
		var pi = Math.PI;
		return degrees * (pi/180);
	}
	function radians_to_degrees(rad) {
		var pi = Math.PI;
		return rad * (180/pi);
	}
	const ballet = 'artifact'
	var measures_artifact = [{"index": 0, "ballet": "artifact", "ymin": 838.7689439141, "ymax": 1642.1331947345, "label": "measure_1", "step_length": 803.3642508204, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 1, "ballet": "artifact", "ymin": 33.6271162739, "ymax": 845.6937649165, "label": "measure_2", "step_length": 812.0666486426, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 39, "ballet": "artifact", "ymin": 8.1598672434, "ymax": 809.4435784606, "label": "measure_4", "step_length": 801.2837112172, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "4"}, {"index": 40, "ballet": "artifact", "ymin": 810.2366870525, "ymax": 1625.0795047733, "label": "measure_3", "step_length": 814.8428177208, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "3"}, {"index": 59, "ballet": "artifact", "ymin": 0.0, "ymax": 790.9936977924, "label": "measure_6", "step_length": 790.9936977924, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "6"}, {"index": 60, "ballet": "artifact", "ymin": 797.224138574, "ymax": 1604.0982529087, "label": "measure_5", "step_length": 806.8741143347, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "5"}, {"index": 79, "ballet": "artifact", "ymin": 826.0875400641, "ymax": 1638.8237179487, "label": "measure_7", "step_length": 812.7361778846, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "7"}, {"index": 80, "ballet": "artifact", "ymin": 4.3413461538, "ymax": 822.4697516026, "label": "measure_8", "step_length": 818.1284054487, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "8"}]
	
	$('#artifact-play-button').click(function(){
		$('#artifact-choreo-radial').empty()
		d3.json(datapath+'artifact'+".json", function(data) {
			dataset = data;
			var spokeArr = d3.range(10,359,359/numRadialSpokes)
			var spokeArrRad = spokeArr.map(x => degrees_to_radians(x))
			var bodyMovements = [
									"head",
									"right_hand",
									"right_arm",
									"right_body",
									"right_leg",
									"right_support",
									"left_support",
									"left_leg",
									"left_body",
									"left_arm",
									"left_hand"
								]

			///////////////////////////////////////////////////////////////////////////
			//////////////////// Set up and initiate svg containers ///////////////////
			///////////////////////////////////////////////////////////////////////////	
			var margin = {
				top: 0,
				right: 0,
				bottom: 0,
				left: 0
			};
			// var width = window.innerWidth - margin.left - margin.right - 20;
			// var height = window.innerHeight - margin.top - margin.bottom - 20;
			var width = 400 - margin.left - margin.right;
			var height = 400 - margin.top - margin.bottom;
			//SVG container
			var svg = d3.select("#artifact-choreo-radial")
				.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + (margin.left + width/2) + "," + (margin.top + height/2) + ")");

			//Container for the gradients
			var defs = svg.append("defs");

			//Filter for the outside glow
			var filter = defs.append("filter")
				.attr("id","glow");
			filter.append("feGaussianBlur")
				.attr("stdDeviation","1.5")
				.attr("result","coloredBlur");
			var feMerge = filter.append("feMerge");
			feMerge.append("feMergeNode")
				.attr("in","coloredBlur");
			feMerge.append("feMergeNode")
				.attr("in","SourceGraphic");

			///////////////////////////////////////////////////////////////////////////
			//////////////////////////// Helper functions /////////////////////////////
			///////////////////////////////////////////////////////////////////////////
			function staffNumToRad(staff_num){
				return parseInt(staff_num);
			}
			function bodyMovementToTheta(body_movement){
				switch(body_movement){
					case "right_arm":
						return spokeArr[2];
					case "left_arm":
						return spokeArr[9];
					case "right_leg":
						return spokeArr[4];
					case "left_leg":
						return spokeArr[7];
					case "right_support":
						return spokeArr[5];
					case "left_support":
						return spokeArr[6];
					case "right_hand":
						return spokeArr[1];
					case "left_hand":
						return spokeArr[10];
					case "right_body":
						return spokeArr[3];
					case "left_body":
						return spokeArr[8];
					case "head":
						return spokeArr[0];
				}
			}
			function bodyDirectionToTheta(body_movement, direction){
				switch(direction){
					case "place":
						return -1;
					case "forward":
						return spokeArr[0]
					case "forward_diagonal":
						if (body_movement.includes("right")){
							return spokeArr[1]
						} else {
							return spokeArr[7]
						}
					case "right":
						return spokeArr[2];
					case "backward_diagonal":
						if (body_movement.includes("right")){
							return spokeArr[3]
						} else {
							return spokeArr[5]
						}
					case "backward":
						return spokeArr[4];
					case "left":
						return spokeArr[6];
				}
			}

			///////////////////////////////////////////////////////////////////////////
			//////////////////////////// Create scales ////////////////////////////////
			///////////////////////////////////////////////////////////////////////////
			// Playback time
			// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
			dataset.forEach(function(d) {
				measNum = +d.measure_num
				meas_ymin = measures_artifact.filter(x=>+x.measure_num==measNum)[0].ymax
				step_ymin = +d.ymax
				d.playbackTime = measNum + (step_ymin)/100
			});
			min = Math.min.apply(Math, dataset.map(x=>x.playbackTime))
			max = Math.max.apply(Math, dataset.map(x=>x.playbackTime))
			dataset.forEach(function(d) {
				// d.playbackTime = ((d.playbackTime-min)/(max-min))*total_len_sec
				d.playbackTime = d.playbackTime*4
			});
			// Normalize playback time from 0 to 1, so I can scale by total ballet lenth
			console.log('NORMALIZED', dataset)
			// body_movement corresponds to THETA, pin to a spoke at a certain theta val
			dataset.forEach(function(d) {
				d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
				d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
			});


			//Set the minimum inner radius and max outer radius of the chart
			var	outerRadius = Math.min(width, height, 250)/2,
				innerRadius = outerRadius * 0.4;

			///////////////////////////////////////////////////////////////////////////
			//////////////////////////// Radial line //////////////////////////////////
			///////////////////////////////////////////////////////////////////////////
			var dataArr = []
			var data = []
			var dataStyling = []
			var dataset = dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
			console.log('sorted', dataset)
			
			radArr = dataset.map(x=>(x.playbackTime)*radiusOutwardMult)
			// Nonzero radii
			radArr = radArr.filter(x=>x>0)
			
			function findClosest(num, spoke){
				if (Math.abs(num[0] - spoke) <= 0.03) return 1
			}
			for (ii = 0; ii < radArr.length; ii++) {
				if(dataset[ii].body_movement!=null){
					data = []
					for (i = 0; i <= 2+lineRes; i=i+lineRes) {
						if (randJitter) {data.push([Math.PI * i, radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
						if (!randJitter) {data.push([Math.PI * i, radArr[ii] ])}
					}
					dataStyling.push({'body_movement' : dataset[ii].body_movement,
										'step_length' : dataset[ii].step_length * stepLengthMultipier,
										'playback_time': dataset[ii].playbackTime})
					arr = spokeArrRad
					num = degrees_to_radians(dataset[ii].theta)
					var closestSpoke = arr.reduce(function(prev, curr) {
						return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
					});
					// find theta closest to chosen spokeArr
					if (dataset[ii].direction_movement!='place'){
						index = data.findIndex(x => findClosest(x, closestSpoke));
						data[index] = [data[index][0], radArr[ii]+dataset[ii].step_length * radiusMult]
						dataArr.push({data})
					}
				// ignore PLACES

				}
			}
			if (curveType == 'catmull'){var lineRadial = d3.lineRadial().curve(d3.curveCatmullRom.alpha(curveAlpha));}
			if (curveType == 'basis'){var lineRadial = d3.lineRadial().curve(d3.curveBasis);}
			
			var radialWrapper = svg.append("g")
			.attr("transform", "translate(" + 0 + "," + 0 + ")");
		// $('#artifact-play-button').click(function(){
			// $('.radial')
			$('#artifact-play-button').addClass('enabled')
			if ($('#artifact-play-button').hasClass('enabled')){
				$('#artifact-play-button').html("❚❚")
			}else{
				$('#artifact-play-button').html("&#9658;")
			}
			for (i = 0; i < dataArr.length; i++) {
				className = "radial_"+dataStyling[i].body_movement
				curRadialLineWidth = dataStyling[i].step_length
				curPlaybackTime = dataStyling[i].playback_time 
				console.log(curPlaybackTime)
				radialWrapper
					.append("path")
					.attr("d", lineRadial(dataArr[i].data))
					.attr("class", className)
					.attr("opacity", 0)
					.style("filter", "url(#glow)")
					.attr("transform", "rotate(" + ( -55 ) + ")")
					.attr("fill", "none")
					.attr("stroke-width", curRadialLineWidth/2)
					.attr("stroke", "black")
					.transition()
					.delay( (curPlaybackTime-14)*1000)
					.attr("opacity", 0.7)
			}
		})
	});

///////////////////////////////////////////////////////////////////////////
//////////////////////////// Songs, Anthony ///////////////////////////////
///////////////////////////////////////////////////////////////////////////
		$('#songs-play-button').click(function(){
			$('#songs-choreo-radial').empty()
			d3.json(datapath+'songs'+".json", function(data) {
				dataset = data;
				var spokeArr = d3.range(10,359,359/numRadialSpokes)
				var spokeArrRad = spokeArr.map(x => degrees_to_radians(x))
				var bodyMovements = [
										"head",
										"right_hand",
										"right_arm",
										"right_body",
										"right_leg",
										"right_support",
										"left_support",
										"left_leg",
										"left_body",
										"left_arm",
										"left_hand"
									]

				///////////////////////////////////////////////////////////////////////////
				//////////////////// Set up and initiate svg containers ///////////////////
				///////////////////////////////////////////////////////////////////////////	
				var margin = {
					top: 0,
					right: 0,
					bottom: 0,
					left: 0
				};
				// var width = window.innerWidth - margin.left - margin.right - 20;
				// var height = window.innerHeight - margin.top - margin.bottom - 20;
				var width = 400 - margin.left - margin.right;
				var height = 400 - margin.top - margin.bottom;
				//SVG container
				var songs_svg = d3.select("#songs-choreo-radial")
					.append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
					.append("g")
					.attr("transform", "translate(" + (margin.left + width/2) + "," + (margin.top + height/2) + ")");

				//Container for the gradients
				var defs = songs_svg.append("defs");

				//Filter for the outside glow
				var filter = defs.append("filter")
					.attr("id","glow");
				filter.append("feGaussianBlur")
					.attr("stdDeviation","1.5")
					.attr("result","coloredBlur");
				var feMerge = filter.append("feMerge");
				feMerge.append("feMergeNode")
					.attr("in","coloredBlur");
				feMerge.append("feMergeNode")
					.attr("in","SourceGraphic");

				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Helper functions /////////////////////////////
				///////////////////////////////////////////////////////////////////////////
				function staffNumToRad(staff_num){
					return parseInt(staff_num);
				}
				function bodyMovementToTheta(body_movement){
					switch(body_movement){
						case "right_arm":
							return spokeArr[2];
						case "left_arm":
							return spokeArr[9];
						case "right_leg":
							return spokeArr[4];
						case "left_leg":
							return spokeArr[7];
						case "right_support":
							return spokeArr[5];
						case "left_support":
							return spokeArr[6];
						case "right_hand":
							return spokeArr[1];
						case "left_hand":
							return spokeArr[10];
						case "right_body":
							return spokeArr[3];
						case "left_body":
							return spokeArr[8];
						case "head":
							return spokeArr[0];
					}
				}
				function bodyDirectionToTheta(body_movement, direction){
					switch(direction){
						case "place":
							return -1;
						case "forward":
							return spokeArr[0]
						case "forward_diagonal":
							if (body_movement.includes("right")){
								return spokeArr[1]
							} else {
								return spokeArr[7]
							}
						case "right":
							return spokeArr[2];
						case "backward_diagonal":
							if (body_movement.includes("right")){
								return spokeArr[3]
							} else {
								return spokeArr[5]
							}
						case "backward":
							return spokeArr[4];
						case "left":
							return spokeArr[6];
					}
				}

				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Create scales ////////////////////////////////
				///////////////////////////////////////////////////////////////////////////
				var radiusOutwardMult_Songs = 1;
				var measures = [{"index": 0, "ballet": "songs", "ymin": 34.0487954952, "ymax": 638.5292828908, "label": "measure_3", "step_length": 604.4804873956, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "3"}, {"index": 1, "ballet": "songs", "ymin": 1236.1019820257, "ymax": 1351.0379064737, "label": "measure_1", "step_length": 114.9359244481, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 2, "ballet": "songs", "ymin": 639.4572922882, "ymax": 1242.8006414081, "label": "measure_2", "step_length": 603.3433491199, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 21, "ballet": "songs", "ymin": 643.6398418854, "ymax": 1251.5226170943, "label": "measure_4", "step_length": 607.8827752088, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "4"}, {"index": 22, "ballet": "songs", "ymin": 23.0015848747, "ymax": 642.5905802506, "label": "measure_5", "step_length": 619.5889953759, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "5"}, {"index": 61, "ballet": "songs", "ymin": 641.0, "ymax": 1272.6895323687, "label": "measure_6", "step_length": 631.6895323687, "img_num": "2", "img_staff_num": "1", "staff_num": 3, "measure_num": "6"}, {"index": 62, "ballet": "songs", "ymin": 30.8058155579, "ymax": 639.2968656772, "label": "measure_7", "step_length": 608.4910501193, "img_num": "2", "img_staff_num": "1", "staff_num": 3, "measure_num": "7"}, {"index": 111, "ballet": "songs", "ymin": 45.1976051072, "ymax": 665.3705558691, "label": "measure_9", "step_length": 620.1729507619, "img_num": "2", "img_staff_num": "2", "staff_num": 4, "measure_num": "9"}, {"index": 112, "ballet": "songs", "ymin": 662.5951079289, "ymax": 1272.1298321106, "label": "measure_8", "step_length": 609.5347241817, "img_num": "2", "img_staff_num": "2", "staff_num": 4, "measure_num": "8"}, {"index": 151, "ballet": "songs", "ymin": 634.8149689616, "ymax": 1254.9913409989, "label": "measure_10", "step_length": 620.1763720372, "img_num": "3", "img_staff_num": "1", "staff_num": 5, "measure_num": "10"}, {"index": 152, "ballet": "songs", "ymin": 20.0345125564, "ymax": 635.5286223194, "label": "measure_11", "step_length": 615.494109763, "img_num": "3", "img_staff_num": "1", "staff_num": 5, "measure_num": "11"}, {"index": 189, "ballet": "songs", "ymin": 440.0932562077, "ymax": 833.080549873, "label": "measure_13", "step_length": 392.9872936653, "img_num": "3", "img_staff_num": "2", "staff_num": 6, "measure_num": "13"}, {"index": 190, "ballet": "songs", "ymin": 14.2452207957, "ymax": 436.316027088, "label": "measure_14", "step_length": 422.0708062923, "img_num": "3", "img_staff_num": "2", "staff_num": 6, "measure_num": "14"}, {"index": 191, "ballet": "songs", "ymin": 832.3723194131, "ymax": 1246.4395457111, "label": "measure_12", "step_length": 414.067226298, "img_num": "3", "img_staff_num": "2", "staff_num": 6, "measure_num": "12"}, {"index": 254, "ballet": "songs", "ymin": 661.3766489137, "ymax": 958.0045146727, "label": "measure_16", "step_length": 296.627865759, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "16"}, {"index": 255, "ballet": "songs", "ymin": 960.9796839729, "ymax": 1268.9097065463, "label": "measure_15", "step_length": 307.9300225734, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "15"}, {"index": 256, "ballet": "songs", "ymin": 358.9843926354, "ymax": 658.5002645316, "label": "measure_17", "step_length": 299.5158718962, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "17"}, {"index": 257, "ballet": "songs", "ymin": 45.7722823787, "ymax": 353.7313593397, "label": "measure_18", "step_length": 307.9590769611, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "18"}]

				// Playback time
				// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
				dataset.forEach(function(d) {
					measNum = +d.measure_num
					meas_ymin = measures.filter(x=>+x.measure_num==measNum)[0].ymax
					step_ymin = +d.ymax
					d.playbackTime = measNum + (step_ymin)/50
					
				});
				min = Math.min.apply(Math, dataset.map(x=>x.playbackTime))
				max = Math.max.apply(Math, dataset.map(x=>x.playbackTime))
				dataset.forEach(function(d) {
					// d.playbackTime = ((d.playbackTime-min)/(max-min))*total_len_sec
					d.playbackTime = d.playbackTime*4
				});
				// Normalize playback time from 0 to 1, so I can scale by total ballet lenth
				console.log('NORMALIZED', dataset)
				// body_movement corresponds to THETA, pin to a spoke at a certain theta val
				dataset.forEach(function(d) {
					d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
					d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
				});


				//Set the minimum inner radius and max outer radius of the chart
				var	outerRadius = Math.min(width, height, 250)/2,
					innerRadius = outerRadius * 0.4;

				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Radial line //////////////////////////////////
				///////////////////////////////////////////////////////////////////////////
				var dataArr = []
				var data = []
				var dataStyling = []
				radArr = []
				var dataset = dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
				console.log('sorted', dataset)
				
				radArr = dataset.map(x=>(x.playbackTime)*radiusOutwardMult_Songs)
				// Nonzero radii
				radArr = radArr.filter(x=>x>0)
				
				function findClosest(num, spoke){
					if (Math.abs(num[0] - spoke) <= 0.03) return 1
				}
				for (ii = 0; ii < radArr.length; ii++) {
					if(dataset[ii].body_movement!=null){
						data = []
						for (i = 0; i <= 2+lineRes; i=i+lineRes) {
						if (randJitter) {data.push([Math.PI * i, radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
						if (!randJitter) {data.push([Math.PI * i, radArr[ii] ])}
						}
						dataStyling.push({'body_movement' : dataset[ii].body_movement,
										'step_length' : dataset[ii].step_length * stepLengthMultipier,
										'playback_time': dataset[ii].playbackTime})
						arr = spokeArrRad
						num = degrees_to_radians(dataset[ii].theta)
						var closestSpoke = arr.reduce(function(prev, curr) {
							return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
						});
						
						// find theta closest to chosen spokeArr
						if (dataset[ii].direction_movement!='place'){
							console.log(dataset[ii].direction_movement)
							index = data.findIndex(x => findClosest(x, closestSpoke));
							data[index] = [data[index][0], radArr[ii]+dataset[ii].step_length * radiusMult]
							dataArr.push({data})
						}
						// if (dataset[ii].direction_movement=='place'){
						// 	index = data.findIndex(x => findClosest(x, closestSpoke));
						// 	data[index] = [data[index][0], radArr[ii]]
						// 	dataArr.push({data})
						// }

					}
				}
				if (curveType == 'catmull'){var lineRadial = d3.lineRadial().curve(d3.curveCatmullRom.alpha(curveAlpha));}
				if (curveType == 'basis'){var lineRadial = d3.lineRadial().curve(d3.curveBasis);}
				
				var radialWrapperSongs = songs_svg.append("g")
					.attr("transform", "translate(" + 0 + "," + 0 + ")");

				$('#songs-play-button').addClass('enabled')
				if ($('#songs-play-button').hasClass('enabled')){
					$('#songs-play-button').html("❚❚")
				}else{
					$('#songs-play-button').html("&#9658;")
				}
				for (i = 0; i < dataArr.length; i++) {
					className = "radial_"+dataStyling[i].body_movement
					curRadialLineWidth = dataStyling[i].step_length
					curPlaybackTime = dataStyling[i].playback_time
					console.log(curPlaybackTime)
					radialWrapperSongs
						.append("path")
						.attr("d", lineRadial(dataArr[i].data))
						.attr("class", className)
						.attr("opacity", 0)
						.attr("transform", "rotate(" + ( -55 ) + ")")
						.attr("fill", "none")
						.attr("stroke-width", curRadialLineWidth/2)
						.attr("stroke", "black")
						.style("filter", "url(#glow)")
						.transition()
						.delay(((curPlaybackTime-18))*800)
						.attr("opacity", 0.7)
				}
			})
	});
</script>
</html>
