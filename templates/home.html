<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://use.typekit.net/hlp6dyd.css">
	<style type="text/css">
		:root {
			--black-line-width: 6px;
			--general-margin: 8%;
		}
		.bely-display{
			font-family: bely-display,sans-serif;
			font-weight: 400;
			font-style: normal;
		}
		.bely-regular{
			font-family: bely,serif;
			font-weight: 400;
			font-style: normal;
		}
		.bely-italic {
			font-family: bely, serif;
			font-weight: 400;
			font-style: italic;
		}
		.bely-bold {
			font-family: bely,serif;
			font-weight: 700;
			font-style: normal;
		}
		.bely-bold-italic {
			font-family: bely,serif;
			font-weight: 700;
			font-style: italic;
		}
		@font-face {
		  font-family: 'League';
		  /* src:  url('./static/fonts/leaguespartan-bold.woff2') format('woff2'), */
		  src:  url('./static/fonts/leaguespartan-bold.woff') format('woff');
		}
		body{
			font-family: bely,serif;
			font-weight: 400;
			font-style: normal;
			background: #F7EDDA;
			background: #f4eee1;
			margin-top: 0px;
			margin-left: 0px;
			margin-right: 0px;
		}
		.left-margin{
			margin-left: 12%;
		}
		.blade{
			width: 100vw;
			height: 90vh;
			margin-bottom: 10vh;
			border-top: black;
			border-width: 0px;
			border-left-width: 0px;
			border-right-width: 0px;
			border-bottom-width: 1px;
			border-style: dashed;
			border-width: 0px;
		}
		#title {
			min-height: 0px !important;
			height: 80vh;
			/* height: 80%; */
		}
		#taxonomy-title {
			padding-top: 8vh;
			height: 80vh;
			width: 80vw;
			/* padding-top: 5%;
			width: 55%; */
			background: 
			linear-gradient(black, black) right / var(--black-line-width) 35%;
			background-repeat: no-repeat;
			background-position-y: top;
		}
		#subtitle {
			height: 8vw;
			width: 25vh;
			margin-left: 1vw;
			font-size: 2vh;
		}
		.column-title {
			font-size: 2.1vh;
			display: inline;
		}
		#learn-more {
			width: 8vw;
			margin-top: 10vh;
			display: block;
			margin-left: 1vw;
		}
		.para {
			font-size: 1.7vh;
			line-height: 2.2vh;
		}
		.timeline-circle {
			height: 3.5vw;
			width: 3.5vw;
			margin-left: -2vw;
		}
		#HOW {
			margin-top: 25vh;
		}
		#year_1944 {
			margin-top: 100vh;
		}
		#year_1956 {
			margin-top: 20vh;
		}
		#year_1984 {
			margin-top: 20vh;
		}
		#year_1944_solid {
			margin-top: 32vh;
		}
		#year_1956_solid {
			margin-top: 20vh;
		}
		#year_1984_solid {
			margin-top: 20vh;
		}
		#year_1944_solid_2 {
			margin-top: 65vh;
		}
		#year_1956_solid_2 {
			margin-top: 15vh;
		}
		#year_1984_solid_2 {
			margin-top: 17vh;
		}
		#intro {
			height: 105vh;
		}
		#intro-text{
			width: 36vw;
			font-size: 2.3vh !important;
			line-height: 2.8vh !important;
		}
		#choreo-radial-explainer {
			width: 100%;
			margin-top: var(--general-margin);
		}
		#choreo-radial-explainer-body {
			width: 80%;
			margin-top: 40%;
		}
		.left-column {
			width: 40%;
			float: left;
		}
		.right-column {
			width: 50%;
			float: right;
		}
		.centered {
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
		.parent {
			display: grid;
			grid-template-columns: 250px 1fr;
			grid-template-rows: 150px 1fr;
			width: 80vw;
		}
		.child {
			grid-area: 1 / 1 / 2 / 2;
			/* opacity: 0.9; */
			height: 480vh;
			width: 20px;
			border-left: var(--black-line-width) solid black;
			margin-top: -18vw;
			margin-left: 5vw;
			/* margin: -18vw 5vw; */
		}
		.spread-container{
			display: grid;
			grid-gap: 3%;
			grid-template-columns: auto auto auto;
			/* padding: 3%; */
			width: 80%;
			height: 90%;
			margin-top: 0px;
			margin-left: 12%;
		}
		.two-column-spread {
			width: 80%;
			height: 90%;
			margin-top: 0px;
			margin-left: 12%;
		}
		.feature-spread-container {
			width: 80%;
			height: 90%;
			margin-top: 0px;
			margin-left: 12%;
		}
		.column-within-blade {
			text-align: center;
			padding: 2%;
			border-style: dashed;
			border-width: 1px;
			border-width: 0px;
		}
		.a {
			grid-column: 1;
			grid-row: 1 / 3;
		}
		.b {
			grid-column: 2;
			grid-row: 1 / 3;
		}
		.c {
			grid-column: 3;
			grid-row: 1 / 3;
		}
		.desktop{
			display: block !important;
		}
		.mobile{
			display: none !important;
		}
		.play-button {
        	border-radius: 3px;
	  		/* background: black; */
			/* color: white; */
			color: black;
			/* background: white; */
			/* border: none; */
			border: 2px solid black;
			padding: 2px;
			display: inline;
			margin-right: 5px;
			background: black;
			color: white;
			font-size: 9px;
			vertical-align: middle;
      	}
		.play-button:hover {
			background: white;
			color: black;
		}
		button:focus{
			outline: 0;
		}
		svg {
			height: 100%;
			width: 100%;
		}
		.choreo-radial{
			width: 100%;
			height: 50%;
		}
		.feature-title {
			font-family: 'League', Fallback, sans-serif;
			font-size: 3.5vh !important;
			margin-top: 0px;
			margin-bottom: 0.8vh;
		}
		.era-title {
			font-family: 'League', Fallback, sans-serif;
			font-size: 2.5vh !important;
			margin-top: 0px;
		}
		.feature-para {
			width: 42vw;
			font-size: 2vh !important;
			line-height: 2.5vh !important;
		}
		#artifact-feature-choreo-radials {
			display: block;
			width: 65vw;
			margin-top: var(--general-margin);
		}
		.grid-radials {
			margin-top: var(--general-margin);
			height:	80%;
		}
		.button-enabled {
			color: lightgray;
			display: none;
		}
		.slider {
			-webkit-appearance: none;  /* Override default CSS styles */
			appearance: none;
			height: 2px; /* Specified height */
			background: #000; 
			outline: none; /* Remove outline */
			opacity: 0.8; /* Set transparency (for mouse-over effects on hover) */
			-webkit-transition: .2s; /* 0.2 seconds transition on hover */
			transition: opacity .2s;
			margin-top: 20px;
			margin-bottom: 20px;
		}
		.slider::-webkit-slider-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 0.5px;
			height: 20px;
			border: black;
			border-style: solid;
			border-width: 1px;
		}

		.slider::-moz-range-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 0.5px;
			height: 20px;
			border: black;
			border-style: solid;
			border-width: 1px;
		}
		input[type=range]{
			pointer-events: none;
		}
		input[type=range]::-webkit-slider-thumb{/*Webkit Browsers like Chome and Safari*/
			pointer-events: none;
		}
		input[type=range]::-moz-range-thumb{/*Firefox*/
			pointer-events: none;
		}
		input[type=range]::-ms-thumb{/*Internet Explorer*/
			pointer-events: none;
		}
		/************ CAUTION: MOBILE STYLES ***************
		****************************************************
		***************************************************/
		@media (max-width: 1024px) and (min-width: 0px){
			.desktop{
				display: none !important;
			}
			.mobile{
				display: block !important;
			}
			.left-margin {
				margin-left: 15vw !important;
			}
			.blade {
				height: 82vh !important;
				margin-top: 20vh !important;
				margin-bottom: 20vh !important;
			}
			.slider {
				height: 2px; /* Specified height */
			}
			.slider::-webkit-slider-thumb {
				border-width: 1px;
				height: 10px;
			}

			.slider::-moz-range-thumb {
				border-width: 1px;
				height: 10px;
			}
			#modern-era-vis-spread {
				min-height: 200vh;
				margin-top: 40vh !important;
			}
			#title {
				margin-top: -25% !important;
			}
			#taxonomy-title {
				height: 95% !important;
				margin-bottom: 10% !important;
				margin-top: -10% !important;
				background: 
				linear-gradient(black, black) right / var(--black-line-width) 25%;
				background-repeat: no-repeat;
				background-position-y: top;
			}
			#subtitle{
				height: 8vw;
				width: 35vh;
				margin-left: 1vw;
				font-size: 2.5vh;
			}
			.child {
				grid-area: 1 / 1 / 2 / 2;
				/* opacity: 0.8; */
				height: 700vh;
				width: 20px;
				border-left: 5px solid black;
				margin: -30vh 5vw;
			}
			#learn-more {
				width: 19vw;
				margin-top: 16vh;
				display: block;
				margin-left: 1vw;
			}
			.timeline-circle {
				height: 8vw;
				width: 8vw;
				margin-left: -4.5vw !important;
			}
			#HOW {
				margin-top: 30vh;
			}
			#year_1944 {
				margin-top: 170vh;
			}
			#year_1956 {
				margin-top: 20vh;
			}
			#year_1984 {
				margin-top: 20vh;
			}

			#year_1944_solid {
				margin-top: 110vh;
			}
			#year_1956_solid {
				margin-top: 65vh;
			}
			#year_1984_solid {
				margin-top: 75vh;
			}
			.a {
				grid-row: 1;
				grid-column: 1 / 3;
			}
			.b {
				grid-row: 2;
				grid-column: 1 / 3;
			}
			.c {
				grid-row: 3;
				grid-column: 1 / 3;
			}
			.left-column {
				float: none;
				width: 80vw;
			}
			.right-column {
				float: none;
				width: 80vw;
			}
			.choreo-radial{
				width: 100%;
    			height: 50%;
			}
			#choreo-radial-explainer-body {
				width: 100%;
				margin-top: 10vh;
			}
			#intro-text{
				width: 80vw;
			}
			#intro {
				min-height: 170vh !important;
			}
			.feature-para {
				width: 95%;
			}
			.two-column-spread {
				margin-top: 10vh !important;
			}
			.feature-spread-container {
				height: 100vh;
				width: 70% !important;
				margin-top: 10vh !important;
				margin-left: 18vw !important;
			}
			#artifact-feature-choreo-radials {
				height: 45vh;
				margin-top: 5vh;
				float: left;
				width: 20vh;
			}
			#modern-era-vis-overview-spread {
				margin-top: 70vh !important;
				/* margin-top:140vw !important; */
			}
			.grid-radials {
				width: 90%;
				height: auto;
				margin-top: 10%;
			}
		}
		/************ CAUTION: MOBILE STYLES ***************
		****************************************************
		***************************************************/
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js" integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ==" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<audio id="songs-audio" src="{{ url_for('static', filename='audio/songs.mp3') }}"></audio>
	<audio id="artifact-audio" src="{{ url_for('static', filename='audio/artifact.mp3') }}"></audio>
	<audio id="endolor-audio" src="{{ url_for('static', filename='audio/endolor.mp3') }}"></audio>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
	<meta http-equiv="Pragma" content="no-cache"/>
	<meta http-equiv="Expires" content="0"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<div id='title' class='blade'>
		<img id='taxonomy-title' class='centered mobile' src="{{ url_for('static', filename='assets/taxonomy-of-dance-vertical.svg') }}" alt="taxonomy of dance">
		<img id='taxonomy-title' class='centered desktop' src="{{ url_for('static', filename='assets/taxonomy-title-AND-backdrop.svg') }}" alt="taxonomy of dance">
	</div>
	<div id='intro' class='blade'>
		<div class='parent'>
			<div class='child'>
				<div id='subtitle' class='bely-regular'>
					Using Labanotation, Taxonomy of Dance attempts to discover an underlying visual
					structure in western choreography across two periods of dance: <b>classical</b> and <b>contemporary</b>.
				</div>
				<div id='learn-more'>
					<img src="{{ url_for('static', filename='assets/learn-more-2.svg') }}">
				</div>
				<img id="HOW" class='timeline-circle' src="{{ url_for('static', filename='assets/HOW.svg') }}">
				<img id="year_1944" class='timeline-circle' src="{{ url_for('static', filename='assets/year_1944_expand.svg') }}">
				<img id="year_1956" class='timeline-circle' src="{{ url_for('static', filename='assets/year_1956_expand.svg') }}">
				<img id="year_1984" class='timeline-circle' src="{{ url_for('static', filename='assets/year_1984_solid_expand.svg') }}">
				<img id="year_1944_solid" class='timeline-circle' src="{{ url_for('static', filename='assets/year_1944_solid_expand.svg') }}">
				<img id="year_1956_solid" class='timeline-circle' src="{{ url_for('static', filename='assets/year_1956_solid_expand.svg') }}">
				<img id="year_1984_solid" class='timeline-circle' src="{{ url_for('static', filename='assets/year_1984_solid_expand.svg') }}">
				<img id="year_1944_solid_2" class='timeline-circle' src="{{ url_for('static', filename='assets/year_1944_solid_expand.svg') }}">
				<img id="year_1956_solid_2" class='timeline-circle' src="{{ url_for('static', filename='assets/year_1956_solid_expand.svg') }}">
				<img id="year_1984_solid_2" class='timeline-circle' src="{{ url_for('static', filename='assets/year_1984_solid_expand.svg') }}">
			</div>	
		</div>
		<div >
			<div class='two-column-spread'>
				<div class='left-column'>
					<p id='intro-text' class='para'>
						Using a method of dance notation called <b>Labanotation</b>, it is possible to translate dance choreography into 
						machine-parseable data by labeling x,y bounding boxes around each movement in a dance score. 
						<br><br>The visualization paradigm below was developed to show <b>when</b>, in which <b>direction</b>, and 
						<b>how long</b> a body part moves during a dance.
					</p>
					<img id='choreo-radial-explainer' src="{{ url_for('static', filename='assets/explainer-choreo-radial-black.svg') }}" alt="choreo-radial explainer graphic">
				</div>
				<div class='right-column'>
					<img id='choreo-radial-explainer-body' src="{{ url_for('static', filename='assets/explainer-choreo-radial-body.svg') }}" alt="choreo-radial-body explainer graphic">
				</div>
			</div>
		</div>
	</div>
	<div id='modern-era-feature-spread' class='blade'>
		<div class='feature-spread-container'>
			<div>
				<p class='era-title'>The Contemporary Era</p>
				<p class='feature-title'>Artifact, 1984</p>
				<p class='era-title' style='margin-top: 0;'>William Forsythe</p>
				<p class='feature-para'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin laoreet, ligula 
						in lacinia porttitor, leo metus vehicula turpis, et consequat felis lorem nec elit. Fusce augue arcu, facilisis nec 
						posuere quis, ullamcorper sed neque. Pellentesque et eros tellus. Suspendisse id ex scelerisque, venenatis tortor nec, 
						sodales tellus. Praesent dui libero, vehicula placerat consequat et, laoreet vitae justo. Sed in dignissim dolor.</p>
			</div>
			<img id='artifact-feature-choreo-radials' class='desktop' src="{{ url_for('static', filename='assets/artifact-radials-names-below-illus-white-blobs.svg') }}" alt="artifact 1984 choreo radials">
			<img id='artifact-feature-choreo-radials' class='mobile' src="{{ url_for('static', filename='assets/artifact-radials-vert-names-right-illus.svg') }}" alt="artifact 1984 choreo radials">
		</div>
	</div>
	<div id='modern-era-vis-spread' class='blade'>
			<p class='era-title left-margin' style='margin-bottom: 5vh;'>The Contemporary Era</p>
			<div class='spread-container'>
				<div id='endolor-column' class="column-within-blade a">
						<span>
							<button id="endolor-play-button" class='play-button'>&#9658;</button>
							<button id="endolor-pause-button" class='play-button button-enabled'>❚❚</button>
							<p class='column-title'>En Dolor, 1944</p>
						</span>
						<div id="endolor-slider-container">
							<input type='range' min='0' max='80' step='1' value='0' id='endolor-slider' class='slider'/> 
						</div>
						<div id='endolor-choreo-radial' class='choreo-radial'></div>
						<p class='column-paragraph para' style='text-align: left;'>Ethel Winter<br><br>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin laoreet, ligula 
							in lacinia porttitor, leo metus vehicula turpis, et consequat felis lorem nec elit. Fusce augue arcu, facilisis nec 
							posuere quis, ullamcorper sed neque. Pellentesque et eros tellus. Suspendisse id ex scelerisque, venenatis tortor nec, 
							sodales tellus. Praesent dui libero, vehicula placerat consequat et, laoreet vitae justo. Sed in dignissim dolor. 
						</p>
				</div>
				<div id='songs-column' class="column-within-blade b">
						<span>
							<button id="songs-play-button" class='play-button'>&#9658;</button>
							<button id="songs-pause-button" class='play-button button-enabled'>❚❚</button>
							<p class='column-title'>Songs, 1956</p>
						</span>
						<div id="songs-slider-container">
							<input type='range' min='0' max='175' step='1' value='0' id='songs-slider' class='slider'/> 
						</div>
						<div id='songs-choreo-radial' class='choreo-radial'></div>
						<p class='column-paragraph para' style='text-align: left;'>Mary Anthony<br><br>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin laoreet, ligula 
							in lacinia porttitor, leo metus vehicula turpis, et consequat felis lorem nec elit. Fusce augue arcu, facilisis nec 
							posuere quis, ullamcorper sed neque. Pellentesque et eros tellus. Suspendisse id ex scelerisque, venenatis tortor nec, 
							sodales tellus. Praesent dui libero, vehicula placerat consequat et, laoreet vitae justo. Sed in dignissim dolor. 
						</p>
				</div>
				<div id='artifact-column' class="column-within-blade c">
						<span>
							<button id="artifact-play-button" class='play-button'>&#9658;</button>
							<button id="artifact-pause-button" class='play-button button-enabled'>❚❚</button>
							<p class='column-title'>Artifact, 1984</p>
						</span>
						<div id="artifact-slider-container">
							<input type='range' min='0' max='61' step='1' value='0' id='artifact-slider' class='slider'/> 
						</div>
						<div id="artifact-choreo-radial" class='choreo-radial'></div>
						<p class='column-paragraph para' style='text-align: left;'>William Forsythe<br><br>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin laoreet, ligula 
							in lacinia porttitor, leo metus vehicula turpis, et consequat felis lorem nec elit. Fusce augue arcu, facilisis nec 
							posuere quis, ullamcorper sed neque. Pellentesque et eros tellus. Suspendisse id ex scelerisque, venenatis tortor nec, 
							sodales tellus. Praesent dui libero, vehicula placerat consequat et, laoreet vitae justo. Sed in dignissim dolor. 
						</p>
				</div>
			</div>
	</div>
	<div id='modern-era-vis-overview-spread' class='blade'>
	<div class='feature-spread-container'>
			<div>
				<p class='era-title'>The Contemporary Era</p>
				<p class='feature-para'>Plotting measures in a feature space representing movement diversity and repetition, we can get a sense of the nature of the movement of each dance.</p>
			</div>
			<img id='modern-era-choreo-radials' class='desktop grid-radials' src="{{ url_for('static', filename='assets/contemporary-era-radial-grid.svg') }}" alt="contemporary choreo radials">
			<img id='modern-era-choreo-radials' class='mobile grid-radials' src="{{ url_for('static', filename='assets/contemporary-era-radial-grid-mobile.svg') }}" alt="contemporary choreo radials">
		</div>
	</div>
	<!-- <div id='classical-era-vis-spread' class='blade'>
			<div class='spread-container'>
				<div id='coppelia-column' class="column-within-blade a"> -->
					<!-- <button id="coppelia-play-button" class='play-button' onclick="document.getElementById('coppelia-audio').play()">&#9658;</button> -->
					<!-- TODO ADD SLIDER -->
					<!-- TODO ADD PAUSE -->
					<!-- TODO ADD MARKER FOR AVG CUMULATIVE WEIGHT DIST-->
					<!-- <p class='column-title'>Coppélia 1870</p>
					<div id="coppelia-choreo-radial" class='choreo-radial'></div>
					<p class='column-paragraph para' style='text-align: left;'>Arthur Michel Saint-Leon<br><br>Coppélia was originally choreographed by Arthur Saint-Léon for the St. Petersburg Imperial Ballet in 
						Russia, though it debuted in Paris in 1870. The ballet tells the comic story of an inventor who creates a doll so lifelike 
						that a village boy becomes infatuated with it. Coppélia is still frequently performed today, and is known for its fast 
						footwork as well as its historic use of mime and visual motif to tell a story.</p>
				</div>
				<div id='sleepingbeauty-column' class="column-within-blade b">
						<p class='column-title'>Sleeping Beauty 1890</p>
						<div id='sleepingbeauty-choreo-radial' class='choreo-radial'></div>
						<p class='column-paragraph para' style='text-align: left;'>Marius Petipa<br><br>Coppélia was originally choreographed by Arthur Saint-Léon for the St. Petersburg Imperial Ballet in 
							Russia, though it debuted in Paris in 1870. The ballet tells the comic story of an inventor who creates a doll so lifelike 
							that a village boy becomes infatuated with it. Coppélia is still frequently performed today, and is known for its fast 
							footwork as well as its historic use of mime and visual motif to tell a story.</p>
				</div>
				<div id='raymonda-column' class="column-within-blade c">
						<p class='column-title'>Raymonda 1898</p>
						<div id='raymonda-choreo-radial' class='choreo-radial'></div>
						<p class='column-paragraph para' style='text-align: left;'>Marius Petipa<br><br>Set in Hungary, Raymonda tells a typically romantic story for a classical ballet about royalty, magic, 
							vision and drama. It was choreographed by the renowned ballet master Marius Petipa of the St. Petersburg Imperial ballet and 
							debuted in 1898 at the Mariinsky Theater in St. Petersburg.  Raymonda is a foundational and strongly classic ballet, though 
							in its many productions since the late 19th century it has been greatly altered to suit modern taste and dancers. 
						</p>
				</div>
			</div>
	</div> -->
	<main>
	{% block main %}{% endblock %}
	</main>
	{% block script %}{% endblock %}
</body>
<script>
	$(function() { // This function runs as soon as page is loaded.
		console.log('On load function.')
	});
	const datapath = "static/data/"
	var stepCircleColor = "black"
	var stepCircleAlpha = 0.3
	var dataset; // global
	var numRadialSpokes = 8
	var randJitter = false
	// var lineRes = 0.005
	var lineRes = 0.05
	var curveAlpha = 0.55
	var radialLineWidth = 0.5
	var radiusMult = 150 //this has to do with the spikes
	var radiusOutwardMult = 1.8 //scaling to the page
	var curveType = 'basis'
	var stepLengthMultipier = 2
	var weightCircleColor = "black"
	// var animateColor = "#D2D627"
	var animateColor = "red"
	var weightCircleSize = 1.8

	function getRandomNumber(start, end) {
		return (Math.random() * (end-start) * 100)/100 + start;
	}
	function degrees_to_radians(degrees) {
		var pi = Math.PI;
		return degrees * (pi/180);
	}
	function radians_to_degrees(rad) {
		var pi = Math.PI;
		return rad * (180/pi);
	}

	var	outerRadius = Math.min(width, height, 250)/2,
				innerRadius = outerRadius * 0.4;

	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Helper functions /////////////////////////////
	///////////////////////////////////////////////////////////////////////////
	var spokeArr = d3.range(10,359,359/numRadialSpokes)
	var spokeArrRad = spokeArr.map(x => degrees_to_radians(x))
	var bodyMovements = [
							"head",
							"right_hand",
							"right_arm",
							"right_body",
							"right_leg",
							"right_support",
							"left_support",
							"left_leg",
							"left_body",
							"left_arm",
							"left_hand"
						]
	function staffNumToRad(staff_num){
		return parseInt(staff_num);
	}
	function bodyMovementToTheta(body_movement){
		switch(body_movement){
			case "right_arm":
				return spokeArr[2];
			case "left_arm":
				return spokeArr[9];
			case "right_leg":
				return spokeArr[4];
			case "left_leg":
				return spokeArr[7];
			case "right_support":
				return spokeArr[5];
			case "left_support":
				return spokeArr[6];
			case "right_hand":
				return spokeArr[1];
			case "left_hand":
				return spokeArr[10];
			case "right_body":
				return spokeArr[3];
			case "left_body":
				return spokeArr[8];
			case "head":
				return spokeArr[0];
		}
	}
	function bodyDirectionToTheta(body_movement, direction){
		switch(direction){
			case "place":
				return -1;
			case "forward":
				return spokeArr[0]
			case "forward_diagonal":
				if (body_movement.includes("right")){
					return spokeArr[1]
				} else {
					return spokeArr[7]
				}
			case "right":
				return spokeArr[2];
			case "backward_diagonal":
				if (body_movement.includes("right")){
					return spokeArr[3]
				} else {
					return spokeArr[5]
				}
			case "backward":
				return spokeArr[4];
			case "left":
				return spokeArr[6];
		}
	}
	if (curveType == 'catmull'){var lineRadial = d3.lineRadial().curve(d3.curveCatmullRom.alpha(curveAlpha));}
	if (curveType == 'basis'){var lineRadial = d3.lineRadial().curve(d3.curveBasis);}

	var margin = {
		top: 0,
		right: 0,
		bottom: 0,
		left: 0
	};

	var width = 200 - margin.left - margin.right;
	var height = 200 - margin.top - margin.bottom;


///////////////////////////////////////////////////////////////////////////
////////////////////////// Artifact, Forsythe /////////////////////////////
///////////////////////////////////////////////////////////////////////////
	var artifact_dataset;
	var artifact_svg;
	var artifact_defs;
	var radiusOutwardMult_artifact = 1.4;
	// var radiusOutwardMult_artifact = .8;
	var artifact_measures = [{"index": 0, "ballet": "artifact", "ymin": 838.7689439141, "ymax": 1642.1331947345, "label": "measure_1", "step_length": 803.3642508204, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 1, "ballet": "artifact", "ymin": 33.6271162739, "ymax": 845.6937649165, "label": "measure_2", "step_length": 812.0666486426, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 39, "ballet": "artifact", "ymin": 8.1598672434, "ymax": 809.4435784606, "label": "measure_4", "step_length": 801.2837112172, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "4"}, {"index": 40, "ballet": "artifact", "ymin": 810.2366870525, "ymax": 1625.0795047733, "label": "measure_3", "step_length": 814.8428177208, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "3"}, {"index": 59, "ballet": "artifact", "ymin": 0.0, "ymax": 790.9936977924, "label": "measure_6", "step_length": 790.9936977924, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "6"}, {"index": 60, "ballet": "artifact", "ymin": 797.224138574, "ymax": 1604.0982529087, "label": "measure_5", "step_length": 806.8741143347, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "5"}, {"index": 79, "ballet": "artifact", "ymin": 826.0875400641, "ymax": 1638.8237179487, "label": "measure_7", "step_length": 812.7361778846, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "7"}, {"index": 80, "ballet": "artifact", "ymin": 4.3413461538, "ymax": 822.4697516026, "label": "measure_8", "step_length": 818.1284054487, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "8"}]

	var artifact_radArr = [];
	var artifact_dataArr = [];
	var artifact_data = [];
	var artifact_dataStyling = [];
	var radialWrapperartifact;
	var circleWrapperartifact; 

	var artifactButton = document.getElementById("artifact-play-button");
	var artifactAudio = document.getElementById("artifact-audio");

	d3.json(datapath+'artifact'+".json", function(artifact_data) {
			artifact_dataset = artifact_data;

				//SVG container
				artifact_svg = d3.select("#artifact-choreo-radial")
					.append("svg")
					// .attr("width", 200)
					// .attr("height", 200)
					.attr("viewBox", `0 0 400 400`)
					.append("g")
					.attr("transform", "translate(" + 200 + "," + 200 + ")");
					// .attr("transform", "translate(" + 150 + "," + 100 + ")");



				//Container for the gradients
				artifact_defs = artifact_svg.append("defs");
				//Filter for the outside glow
				var filter = artifact_defs.append("filter")
					.attr("id","glow");
				filter.append("feGaussianBlur")
					.attr("stdDeviation","1.5")
					.attr("result","coloredBlur");
				var feMerge = filter.append("feMerge");
				feMerge.append("feMergeNode")
					.attr("in","coloredBlur");
				feMerge.append("feMergeNode")
					.attr("in","SourceGraphic");

				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Create scales ////////////////////////////////
				///////////////////////////////////////////////////////////////////////////

				// Playback time
				// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
				artifact_dataset.forEach(function(d, i) {
					measNum = +d.measure_num
					meas_ymin = artifact_measures.filter(x=>+x.measure_num==measNum)[0].ymax
					step_ymin = +d.ymax
					d.playbackTime = (measNum + (step_ymin)/100) * 4
					d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
					d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
					tmp = artifact_dataset.slice(0,i).map(x=>x.thetaRad)
					if (tmp.length > 0){
						tmp = tmp.reduce((a, b) => a + b) / tmp.length;
						d.weightDist = tmp
					}else {
						d.weightDist = 0
					}
				});
				
				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Radial line //////////////////////////////////
				///////////////////////////////////////////////////////////////////////////
				artifact_dataset = artifact_dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
				
				artifact_radArr = artifact_dataset.map(x=>(x.playbackTime)*radiusOutwardMult_artifact)
				// Nonzero radii
				artifact_radArr = artifact_radArr.filter(x=>x>0)
				
				function findClosest(num, spoke){
					if (Math.abs(num[0] - spoke) <= 0.03) return 1
				}
				for (ii = 0; ii < artifact_radArr.length; ii++) {
					if(artifact_dataset[ii].body_movement!=null){
						artifact_data = []
						for (i = 0; i <= 2+lineRes; i=i+lineRes) {
						if (randJitter) {artifact_data.push([Math.PI * i, artifact_radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
						if (!randJitter) {artifact_data.push([Math.PI * i, artifact_radArr[ii] ])}
						}
						artifact_dataStyling.push({'body_movement' : artifact_dataset[ii].body_movement,
										'step_length' : artifact_dataset[ii].step_length * stepLengthMultipier,
										'playback_time': artifact_dataset[ii].playbackTime,
										'weight_dist': artifact_dataset[ii].weightDist})
						arr = spokeArrRad
						num = degrees_to_radians(artifact_dataset[ii].theta)
						var closestSpoke = arr.reduce(function(prev, curr) {
							return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
						});
						
						// find theta closest to chosen spokeArr
						if (artifact_dataset[ii].direction_movement!='place'){
							index = artifact_data.findIndex(x => findClosest(x, closestSpoke));
							artifact_data[index] = [artifact_data[index][0], artifact_radArr[ii]+artifact_dataset[ii].step_length * radiusMult]
							artifact_dataArr.push({artifact_data})
						}
					}
				}
				
				artifact_dataset.forEach(function(d, i) {
					d.slider_time = i;
				})

				
				radialWrapperartifact = artifact_svg.append("g")
					.attr("transform", "translate(" + 0 + "," + 0 + ")");
				circleWrapperartifact = artifact_svg.append("g")
					.attr("transform", "translate(" + 0 + "," + 0 + ")");

				for (i = 0; i < artifact_dataArr.length; i++) {
					className = "artifact"
					curRadialLineWidth = artifact_dataStyling[i].step_length
					curPlaybackTime = artifact_dataStyling[i].playback_time
					radialWrapperartifact
						.append("path")
						.attr("d", lineRadial(artifact_dataArr[i].artifact_data))
						.attr("class", className)
						.attr("transform", "rotate(" + ( -55 ) + ")")
						.attr("fill", "none")
						.attr("stroke-width", curRadialLineWidth/2)
						.attr("stroke", "black")
						.style("filter", "url(#glow)")
						.attr("opacity", 0.7)
					circleWrapperartifact
						.append("circle")
							.attr("opacity", 0.5)
							.attr("class", className)
							.attr("cy", artifact_dataArr[i].artifact_data[0][1]*Math.sin(artifact_dataStyling[i].weight_dist))
							.attr("cx", artifact_dataArr[i].artifact_data[0][1]*Math.cos(artifact_dataStyling[i].weight_dist))
							.attr("r", weightCircleSize)
							.style("filter", "url(#glow)")
							.style('fill', weightCircleColor)
				}

				function update(timePoint) {
					if(timePoint == 1){
						d3.selectAll('.artifact')
							.remove()
					}
					// for (i = 0; i < artifact_dataArr.length; i++) {
					className = "artifact"
					curRadialLineWidth = artifact_dataStyling[timePoint].step_length
					curPlaybackTime = artifact_dataStyling[timePoint].playback_time
					radialWrapperartifact
						.append("path")
						.attr("d", lineRadial(artifact_dataArr[timePoint].artifact_data))
						.attr("class", className)
						.attr("opacity", 0)
						.attr("transform", "rotate(" + ( -55 ) + ")")
						.attr("fill", "none")
						.attr("stroke-width", curRadialLineWidth/2)
						.attr("stroke", animateColor)
						.style("filter", "url(#glow)")
						.transition()
						// .delay( (curPlaybackTime-14)*900)
						.delay( (curPlaybackTime-25))
						.attr("opacity", 0.7)
						.transition()
							.ease(d3.easeLinear)
							.duration(200)
							.attr("stroke", "black")
					circleWrapperartifact
						.append("circle")
							.attr("opacity", 0)
							.attr("cy", artifact_dataArr[timePoint].artifact_data[0][1]*Math.sin(artifact_dataStyling[timePoint].weight_dist))
							.attr("cx", artifact_dataArr[timePoint].artifact_data[0][1]*Math.cos(artifact_dataStyling[timePoint].weight_dist))
							.attr("r", weightCircleSize)
							.attr("class", className)
							.style('fill', weightCircleColor)
							.transition()
							// .delay( (curPlaybackTime-14)*900)
							.delay( (curPlaybackTime-25))
								.attr("opacity", 0.5)
				// }
				};

				//Run the update function when the slider is changed
				d3.select('#artifact-slider').on('input', function() {
					update(this.value);
				});

				var myTimer;
				var t = 0;
				d3.select("#artifact-play-button").on("click", function() {
					$("#artifact-play-button").addClass('button-enabled')
					$("#artifact-pause-button").removeClass('button-enabled')
					artifactAudio.play();
					clearInterval (myTimer);
					myTimer = setInterval (function() {
						var b = d3.select("#artifact-slider");
						t = (+b.property("value") + 1) % (+b.property("max") + 1);
						curPlaybackTime = (artifact_dataset.filter(x=>x.slider_time==t)[0].playbackTime)*2000
						if (t == 0) { t = +b.property("min"); }
						if (t >= 61){
							$("#artifact-pause-button").addClass('button-enabled')
							$("#artifact-play-button").removeClass('button-enabled')
							// artifactAudio.pause();
							clearInterval (myTimer);
							return
						}
						b.property("value", t);
						update (t);
					}, 950);
				});

				d3.select("#artifact-pause-button").on("click", function() {
					$("#artifact-pause-button").addClass('button-enabled')
					$("#artifact-play-button").removeClass('button-enabled')
					artifactAudio.pause();
					clearInterval (myTimer);
				});
			})


///////////////////////////////////////////////////////////////////////////
//////////////////////////// Songs, Anthony ///////////////////////////////
///////////////////////////////////////////////////////////////////////////
	var songs_dataset;
	var songs_svg;
	var songs_defs;
	var radiusOutwardMult_songs = 0.9;
	var songs_measures = [{"index": 0, "ballet": "songs", "ymin": 34.0487954952, "ymax": 638.5292828908, "label": "measure_3", "step_length": 604.4804873956, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "3"}, {"index": 1, "ballet": "songs", "ymin": 1236.1019820257, "ymax": 1351.0379064737, "label": "measure_1", "step_length": 114.9359244481, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 2, "ballet": "songs", "ymin": 639.4572922882, "ymax": 1242.8006414081, "label": "measure_2", "step_length": 603.3433491199, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 21, "ballet": "songs", "ymin": 643.6398418854, "ymax": 1251.5226170943, "label": "measure_4", "step_length": 607.8827752088, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "4"}, {"index": 22, "ballet": "songs", "ymin": 23.0015848747, "ymax": 642.5905802506, "label": "measure_5", "step_length": 619.5889953759, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "5"}, {"index": 61, "ballet": "songs", "ymin": 641.0, "ymax": 1272.6895323687, "label": "measure_6", "step_length": 631.6895323687, "img_num": "2", "img_staff_num": "1", "staff_num": 3, "measure_num": "6"}, {"index": 62, "ballet": "songs", "ymin": 30.8058155579, "ymax": 639.2968656772, "label": "measure_7", "step_length": 608.4910501193, "img_num": "2", "img_staff_num": "1", "staff_num": 3, "measure_num": "7"}, {"index": 111, "ballet": "songs", "ymin": 45.1976051072, "ymax": 665.3705558691, "label": "measure_9", "step_length": 620.1729507619, "img_num": "2", "img_staff_num": "2", "staff_num": 4, "measure_num": "9"}, {"index": 112, "ballet": "songs", "ymin": 662.5951079289, "ymax": 1272.1298321106, "label": "measure_8", "step_length": 609.5347241817, "img_num": "2", "img_staff_num": "2", "staff_num": 4, "measure_num": "8"}, {"index": 151, "ballet": "songs", "ymin": 634.8149689616, "ymax": 1254.9913409989, "label": "measure_10", "step_length": 620.1763720372, "img_num": "3", "img_staff_num": "1", "staff_num": 5, "measure_num": "10"}, {"index": 152, "ballet": "songs", "ymin": 20.0345125564, "ymax": 635.5286223194, "label": "measure_11", "step_length": 615.494109763, "img_num": "3", "img_staff_num": "1", "staff_num": 5, "measure_num": "11"}, {"index": 189, "ballet": "songs", "ymin": 440.0932562077, "ymax": 833.080549873, "label": "measure_13", "step_length": 392.9872936653, "img_num": "3", "img_staff_num": "2", "staff_num": 6, "measure_num": "13"}, {"index": 190, "ballet": "songs", "ymin": 14.2452207957, "ymax": 436.316027088, "label": "measure_14", "step_length": 422.0708062923, "img_num": "3", "img_staff_num": "2", "staff_num": 6, "measure_num": "14"}, {"index": 191, "ballet": "songs", "ymin": 832.3723194131, "ymax": 1246.4395457111, "label": "measure_12", "step_length": 414.067226298, "img_num": "3", "img_staff_num": "2", "staff_num": 6, "measure_num": "12"}, {"index": 254, "ballet": "songs", "ymin": 661.3766489137, "ymax": 958.0045146727, "label": "measure_16", "step_length": 296.627865759, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "16"}, {"index": 255, "ballet": "songs", "ymin": 960.9796839729, "ymax": 1268.9097065463, "label": "measure_15", "step_length": 307.9300225734, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "15"}, {"index": 256, "ballet": "songs", "ymin": 358.9843926354, "ymax": 658.5002645316, "label": "measure_17", "step_length": 299.5158718962, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "17"}, {"index": 257, "ballet": "songs", "ymin": 45.7722823787, "ymax": 353.7313593397, "label": "measure_18", "step_length": 307.9590769611, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "18"}]
	var songs_radArr = [];
	var songs_dataArr = [];
	var songs_data = [];
	var songs_dataStyling = [];
	var radialWrappersongs;
	var circleWrappersongs; 
	var songsButton = document.getElementById("songs-play-button");
	var songsAudio = document.getElementById("songs-audio");

	d3.json(datapath+'songs'+".json", function(songs_data) {
			songs_dataset = songs_data;

				//SVG container
				songs_svg = d3.select("#songs-choreo-radial")
					.append("svg")
					// .attr("width", 200)
					// .attr("height", 200)
					.attr("viewBox", `0 0 400 400`)
					.append("g")
					.attr("transform", "translate(" + 200 + "," + 200 + ")");
					// .attr("transform", "translate(" + 150 + "," + 100 + ")");



				//Container for the gradients
				songs_defs = songs_svg.append("defs");
				//Filter for the outside glow
				var filter = songs_defs.append("filter")
					.attr("id","glow");
				filter.append("feGaussianBlur")
					.attr("stdDeviation","1.5")
					.attr("result","coloredBlur");
				var feMerge = filter.append("feMerge");
				feMerge.append("feMergeNode")
					.attr("in","coloredBlur");
				feMerge.append("feMergeNode")
					.attr("in","SourceGraphic");

				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Create scales ////////////////////////////////
				///////////////////////////////////////////////////////////////////////////

				// Playback time
				// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
				songs_dataset.forEach(function(d, i) {
					measNum = +d.measure_num
					meas_ymin = songs_measures.filter(x=>+x.measure_num==measNum)[0].ymax
					step_ymin = +d.ymax
					d.playbackTime = (measNum + (step_ymin)/50) * 4
					d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
					d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
					tmp = songs_dataset.slice(0,i).map(x=>x.thetaRad)
					if (tmp.length > 0){
						tmp = tmp.reduce((a, b) => a + b) / tmp.length;
						d.weightDist = tmp
					}else {
						d.weightDist = 0
					}
				});
				
				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Radial line //////////////////////////////////
				///////////////////////////////////////////////////////////////////////////
				songs_dataset = songs_dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
				
				songs_radArr = songs_dataset.map(x=>(x.playbackTime)*radiusOutwardMult_songs)
				// Nonzero radii
				songs_radArr = songs_radArr.filter(x=>x>0)
				
				function findClosest(num, spoke){
					if (Math.abs(num[0] - spoke) <= 0.03) return 1
				}
				for (ii = 0; ii < songs_radArr.length; ii++) {
					if(songs_dataset[ii].body_movement!=null){
						songs_data = []
						for (i = 0; i <= 2+lineRes; i=i+lineRes) {
						if (randJitter) {songs_data.push([Math.PI * i, songs_radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
						if (!randJitter) {songs_data.push([Math.PI * i, songs_radArr[ii] ])}
						}
						songs_dataStyling.push({'body_movement' : songs_dataset[ii].body_movement,
										'step_length' : songs_dataset[ii].step_length * stepLengthMultipier,
										'playback_time': songs_dataset[ii].playbackTime,
										'weight_dist': songs_dataset[ii].weightDist})
						arr = spokeArrRad
						num = degrees_to_radians(songs_dataset[ii].theta)
						var closestSpoke = arr.reduce(function(prev, curr) {
							return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
						});
						
						// find theta closest to chosen spokeArr
						if (songs_dataset[ii].direction_movement!='place'){
							index = songs_data.findIndex(x => findClosest(x, closestSpoke));
							songs_data[index] = [songs_data[index][0], songs_radArr[ii]+songs_dataset[ii].step_length * radiusMult]
							songs_dataArr.push({songs_data})
						}
					}
				}
				
				songs_dataset.forEach(function(d, i) {
					d.slider_time = i;
				})

				radialWrappersongs = songs_svg.append("g")
					.attr("transform", "translate(" + 0 + "," + 0 + ")");
				circleWrappersongs = songs_svg.append("g")
					.attr("transform", "translate(" + 0 + "," + 0 + ")");

				for (i = 0; i < songs_dataArr.length; i++) {
					className = "songs"
					curRadialLineWidth = songs_dataStyling[i].step_length
					curPlaybackTime = songs_dataStyling[i].playback_time
					radialWrappersongs
						.append("path")
						.attr("d", lineRadial(songs_dataArr[i].songs_data))
						.attr("class", className)
						.attr("transform", "rotate(" + ( -55 ) + ")")
						.attr("fill", "none")
						.attr("stroke-width", curRadialLineWidth/2)
						.attr("stroke", "black")
						.style("filter", "url(#glow)")
						.attr("opacity", 0.7)
					circleWrappersongs
						.append("circle")
							.attr("opacity", 0.5)
							.attr("class", className)
							.attr("cy", songs_dataArr[i].songs_data[0][1]*Math.sin(songs_dataStyling[i].weight_dist))
							.attr("cx", songs_dataArr[i].songs_data[0][1]*Math.cos(songs_dataStyling[i].weight_dist))
							.attr("r", weightCircleSize)
							.style("filter", "url(#glow)")
							.style('fill', weightCircleColor)
				}

				function update(timePoint) {
					console.log("UPDATE time ", timePoint)
					if(timePoint == 1){
						d3.selectAll('.songs')
							.remove()
					}
					// for (i = 0; i < artifact_dataArr.length; i++) {
					className = "songs"
					curRadialLineWidth = songs_dataStyling[timePoint].step_length
					curPlaybackTime = songs_dataStyling[timePoint].playback_time
					radialWrappersongs
						.append("path")
						.attr("d", lineRadial(songs_dataArr[timePoint].songs_data))
						.attr("class", className)
						.attr("opacity", 0)
						.attr("transform", "rotate(" + ( -55 ) + ")")
						.attr("fill", "none")
						.attr("stroke-width", curRadialLineWidth/2)
						.attr("stroke", animateColor)
						.style("filter", "url(#glow)")
						.transition()
						// .delay( (curPlaybackTime-14)*900)
						.delay( (curPlaybackTime-25))
						.attr("opacity", 0.7)
						.transition()
							.ease(d3.easeLinear)
							.duration(200)
							.attr("stroke", "black")
					circleWrappersongs
						.append("circle")
							.attr("opacity", 0)
							.attr("cy", songs_dataArr[timePoint].songs_data[0][1]*Math.sin(songs_dataStyling[timePoint].weight_dist))
							.attr("cx", songs_dataArr[timePoint].songs_data[0][1]*Math.cos(songs_dataStyling[timePoint].weight_dist))
							.attr("r", weightCircleSize)
							.attr("class", className)
							.style('fill', weightCircleColor)
							.transition()
							// .delay( (curPlaybackTime-14)*900)
							.delay( (curPlaybackTime-25))
								.attr("opacity", 0.5)
				// }
				};

				//Run the update function when the slider is changed
				d3.select('#songs-slider').on('input', function() {
					update(this.value);
				});

				var myTimer;
				var t = 0;
				d3.select("#songs-play-button").on("click", function() {
					$("#songs-play-button").addClass('button-enabled')
					$("#songs-pause-button").removeClass('button-enabled')
					songsAudio.play();
					clearInterval (myTimer);
					myTimer = setInterval (function() {
						var b = d3.select("#songs-slider");
						t = (+b.property("value") + 1) % (+b.property("max") + 1);
						curPlaybackTime = (songs_dataset.filter(x=>x.slider_time==t)[0].playbackTime)*2000
						if (t == 0) { t = +b.property("min"); }
						if (t >= 174){
							$("#songs-pause-button").addClass('button-enabled')
							$("#asongs-play-button").removeClass('button-enabled')
							clearInterval (myTimer);
							return
						}
						b.property("value", t);
						update (t);
					}, 500);
				});

				d3.select("#songs-pause-button").on("click", function() {
					$("#songs-pause-button").addClass('button-enabled')
					$("#songs-play-button").removeClass('button-enabled')
					songsAudio.pause();
					clearInterval (myTimer);
				});
			})

///////////////////////////////////////////////////////////////////////////
/////////////////////////// En Dolor, Winter ///////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
var endolor_dataset;
var endolor_svg;
var endolor_defs;
var radiusOutwardMult_endolor = 0.9;
var endolor_measures = [{"index": 0, "ballet": "endolor", "ymin": 36.6393376129, "ymax": 337.4905826749, "label": "measure_4", "step_length": 300.8512450621, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "4"}, {"index": 1, "ballet": "endolor", "ymin": 635.6952772291, "ymax": 928.7115018341, "label": "measure_2", "step_length": 293.016224605, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 2, "ballet": "endolor", "ymin": 335.9765095937, "ymax": 637.0247072517, "label": "measure_3", "step_length": 301.048197658, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "3"}, {"index": 3, "ballet": "endolor", "ymin": 934.0107576185, "ymax": 1347.2726968115, "label": "measure_1", "step_length": 413.261939193, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 35, "ballet": "endolor", "ymin": 32.4303047404, "ymax": 335.881489842, "label": "measure_8", "step_length": 303.4511851016, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "8"}, {"index": 36, "ballet": "endolor", "ymin": 928.8529909707, "ymax": 1236.2979683973, "label": "measure_5", "step_length": 307.4449774266, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "5"}, {"index": 37, "ballet": "endolor", "ymin": 333.7957110609, "ymax": 632.085778781, "label": "measure_7", "step_length": 298.2900677201, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "7"}, {"index": 38, "ballet": "endolor", "ymin": 634.4856094808, "ymax": 929.6173814898, "label": "measure_6", "step_length": 295.131772009, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "6"}, {"index": 85, "ballet": "endolor", "ymin": 252.4544123871, "ymax": 550.50560807, "label": "measure_11", "step_length": 298.0511956828, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "11"}, {"index": 86, "ballet": "endolor", "ymin": 549.1168171558, "ymax": 845.3348088318, "label": "measure_10", "step_length": 296.2179916761, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "10"}, {"index": 87, "ballet": "endolor", "ymin": 48.1299379233, "ymax": 251.4267071106, "label": "measure_12", "step_length": 203.2967691874, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "12"}, {"index": 88, "ballet": "endolor", "ymin": 846.1458627257, "ymax": 1148.9078371896, "label": "measure_9", "step_length": 302.7619744639, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "9"}, {"index": 113, "ballet": "endolor", "ymin": 742.7405033155, "ymax": 939.7297545147, "label": "measure_14", "step_length": 196.9892511992, "img_num": "3", "img_staff_num": "1", "staff_num": 9, "measure_num": "14"}, {"index": 114, "ballet": "endolor", "ymin": 937.3291214024, "ymax": 1142.9650465576, "label": "measure_13", "step_length": 205.6359251552, "img_num": "3", "img_staff_num": "1", "staff_num": 9, "measure_num": "13"}, {"index": 115, "ballet": "endolor", "ymin": 149.5534001129, "ymax": 446.2156197094, "label": "measure_16", "step_length": 296.6622195965, "img_num": "3", "img_staff_num": "1", "staff_num": 9, "measure_num": "16"}, {"index": 116, "ballet": "endolor", "ymin": 444.9905826749, "ymax": 739.8949015942, "label": "measure_15", "step_length": 294.9043189193, "img_num": "3", "img_staff_num": "1", "staff_num": 9, "measure_num": "15"}, {"index": 138, "ballet": "endolor", "ymin": 328.9226156885, "ymax": 629.2440480389, "label": "measure_19", "step_length": 300.3214323505, "img_num": "3", "img_staff_num": "2", "staff_num": 10, "measure_num": "19"}, {"index": 139, "ballet": "endolor", "ymin": 924.9057033014, "ymax": 1226.3740653217, "label": "measure_17", "step_length": 301.4683620203, "img_num": "3", "img_staff_num": "2", "staff_num": 10, "measure_num": "17"}, {"index": 140, "ballet": "endolor", "ymin": 626.0734780615, "ymax": 925.5482241112, "label": "measure_18", "step_length": 299.4747460497, "img_num": "3", "img_staff_num": "2", "staff_num": 10, "measure_num": "18"}, {"index": 141, "ballet": "endolor", "ymin": 24.7520633465, "ymax": 331.8349763685, "label": "measure_20", "step_length": 307.082913022, "img_num": "3", "img_staff_num": "2", "staff_num": 10, "measure_num": "20"}]
var endolor_radArr = [];
var endolor_dataArr = [];
var endolor_data = [];
var endolor_dataStyling = [];
var radialWrapperendolor;
var circleWrapperendolor; 
var endolorButton = document.getElementById("endolor-play-button");
var endolorAudio = document.getElementById("endolor-audio");

d3.json(datapath+'endolor'+".json", function(endolor_data) {
	endolor_dataset = endolor_data;

	//SVG container
	endolor_svg = d3.select("#endolor-choreo-radial")
		.append("svg")
		// .attr("width", 200)
		// .attr("height", 200)
		.attr("viewBox", `0 0 400 400`)
		.append("g")
		.attr("transform", "translate(" + 200 + "," + 200 + ")");
		// .attr("transform", "translate(" + 150 + "," + 100 + ")");



	//Container for the gradients
	endolor_defs = endolor_svg.append("defs");

	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Create scales ////////////////////////////////
	///////////////////////////////////////////////////////////////////////////

	// Playback time
	// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
	endolor_dataset.forEach(function(d, i) {
		measNum = +d.measure_num
		meas_ymin = endolor_measures.filter(x=>+x.measure_num==measNum)[0].ymax
		step_ymin = +d.ymax
		d.playbackTime = (measNum + (step_ymin)/50) * 4
		d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
		d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
		tmp = endolor_dataset.slice(0,i).map(x=>x.thetaRad)
		if (tmp.length > 0){
			tmp = tmp.reduce((a, b) => a + b) / tmp.length;
			d.weightDist = tmp
		}else {
			d.weightDist = 0
		}
	});
	
	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Radial line //////////////////////////////////
	///////////////////////////////////////////////////////////////////////////
	endolor_dataset = endolor_dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
	
	endolor_radArr = endolor_dataset.map(x=>(x.playbackTime)*radiusOutwardMult_endolor)
	// Nonzero radii
	endolor_radArr = endolor_radArr.filter(x=>x>0)
	
	function findClosest(num, spoke){
		if (Math.abs(num[0] - spoke) <= 0.03) return 1
	}
	for (ii = 0; ii < endolor_radArr.length; ii++) {
		if(endolor_dataset[ii].body_movement!=null){
			endolor_data = []
			for (i = 0; i <= 2+lineRes; i=i+lineRes) {
			if (randJitter) {endolor_data.push([Math.PI * i, endolor_radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
			if (!randJitter) {endolor_data.push([Math.PI * i, endolor_radArr[ii] ])}
			}
			endolor_dataStyling.push({'body_movement' : endolor_dataset[ii].body_movement,
							'step_length' : endolor_dataset[ii].step_length * stepLengthMultipier,
							'playback_time': endolor_dataset[ii].playbackTime,
							'weight_dist': endolor_dataset[ii].weightDist})
			arr = spokeArrRad
			num = degrees_to_radians(endolor_dataset[ii].theta)
			var closestSpoke = arr.reduce(function(prev, curr) {
				return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
			});
			
			// find theta closest to chosen spokeArr
			if (endolor_dataset[ii].direction_movement!='place'){
				index = endolor_data.findIndex(x => findClosest(x, closestSpoke));
				endolor_data[index] = [endolor_data[index][0], endolor_radArr[ii]+endolor_dataset[ii].step_length * radiusMult]
				endolor_dataArr.push({endolor_data})
			}
		}
	}
	
	endolor_dataset.forEach(function(d, i) {
		d.slider_time = i;
	})

	radialWrapperendolor = endolor_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");
	circleWrapperendolor = endolor_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");

	for (i = 0; i < endolor_dataArr.length; i++) {
		className = "endolor"
		curRadialLineWidth = endolor_dataStyling[i].step_length
		curPlaybackTime = endolor_dataStyling[i].playback_time
		radialWrapperendolor
			.append("path")
			.attr("d", lineRadial(endolor_dataArr[i].endolor_data))
			.attr("class", className)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", "black")
			.style("filter", "url(#glow)")
			.attr("opacity", 0.7)
		circleWrapperendolor
			.append("circle")
				.attr("opacity", 0.5)
				.attr("class", className)
				.attr("cy", endolor_dataArr[i].endolor_data[0][1]*Math.sin(endolor_dataStyling[i].weight_dist))
				.attr("cx", endolor_dataArr[i].endolor_data[0][1]*Math.cos(endolor_dataStyling[i].weight_dist))
				.attr("r", weightCircleSize)
				.style("filter", "url(#glow)")
				.style('fill', weightCircleColor)
	}

	function update(timePoint) {
		console.log("UPDATE time ", timePoint)
		if(timePoint == 1){
			d3.selectAll('.endolor')
				.remove()
		}
		// for (i = 0; i < artifact_dataArr.length; i++) {
		className = "endolor"
		curRadialLineWidth = endolor_dataStyling[timePoint].step_length
		curPlaybackTime = endolor_dataStyling[timePoint].playback_time
		radialWrapperendolor
			.append("path")
			.attr("d", lineRadial(endolor_dataArr[timePoint].endolor_data))
			.attr("class", className)
			.attr("opacity", 0)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", animateColor)
			.style("filter", "url(#glow)")
			.transition()
			// .delay( (curPlaybackTime-14)*900)
			.delay( (curPlaybackTime-25))
			.attr("opacity", 0.7)
			.transition()
				.ease(d3.easeLinear)
				.duration(200)
				.attr("stroke", "black")
		circleWrapperendolor
			.append("circle")
				.attr("opacity", 0)
				.attr("cy", endolor_dataArr[timePoint].endolor_data[0][1]*Math.sin(endolor_dataStyling[timePoint].weight_dist))
				.attr("cx", endolor_dataArr[timePoint].endolor_data[0][1]*Math.cos(endolor_dataStyling[timePoint].weight_dist))
				.attr("r", weightCircleSize)
				.attr("class", className)
				.style('fill', weightCircleColor)
				.transition()
				// .delay( (curPlaybackTime-14)*900)
				.delay( (curPlaybackTime-25))
					.attr("opacity", 0.5)
	// }
	};

	//Run the update function when the slider is changed
	d3.select('#endolor-slider').on('input', function() {
		update(this.value);
	});

	var myTimer;
	var t = 0;
	d3.select("#endolor-play-button").on("click", function() {
		$("#endolor-play-button").addClass('button-enabled')
		$("#endolor-pause-button").removeClass('button-enabled')
		endolorAudio.play();
		clearInterval (myTimer);
		myTimer = setInterval (function() {
			var b = d3.select("#endolor-slider");
			t = (+b.property("value") + 1) % (+b.property("max") + 1);
			curPlaybackTime = (endolor_dataset.filter(x=>x.slider_time==t)[0].playbackTime)*2000
			if (t == 0) { t = +b.property("min"); }
			if (t >= 80){
				$("#endolor-pause-button").addClass('button-enabled')
				$("#aendolor-play-button").removeClass('button-enabled')
				clearInterval (myTimer);
				return
			}
			b.property("value", t);
			update (t);
		}, 700);
	});

	d3.select("#endolor-pause-button").on("click", function() {
		$("#endolor-pause-button").addClass('button-enabled')
		$("#endolor-play-button").removeClass('button-enabled')
		endolorAudio.pause();
		clearInterval (myTimer);
	});
})
	

</script>
</html>
