<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://use.typekit.net/hlp6dyd.css">
	<style type="text/css">
		:root {
			--black-line-width: 6px;
			--general-margin: 8%;
		}
		.bely-display{
			font-family: bely-display,sans-serif;
			font-weight: 400;
			font-style: normal;
		}
		.bely-regular{
			font-family: bely,serif;
			font-weight: 400;
			font-style: normal;
		}
		.bely-italic {
			font-family: bely, serif;
			font-weight: 400;
			font-style: italic;
		}
		.bely-bold {
			font-family: bely,serif;
			font-weight: 700;
			font-style: normal;
		}
		.bely-bold-italic {
			font-family: bely,serif;
			font-weight: 700;
			font-style: italic;
		}
		@font-face {
		  font-family: 'League';
		  /* src:  url('./static/fonts/leaguespartan-bold.woff2') format('woff2'), */
		  src:  url('./static/fonts/leaguespartan-bold.woff') format('woff');
		}
		body{
			font-family: bely,serif;
			font-weight: 400;
			font-style: normal;
			background: #F7EDDA;
			background: #f4eee1;
			margin-top: 0px;
			margin-left: 0px;
			margin-right: 0px;
		}
		.left-margin{
			margin-left: 12%;
		}
		.blade{
			width: 100vw;
			height: 90vh;
			margin-bottom: 10vh;
			border-top: black;
			border-width: 0px;
			border-left-width: 0px;
			border-right-width: 0px;
			border-bottom-width: 1px;
			border-style: dashed;
			border-width: 0px;
		}
		#title {
			min-height: 0px !important;
			height: 80vh;
			/* height: 80%; */
		}
		#taxonomy-title {
			padding-top: 8vh;
			height: 80vh;
			width: 80vw;
			/* padding-top: 5%;
			width: 55%; */
			background: 
			linear-gradient(black, black) right / var(--black-line-width) 35%;
			background-repeat: no-repeat;
			background-position-y: top;
		}
		#subtitle {
			height: 8vw;
			width: 25vh;
			margin-left: 1vw;
			font-size: 2vh;
		}
		.column-title {
			font-size: 2.1vh;
			display: inline;
		}
		#learn-more {
			width: 8vw;
			margin-top: 10vh;
			display: block;
			margin-left: 1vw;
		}
		.para {
			font-size: 1.7vh;
			line-height: 2.2vh;
		}
		.timeline-circle {
			height: 3.5vw;
			width: 3.5vw;
			margin-left: -2vw;
		}
		#WHY {
			margin-top: 25vh;
		}
		#WHAT {
			margin-top: 98vh;
		}
		#TRY {
			margin-top: 260vh;
		}
		#HOW {
			margin-top: 70vh;
		}
		#year_1944 {
			margin-top: 143vh;
		}
		#year_1956 {
			margin-top: 20vh;
		}
		#year_1984 {
			margin-top: 25vh;
		}
		#year_1898 {
			margin-top: 260vh;
		}
		#year_1890 {
			margin-top: 20vh;
		}
		#year_1870 {
			margin-top: 20vh;
		}
		#intro {
			height: 205vh;
		}
		#intro-text{
			width: 36vw;
			font-size: 2.3vh !important;
			line-height: 2.8vh !important;
		}
		.intro-p {
			width: 50%;
			margin-top: 8.5vh;
		}
		#intro-p-3 {
			
		}
		#choreo-radial-explainer {
			width: 60%;
			margin-top: 2vh;
		}
		#table-of-contents {
			width: 60%;
			margin-top: 2vh;
		}
		#choreo-radial-explainer-body {
			width: 80%;
			margin-top: 40%;
		}
		.left-column {
			width: 40%;
			float: left;
		}
		.right-column {
			width: 50%;
			float: right;
		}
		.centered {
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
		.parent {
			display: grid;
			grid-template-columns: 250px 1fr;
			grid-template-rows: 150px 1fr;
			width: 80vw;
		}
		.child {
			grid-area: 1 / 1 / 2 / 2;
			/* opacity: 0.9; */
			/* height: 780vh; */
			height: 1240vh;
			width: 20px;
			border-left: var(--black-line-width) solid black;
			margin-top: -18vw;
			margin-left: 5vw;
			/* margin: -18vw 5vw; */
		}
		.spread-container{
			display: grid;
			grid-gap: 3%;
			grid-template-columns: auto auto auto;
			/* padding: 3%; */
			width: 80%;
			height: 90%;
			margin-top: 0px;
			margin-left: 12%;
		}
		.two-column-spread {
			width: 80%;
			height: 90%;
			margin-top: 0px;
			margin-left: 12%;
		}
		.feature-spread-container {
			width: 80%;
			height: 90%;
			margin-top: 0px;
			margin-left: 12%;
			margin-bottom: 15vw;
		}
		.column-within-blade {
			text-align: center;
			padding: 2%;
			border-style: dashed;
			border-width: 1px;
			border-width: 0px;
		}
		.a {
			grid-column: 1;
			grid-row: 1 / 3;
		}
		.b {
			grid-column: 2;
			grid-row: 1 / 3;
		}
		.c {
			grid-column: 3;
			grid-row: 1 / 3;
		}
		.desktop{
			display: block !important;
		}
		.mobile{
			display: none !important;
		}
		.play-button {
        	/* border-radius: 3px; */
	  		/* background: black; */
			/* color: white; */
			color: black;
			/* background: white; */
			/* border: none; */
			/* border: 2px solid black; */
			border: none;
			padding: 3px;
			display: inline;
			margin-left: 1.2vh;
			background: black;
			color: white;
			font-size: 1.2vh;
			vertical-align: middle;
      	}
		/* .play-button:hover {
			background: white;
			color: black;
		} */
		button:focus{
			outline: 0;
		}
		svg {
			height: 100%;
			width: 100%;
		}
		.choreo-radial{
			width: 100%;
			height: 50%;
		}
		.feature-title {
			font-family: 'League', Fallback, sans-serif;
			font-size: 3.5vh !important;
			margin-top: 0px;
			margin-bottom: 0px;
		}
		.era-title {
			font-family: 'League', Fallback, sans-serif;
			font-size: 2.5vh !important;
			margin-top: 0px;
			margin-bottom: 0.8vh;
		}
		.era-subtitle {
			font-family: 'League', Fallback, sans-serif;
			font-size: 2vh !important;
			margin-top: 0px;
		}
		.feature-para {
			width: 42vw;
			font-size: 2vh !important;
			line-height: 2.5vh !important;
		}
		.column-paragraph{
			width: 50%;
		}
		.feature-choreo-radials {
			display: block;
			width: 65vw;
			margin-top: var(--general-margin);
		}
		.grid-radials {
			margin-top: var(--general-margin);
			width:	80%;
		}
		.button-enabled {
			color: lightgray;
			display: none;
		}
		.slider-container{
			margin-bottom: 40px;
			margin-top: 20px;
		}
		.slider {
			-webkit-appearance: none;  /* Override default CSS styles */
			appearance: none;
			height: 2px; /* Specified height */
			background: #000; 
			outline: none; /* Remove outline */
			opacity: 0.8; /* Set transparency (for mouse-over effects on hover) */
			-webkit-transition: .2s; /* 0.2 seconds transition on hover */
			transition: opacity .2s;
			width: 50%;
			vertical-align: middle;
		}
		.slider::-webkit-slider-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 0.5px;
			height: 20px;
			border: black;
			border-style: solid;
			border-width: 1px;
		}

		.slider::-moz-range-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 0.5px;
			height: 20px;
			border: black;
			border-style: solid;
			border-width: 1px;
		}
		#modern-era-feature-spread {
			margin-top: 60vh !important;
		}
		#taxonomy-timeline{
			margin-top: var(--general-margin);
		}
		#classical-era-feature-spread {
			margin-top: 30vh;
		}
		#overview-choreo-radials{
			/* height: 100%; */
			width: 80vw;
		}
		#overview {
			margin-top: 10vw;
		}
		#pre-overview {
			height: 60vh;
		}
		#outro-p{
			margin-top: 20vh;
			width: 40vw;
		}
		#colophon-img {
			margin-top: 25vw;
			width: 60%;
		}
		input[type=range]{
			pointer-events: none;
		}
		input[type=range]::-webkit-slider-thumb{/*Webkit Browsers like Chome and Safari*/
			pointer-events: none;
		}
		input[type=range]::-moz-range-thumb{/*Firefox*/
			pointer-events: none;
		}
		input[type=range]::-ms-thumb{/*Internet Explorer*/
			pointer-events: none;
		}
		/************ CAUTION: MOBILE STYLES ***************
		****************************************************
		***************************************************/
		/*TODO: Put 'mobile version under construction. please visit on desktop.'*/
		@media (max-width: 1024px) and (min-width: 0px){
			.desktop{
				display: none !important;
			}
			.mobile{
				display: block !important;
			}
			.left-margin {
				margin-left: 15vw !important;
			}
			.blade {
				height: 82vh !important;
				/* margin-top: 20vh !important; */
				margin-bottom: 0 !important;
				width: 90vw;
			}
			.slider {
				height: 1px; /* Specified height */
			}
			.slider::-webkit-slider-thumb {
				border-width: 1px;
				height: 2vh;
			}

			.slider::-moz-range-thumb {
				border-width: 1px;
				height: 2vh;
			}
			#modern-era-vis-spread {
				min-height: 200vh;
				margin-top: 100vh !important;
			}
			#title {
				margin-top: -25% !important;
				margin-left: 10%;
				width: 80%;
			}
			#taxonomy-title {
				height: 95% !important;
				margin-bottom: 10% !important;
				margin-top: -10% !important;
				background: 
				linear-gradient(black, black) right / var(--black-line-width) 25%;
				background-repeat: no-repeat;
				background-position-y: top;
			}
			#subtitle{
				height: 8vw;
				width: 35vh;
				margin-left: 1vw;
				font-size: 2.5vh;
			}
			.child {
				grid-area: 1 / 1 / 2 / 2;
				/* opacity: 0.8; */
				/* height: 700vh; */
				height: 300vh;
				width: 20px;
				border-left: 5px solid black;
				margin: -30vh 5vw;
			}
			#learn-more {
				width: 19vw;
				margin-top: 16vh;
				display: block;
				margin-left: 1vw;
			}
			.timeline-circle {
				height: 8vw;
				width: 8vw;
				margin-left: -4.5vw !important;
			}
			#HOW {
				margin-top: 46vh;
			}
			#year_1944 {
				margin-top: 170vh;
			}
			#year_1956 {
				margin-top: 20vh;
			}
			#year_1984 {
				margin-top: 20vh;
			}

			#year_1944_solid {
				margin-top: 110vh;
			}
			#year_1956_solid {
				margin-top: 65vh;
			}
			#year_1984_solid {
				margin-top: 75vh;
			}
			#intro-p-12{
				width: 100%;
				margin-top: 1vh !important;
			}
			.a {
				grid-row: 1;
				grid-column: 1 / 3;
			}
			.b {
				grid-row: 2;
				grid-column: 1 / 3;
			}
			.c {
				grid-row: 3;
				grid-column: 1 / 3;
			}
			.left-column {
				float: none;
				width: 80vw;
			}
			.right-column {
				float: none;
				width: 80vw;
			}
			.choreo-radial{
				width: 100%;
    			height: 50%;
			}
			#choreo-radial-explainer-body {
				width: 100%;
				margin-top: 10vh;
			}
			#intro-text{
				width: 80vw;
			}
			#intro {
				min-height: 270vh !important;
			}
			.feature-para {
				width: 95%;
			}
			.two-column-spread {
				margin-top: 0 !important;
				height: 50vh !important;
			}
			.feature-spread-container {
				height: 100vh;
				width: 70% !important;
				margin-top: 10vh !important;
				margin-left: 18vw !important;
			}
			#artifact-feature-choreo-radials {
				height: 45vh;
				margin-top: 5vh;
				float: left;
				width: 20vh;
			}
			#modern-era-vis-overview-spread {
				margin-top: 70vh !important;
				/* margin-top:140vw !important; */
			}
			.grid-radials {
				width: 90%;
				height: auto;
				margin-top: 10%;
			}
			.spread-container {
				margin-left: 10vw;
				width: 100%;
			}
			/* .era-title {
				text-align: center;
				margin-left: 10vw !important;
			} */
		}
		/************ CAUTION: MOBILE STYLES ***************
		****************************************************
		***************************************************/
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js" integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ==" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<audio id="coppelia-audio" src="{{ url_for('static', filename='audio/coppelia_dawn.mp3') }}"></audio>
	<audio id="sleepingbeauty-audio" src="{{ url_for('static', filename='audio/sleepingbeauty.mp3') }}"></audio>
	<audio id="raymonda-audio" src="{{ url_for('static', filename='audio/raymonda.mp3') }}"></audio>
	<audio id="songs-audio" src="{{ url_for('static', filename='audio/songs.mp3') }}"></audio>
	<audio id="artifact-audio" src="{{ url_for('static', filename='audio/artifact.mp3') }}"></audio>
	<audio id="endolor-audio" src="{{ url_for('static', filename='audio/endolor.mp3') }}"></audio>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
	<meta http-equiv="Pragma" content="no-cache"/>
	<meta http-equiv="Expires" content="0"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<div id='title' class='blade'>
		<img id='taxonomy-title' class='centered mobile' src="{{ url_for('static', filename='assets/taxonomy-of-dance-vertical.svg') }}" alt="taxonomy of dance">
		<img id='taxonomy-title' class='centered desktop' src="{{ url_for('static', filename='assets/taxonomy-title-AND-backdrop.svg') }}" alt="taxonomy of dance">
	</div>
	<div id='intro'>
		<div class='parent'>
			<div class='child'>
				<div id='subtitle' class='bely-regular'>
					Using Labanotation, Taxonomy of Dance attempts to discover an underlying visual
					structure in western choreography across two periods of dance: <b>classical</b> and <b>contemporary</b>.
				</div>
				<div id='learn-more'>
					<img src="{{ url_for('static', filename='assets/learn-more-2.svg') }}">
				</div>
				<img id="WHY" class='timeline-circle' src="{{ url_for('static', filename='assets/WHY.svg') }}">
				<img id="HOW" class='timeline-circle' src="{{ url_for('static', filename='assets/HOW.svg') }}">
				<img id="WHAT" class='timeline-circle desktop' src="{{ url_for('static', filename='assets/WHAT.svg') }}">
				<img id="year_1944" class='timeline-circle desktop' src="{{ url_for('static', filename='assets/year_1984_solid_expand.svg') }}">
				<img id="year_1956" class='timeline-circle desktop' src="{{ url_for('static', filename='assets/year_1956_expand.svg') }}">
				<img id="year_1984" class='timeline-circle desktop' src="{{ url_for('static', filename='assets/year_1944_expand.svg') }}">
				<img id="year_1898" class='timeline-circle desktop' src="{{ url_for('static', filename='assets/year_1898.svg') }}">
				<img id="year_1890" class='timeline-circle desktop' src="{{ url_for('static', filename='assets/year_1890.svg') }}">
				<img id="year_1870" class='timeline-circle desktop' src="{{ url_for('static', filename='assets/year_1870.svg') }}">
			</div>	
		</div>
		
		<div class='blade'>
			<div class='two-column-spread'>
				<img id='intro-p-12' class='intro-p' src="{{ url_for('static', filename='assets/intro-p-12.svg') }}" alt="">
			</div>
			<div class='two-column-spread'>
				<img id='choreo-radial-explainer' src="{{ url_for('static', filename='assets/how-explainer.svg') }}" alt="choreo-radial explainer graphic">
			</div>
		</div>
	</div>
	<div id='contents' class='blade'>
		<div class='two-column-spread'>
			<img id='table-of-contents' src="{{ url_for('static', filename='assets/table-of-contents.svg') }}" alt="choreo-radial explainer graphic">
		</div>
	</div>
	<div id='modern-era-feature-spread' class='blade desktop'>
		<div class='feature-spread-container'>
			<div>
				<p class='era-title'>The Modern & Contemporary Eras</p>
				<p class='feature-title'>Artifact, 1984</p>
				<p class='era-title' style='margin-top: 0;'>William Forsythe</p>
				<p class='feature-para'><i>Artifact</i> by William Forsythe is an exemplar of the transition in western dance from its roots in the Classical Era
					 to the 21st century. The score features electronic music, breaking from ballet's traditional accompaniment by a live
					orchestra. Far from rebelling against classicsism, <i>Artifact</i> is a self-acclaimed ode to ballet by choreographer William Forsythe. 
					
					<!-- <br>Talk about William Forsythe. Talk about the Contemporary Era in general: how long it lasted, who were 
					key players, how it compares in this visual format to the Classical Era. -->
				</p>
			</div>
			<!-- <img id='artifact-feature-choreo-radials' class='desktop feature-choreo-radials' src="{{ url_for('static', filename='assets/artifact-radials-names-below-illus-white-blobs.svg') }}" alt="artifact 1984 choreo radials"> -->
			<img id='artifact-feature-choreo-radials' class='desktop feature-choreo-radials' src="{{ url_for('static', filename='assets/artifact-radials.svg') }}" alt="artifact 1984 choreo radials">
			<!-- <img id='artifact-feature-choreo-radials' class='mobile' src="{{ url_for('static', filename='assets/artifact-radials-vert-names-right-illus.svg') }}" alt="artifact 1984 choreo radials"> -->
		</div>
	</div>
	<div id='modern-era-vis-spread' class='blade desktop'>
			<p class='era-title left-margin''>The Modern & Contemporary Eras</p>
			<p class='era-subtitle left-margin' style='margin-bottom: 5vh;'>Radial playback with scores</p>
			<div class='spread-container'>
				<div id='artifact-column' class="column-within-blade a">
						<span>
							<p class='column-title'>Artifact, 1984</p>
						</span>
						<p class='column-paragraph para centered'>William Forsythe<br></p>
						<div id="artifact-slider-container" class='slider-container'>
							<button id="artifact-play-button" class='play-button'>&#9658;</button>
							<button id="artifact-pause-button" class='play-button button-enabled'>❚❚</button>
							<input type='range' min='0' max='61' step='1' value='0' id='artifact-slider' class='slider'/> 
						</div>
						<div id="artifact-choreo-radial" class='choreo-radial'></div>
						
				</div>
				<div id='songs-column' class="column-within-blade b">
					<span>
						<p class='column-title'>Songs, 1956</p>
					</span>
					<p class='column-paragraph para centered'>Mary Anthony<br></p>
					<div id="songs-slider-container" class='slider-container'>
							<button id="songs-play-button" class='play-button'>&#9658;</button>
							<button id="songs-pause-button" class='play-button button-enabled'>❚❚</button>
						<input type='range' min='0' max='175' step='1' value='0' id='songs-slider' class='slider'/> 
					</div>
					<div id='songs-choreo-radial' class='choreo-radial'></div>
				</div>
				<div id='endolor-column' class="column-within-blade c">
						<span>
							<p class='column-title'>En Dolor, 1944</p>
						</span>
						<p class='column-paragraph para centered'>Ethel Winter<br></p>
						<div id="endolor-slider-container" class='slider-container'>
							<button id="endolor-play-button" class='play-button'>&#9658;</button>
							<button id="endolor-pause-button" class='play-button button-enabled'>❚❚</button>
							<input type='range' min='0' max='80' step='1' value='0' id='endolor-slider' class='slider'/> 
						</div>
						<div id='endolor-choreo-radial' class='choreo-radial'></div>
				</div>
			</div>
	</div>
	<div id='modern-era-vis-overview-spread' class='blade desktop'>
	<div class='feature-spread-container'>
			<div>
				<p class='era-title'>The Modern & Contemporary Eras</p>
				<p class='era-subtitle' style='margin-bottom: 5vh;'>Era overview</p>
				<p class='feature-para'>Plotting measures in a feature space representing movement diversity and repetition, we can get a sense of the nature of the movement of each dance.</p>
			</div>
			<img id='modern-era-choreo-radials' class='desktop grid-radials' src="{{ url_for('static', filename='assets/contemporary-era-radial-grid.svg') }}" alt="contemporary choreo radials">
			<!-- <img id='modern-era-choreo-radials' class='mobile grid-radials' src="{{ url_for('static', filename='assets/contemporary-era-radial-grid-mobile.svg') }}" alt="contemporary choreo radials"> -->
		</div>
	</div>

	<div id='classical-era-feature-spread' class='blade desktop'>
			<div class='feature-spread-container'>
				<div>
					<p class='era-title'>The Classical Era</p>
					<p class='feature-title'>Coppélia, 1870</p>
					<p class='era-title' style='margin-top: 0;'>Arthur Michel Saint-Léon</p>
					<p class='feature-para'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin laoreet, ligula 
							in lacinia porttitor, leo metus vehicula turpis, et consequat felis lorem nec elit. Fusce augue arcu, facilisis nec 
							posuere quis, ullamcorper sed neque. Pellentesque et eros tellus. Suspendisse id ex scelerisque, venenatis tortor nec, 
							sodales tellus. Praesent dui libero, vehicula placerat consequat et, laoreet vitae justo. Sed in dignissim dolor.</p>
				</div>
				<img id='coppelia-feature-choreo-radials' class='desktop feature-choreo-radials' src="{{ url_for('static', filename='assets/coppelia-radials.svg') }}" alt="coppelia 1870 choreo radials">
				<!-- <img id='coppelia-feature-choreo-radials' class='desktop feature-choreo-radials' src="{{ url_for('static', filename='assets/coppelia-radials-names-below-illus-white-blobs.svg') }}" alt="coppelia 1870 choreo radials"> -->
				<!-- <img id='artifact-feature-choreo-radials' class='mobile' src="{{ url_for('static', filename='assets/artifact-radials-vert-names-right-illus.svg') }}" alt="artifact 1984 choreo radials"> -->
			</div>
	</div>
	<div id='classical-era-vis-spread' class='blade desktop'>
			<p class='era-title left-margin'>The Classical Era</p>
			<p class='era-subtitle left-margin' style='margin-bottom: 5vh;'>Radial playback with scores</p>
			<div class='spread-container'>
				<div id='coppelia-column' class="column-within-blade c">
						<span>
							<p class='column-title'>Coppélia, 1870</p>
						</span>
						<p class='column-paragraph para centered'>Arthur Michel Saint-Leon<br></p>
						<div id="coppelia-slider-container" class='slider-container'>
							<button id="coppelia-play-button" class='play-button'>&#9658;</button>
							<button id="coppelia-pause-button" class='play-button button-enabled'>❚❚</button>
							<input type='range' min='0' max='139' step='1' value='0' id='coppelia-slider' class='slider'/> 
						</div>
						<div id='coppelia-choreo-radial' class='choreo-radial'></div>
				</div>
				<div id='sleepingbeauty-column' class="column-within-blade b">
						<span>
							<p class='column-title'>Sleeping Beauty, 1890</p>
						</span>
						<p class='column-paragraph para centered'>Marius Petipa<br></p>
						<div id="sleepingbeauty-slider-container" class='slider-container'>
								<button id="sleepingbeauty-play-button" class='play-button'>&#9658;</button>
								<button id="sleepingbeauty-pause-button" class='play-button button-enabled'>❚❚</button>
							<input type='range' min='0' max='200' step='1' value='0' id='sleepingbeauty-slider' class='slider'/> 
						</div>
						<div id='sleepingbeauty-choreo-radial' class='choreo-radial'></div>
				</div>
				<div id='raymonda-column' class="column-within-blade a">
						<span>
							<p class='column-title'>Raymonda, 1898</p>
						</span>
						<p class='column-paragraph para centered'>Marius Petipa<br></p>
						<div id="raymonda-slider-container" class='slider-container'>
							<button id="raymonda-play-button" class='play-button'>&#9658;</button>
							<button id="raymonda-pause-button" class='play-button button-enabled'>❚❚</button>
							<input type='range' min='0' max='211' step='1' value='0' id='raymonda-slider' class='slider'/> 
						</div>
						<div id="raymonda-choreo-radial" class='choreo-radial'></div>
						
				</div>
			</div>
	</div>
	<div id='classical-feture-spread-container' class='feature-spread-container desktop'>
			<div>
				<p class='era-title'>The Classical Era</p>
				<p class='era-subtitle'>Era overview</p>
				<p class='feature-para'>Plotting measures in a feature space representing movement diversity and repetition, we can get a sense of the nature of the movement of each dance.</p>
			</div>
			<img id='modern-era-choreo-radials' class='desktop grid-radials' src="{{ url_for('static', filename='assets/classical-era-radial-grid.svg') }}" alt="contemporary choreo radials">
			<!-- <img id='modern-era-choreo-radials' class='mobile grid-radials' src="{{ url_for('static', filename='assets/contemporary-era-radial-grid-mobile.svg') }}" alt="contemporary choreo radials"> -->
		</div>
	</div>
	<div id='pre-overview' class='blade desktop'>
			<div class='two-column-spread'>
					<img id='outro-p' class='intro-p' src="{{ url_for('static', filename='assets/outro-p.svg') }}" alt="">
			</div>
		</div>
	<div id='overview' class='blade desktop'>
		<div class='feature-spread-container'>
			<p class='era-title'>In Overview</p>
			<img id='overview-choreo-radials' class='desktop' src="{{ url_for('static', filename='assets/overview-radial-grid-timeline.svg') }}" alt="taxonomy timeline">
		</div>
	</div>
	<div id='colophon' class='blade desktop'>
			<div class='feature-spread-container'>
				<img id='colophon-img' class='desktop centered' src="{{ url_for('static', filename='assets/colophon.svg') }}" alt="taxonomy timeline">
			</div>
		</div>
	<main>
	{% block main %}{% endblock %}
	</main>
	{% block script %}{% endblock %}
</body>
<script>

	var MOBILE = false;
	// Maybe just have static images on mobile?
	function myFunction(x) {	
		if (x.matches) { 
			// If media query matches --> MOBILE
			// $('#classical-era-feature-spread').hide()
			$('#classical-era-vis-overview-spread').hide()
			// $('#classical-era-vis-spread').hide()
			$('.mobile').show()
			$('.desktop').hide()
			$('#title').show()
			MOBILE = true;
		} else {
			// DESKTOP
			// $('#classical-era-feature-spread').show()
			// $('#classical-era-vis-overview-spread').show()
			// $('#classical-era-vis-spread').show()
			$('.desktop').show()
			$('.mobile').hide()
			MOBILE = false;
		}
	}

	var x = window.matchMedia("(max-width: 1024px)")
	myFunction(x) // Call listener function at run time
	x.addListener(myFunction) // Attach listener function on state changes


	const datapath = "static/data/"
	var stepCircleColor = "black"
	var stepCircleAlpha = 0.3
	var dataset; // global
	var numRadialSpokes = 8
	var randJitter = false
	// var lineRes = 0.005
	var lineRes = 0.05
	var curveAlpha = 0.55
	var radialLineWidth = 0.5
	var radiusMult = 150 //this has to do with the spikes
	var radiusOutwardMult = 1.8 //scaling to the page
	var curveType = 'basis'
	var stepLengthMultipier = 2
	var weightCircleColor = "black"
	// var animateColor = "#D2D627"
	var animateColor = "black"
	var weightCircleSize = 1.8

	function getRandomNumber(start, end) {
		return (Math.random() * (end-start) * 100)/100 + start;
	}
	function degrees_to_radians(degrees) {
		var pi = Math.PI;
		return degrees * (pi/180);
	}
	function radians_to_degrees(rad) {
		var pi = Math.PI;
		return rad * (180/pi);
	}

	var	outerRadius = Math.min(width, height, 250)/2,
				innerRadius = outerRadius * 0.4;

	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Helper functions /////////////////////////////
	///////////////////////////////////////////////////////////////////////////
	var spokeArr = d3.range(10,359,359/numRadialSpokes)
	var spokeArrRad = spokeArr.map(x => degrees_to_radians(x))
	var bodyMovements = [
							"head",
							"right_hand",
							"right_arm",
							"right_body",
							"right_leg",
							"right_support",
							"left_support",
							"left_leg",
							"left_body",
							"left_arm",
							"left_hand"
						]
	function staffNumToRad(staff_num){
		return parseInt(staff_num);
	}
	function bodyMovementToTheta(body_movement){
		switch(body_movement){
			case "right_arm":
				return spokeArr[2];
			case "left_arm":
				return spokeArr[9];
			case "right_leg":
				return spokeArr[4];
			case "left_leg":
				return spokeArr[7];
			case "right_support":
				return spokeArr[5];
			case "left_support":
				return spokeArr[6];
			case "right_hand":
				return spokeArr[1];
			case "left_hand":
				return spokeArr[10];
			case "right_body":
				return spokeArr[3];
			case "left_body":
				return spokeArr[8];
			case "head":
				return spokeArr[0];
		}
	}
	function bodyDirectionToTheta(body_movement, direction){
		switch(direction){
			case "place":
				return -1;
			case "forward":
				return spokeArr[0]
			case "forward_diagonal":
				if (body_movement.includes("right")){
					return spokeArr[1]
				} else {
					return spokeArr[7]
				}
			case "right":
				return spokeArr[2];
			case "backward_diagonal":
				if (body_movement.includes("right")){
					return spokeArr[3]
				} else {
					return spokeArr[5]
				}
			case "backward":
				return spokeArr[4];
			case "left":
				return spokeArr[6];
		}
	}
	if (curveType == 'catmull'){var lineRadial = d3.lineRadial().curve(d3.curveCatmullRom.alpha(curveAlpha));}
	if (curveType == 'basis'){var lineRadial = d3.lineRadial().curve(d3.curveBasis);}

	var margin = {
		top: 0,
		right: 0,
		bottom: 0,
		left: 0
	};

	var width = 200 - margin.left - margin.right;
	var height = 200 - margin.top - margin.bottom;


///////////////////////////////////////////////////////////////////////////
/////////////////////////// Coppélia, Petipa //////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
var coppelia_dataset;
var coppelia_svg;
var coppelia_defs;
var radiusOutwardMult_coppelia = 0.8;
var coppelia_measures = [
			   {
			      "index":0,
			      "ballet":"coppelia_dawn",
			      "ymin":278.5877834129,
			      "ymax":515.9102960919,
			      "label":"measure_5",
			      "step_length":237.322512679,
			      "img_num":"1",
			      "img_staff_num":"1",
			      "staff_num":1,
			      "measure_num":"5"
			   },
			   {
			      "index":1,
			      "ballet":"coppelia_dawn",
			      "ymin":990.0759994033,
			      "ymax":1225.4303867094,
			      "label":"measure_2",
			      "step_length":235.3543873061,
			      "img_num":"1",
			      "img_staff_num":"1",
			      "staff_num":1,
			      "measure_num":"2"
			   },
			   {
			      "index":2,
			      "ballet":"coppelia_dawn",
			      "ymin":1227.1879008801,
			      "ymax":1558.0,
			      "label":"measure_1",
			      "step_length":330.8120991199,
			      "img_num":"1",
			      "img_staff_num":"1",
			      "staff_num":1,
			      "measure_num":"1"
			   },
			   {
			      "index":3,
			      "ballet":"coppelia_dawn",
			      "ymin":43.2043462858,
			      "ymax":276.3727345615,
			      "label":"measure_6",
			      "step_length":233.1683882757,
			      "img_num":"1",
			      "img_staff_num":"1",
			      "staff_num":1,
			      "measure_num":"6"
			   },
			   {
			      "index":4,
			      "ballet":"coppelia_dawn",
			      "ymin":516.0918574732,
			      "ymax":752.0998657518,
			      "label":"measure_4",
			      "step_length":236.0080082786,
			      "img_num":"1",
			      "img_staff_num":"1",
			      "staff_num":1,
			      "measure_num":"4"
			   },
			   {
			      "index":5,
			      "ballet":"coppelia_dawn",
			      "ymin":754.1987153192,
			      "ymax":984.8470316229,
			      "label":"measure_3",
			      "step_length":230.6483163037,
			      "img_num":"1",
			      "img_staff_num":"1",
			      "staff_num":1,
			      "measure_num":"3"
			   },
			   {
			      "index":10,
			      "ballet":"coppelia_dawn",
			      "ymin":23.4366050119,
			      "ymax":260.9498899911,
			      "label":"measure_11",
			      "step_length":237.5132849791,
			      "img_num":"1",
			      "img_staff_num":"2",
			      "staff_num":2,
			      "measure_num":"11"
			   },
			   {
			      "index":11,
			      "ballet":"coppelia_dawn",
			      "ymin":262.502918034,
			      "ymax":494.6511970465,
			      "label":"measure_10",
			      "step_length":232.1482790125,
			      "img_num":"1",
			      "img_staff_num":"2",
			      "staff_num":2,
			      "measure_num":"10"
			   },
			   {
			      "index":12,
			      "ballet":"coppelia_dawn",
			      "ymin":495.4630071599,
			      "ymax":735.2823034755,
			      "label":"measure_9",
			      "step_length":239.8192963156,
			      "img_num":"1",
			      "img_staff_num":"2",
			      "staff_num":2,
			      "measure_num":"9"
			   },
			   {
			      "index":13,
			      "ballet":"coppelia_dawn",
			      "ymin":976.3134322792,
			      "ymax":1216.709231429,
			      "label":"measure_7",
			      "step_length":240.3957991498,
			      "img_num":"1",
			      "img_staff_num":"2",
			      "staff_num":2,
			      "measure_num":"7"
			   },
			   {
			      "index":14,
			      "ballet":"coppelia_dawn",
			      "ymin":736.5294320555,
			      "ymax":971.8955381116,
			      "label":"measure_8",
			      "step_length":235.3661060561,
			      "img_num":"1",
			      "img_staff_num":"2",
			      "staff_num":2,
			      "measure_num":"8"
			   },
			   {
			      "index":51,
			      "ballet":"coppelia_dawn",
			      "ymin":970.8637380668,
			      "ymax":1208.7348970764,
			      "label":"measure_12",
			      "step_length":237.8711590095,
			      "img_num":"1",
			      "img_staff_num":"3",
			      "staff_num":3,
			      "measure_num":"12"
			   },
			   {
			      "index":52,
			      "ballet":"coppelia_dawn",
			      "ymin":19.2093153341,
			      "ymax":254.5395286396,
			      "label":"measure_16",
			      "step_length":235.3302133055,
			      "img_num":"1",
			      "img_staff_num":"3",
			      "staff_num":3,
			      "measure_num":"16"
			   },
			   {
			      "index":53,
			      "ballet":"coppelia_dawn",
			      "ymin":256.5769689737,
			      "ymax":492.0359859785,
			      "label":"measure_15",
			      "step_length":235.4590170048,
			      "img_num":"1",
			      "img_staff_num":"3",
			      "staff_num":3,
			      "measure_num":"15"
			   },
			   {
			      "index":54,
			      "ballet":"coppelia_dawn",
			      "ymin":494.3895808473,
			      "ymax":728.4259024463,
			      "label":"measure_14",
			      "step_length":234.036321599,
			      "img_num":"1",
			      "img_staff_num":"3",
			      "staff_num":3,
			      "measure_num":"14"
			   },
			   {
			      "index":55,
			      "ballet":"coppelia_dawn",
			      "ymin":733.1272374702,
			      "ymax":968.5335620525,
			      "label":"measure_13",
			      "step_length":235.4063245823,
			      "img_num":"1",
			      "img_staff_num":"3",
			      "staff_num":3,
			      "measure_num":"13"
			   },
			   {
			      "index":70,
			      "ballet":"coppelia_dawn",
			      "ymin":18.0570368437,
			      "ymax":257.4679295943,
			      "label":"measure_21",
			      "step_length":239.4108927506,
			      "img_num":"1",
			      "img_staff_num":"4",
			      "staff_num":4,
			      "measure_num":"21"
			   },
			   {
			      "index":71,
			      "ballet":"coppelia_dawn",
			      "ymin":972.0537365752,
			      "ymax":1211.2222926611,
			      "label":"measure_17",
			      "step_length":239.1685560859,
			      "img_num":"1",
			      "img_staff_num":"4",
			      "staff_num":4,
			      "measure_num":"17"
			   },
			   {
			      "index":72,
			      "ballet":"coppelia_dawn",
			      "ymin":260.5060038783,
			      "ymax":494.7568988663,
			      "label":"measure_20",
			      "step_length":234.2508949881,
			      "img_num":"1",
			      "img_staff_num":"4",
			      "staff_num":4,
			      "measure_num":"20"
			   },
			   {
			      "index":73,
			      "ballet":"coppelia_dawn",
			      "ymin":495.2652147971,
			      "ymax":732.89700179,
			      "label":"measure_19",
			      "step_length":237.6317869928,
			      "img_num":"1",
			      "img_staff_num":"4",
			      "staff_num":4,
			      "measure_num":"19"
			   },
			   {
			      "index":74,
			      "ballet":"coppelia_dawn",
			      "ymin":735.0721211217,
			      "ymax":970.9484449582,
			      "label":"measure_18",
			      "step_length":235.8763238365,
			      "img_num":"1",
			      "img_staff_num":"4",
			      "staff_num":4,
			      "measure_num":"18"
			   },
			   {
			      "index":105,
			      "ballet":"coppelia_dawn",
			      "ymin":489.4701484189,
			      "ymax":727.7855384845,
			      "label":"measure_24",
			      "step_length":238.3153900656,
			      "img_num":"2",
			      "img_staff_num":"1",
			      "staff_num":5,
			      "measure_num":"24"
			   },
			   {
			      "index":106,
			      "ballet":"coppelia_dawn",
			      "ymin":968.5108144391,
			      "ymax":1209.854303401,
			      "label":"measure_22",
			      "step_length":241.3434889618,
			      "img_num":"2",
			      "img_staff_num":"1",
			      "staff_num":5,
			      "measure_num":"22"
			   },
			   {
			      "index":107,
			      "ballet":"coppelia_dawn",
			      "ymin":16.8062350835,
			      "ymax":254.6980347554,
			      "label":"measure_26",
			      "step_length":237.8917996718,
			      "img_num":"2",
			      "img_staff_num":"1",
			      "staff_num":5,
			      "measure_num":"26"
			   },
			   {
			      "index":108,
			      "ballet":"coppelia_dawn",
			      "ymin":256.1004624105,
			      "ymax":485.841009099,
			      "label":"measure_25",
			      "step_length":229.7405466885,
			      "img_num":"2",
			      "img_staff_num":"1",
			      "staff_num":5,
			      "measure_num":"25"
			   },
			   {
			      "index":109,
			      "ballet":"coppelia_dawn",
			      "ymin":730.6132905728,
			      "ymax":968.0414304893,
			      "label":"measure_23",
			      "step_length":237.4281399165,
			      "img_num":"2",
			      "img_staff_num":"1",
			      "staff_num":5,
			      "measure_num":"23"
			   },
			   {
			      "index":146,
			      "ballet":"coppelia_dawn",
			      "ymin":11.8287589499,
			      "ymax":249.1148008652,
			      "label":"measure_31",
			      "step_length":237.2860419153,
			      "img_num":"2",
			      "img_staff_num":"2",
			      "staff_num":6,
			      "measure_num":"31"
			   },
			   {
			      "index":147,
			      "ballet":"coppelia_dawn",
			      "ymin":249.5925007458,
			      "ymax":487.3619294451,
			      "label":"measure_30",
			      "step_length":237.7694286993,
			      "img_num":"2",
			      "img_staff_num":"2",
			      "staff_num":6,
			      "measure_num":"30"
			   },
			   {
			      "index":148,
			      "ballet":"coppelia_dawn",
			      "ymin":488.2945815931,
			      "ymax":724.4887380668,
			      "label":"measure_29",
			      "step_length":236.1941564737,
			      "img_num":"2",
			      "img_staff_num":"2",
			      "staff_num":6,
			      "measure_num":"29"
			   },
			   {
			      "index":149,
			      "ballet":"coppelia_dawn",
			      "ymin":726.7009434666,
			      "ymax":960.6942683473,
			      "label":"measure_28",
			      "step_length":233.9933248807,
			      "img_num":"2",
			      "img_staff_num":"2",
			      "staff_num":6,
			      "measure_num":"28"
			   },
			   {
			      "index":150,
			      "ballet":"coppelia_dawn",
			      "ymin":962.9292213604,
			      "ymax":1205.9306011337,
			      "label":"measure_27",
			      "step_length":243.0013797733,
			      "img_num":"2",
			      "img_staff_num":"2",
			      "staff_num":6,
			      "measure_num":"27"
			   },
			   {
			      "index":191,
			      "ballet":"coppelia_dawn",
			      "ymin":263.9983591885,
			      "ymax":498.754176611,
			      "label":"measure_35",
			      "step_length":234.7558174224,
			      "img_num":"2",
			      "img_staff_num":"3",
			      "staff_num":7,
			      "measure_num":"35"
			   },
			   {
			      "index":192,
			      "ballet":"coppelia_dawn",
			      "ymin":23.8787291169,
			      "ymax":264.3831294749,
			      "label":"measure_36",
			      "step_length":240.504400358,
			      "img_num":"2",
			      "img_staff_num":"3",
			      "staff_num":7,
			      "measure_num":"36"
			   },
			   {
			      "index":193,
			      "ballet":"coppelia_dawn",
			      "ymin":976.9375,
			      "ymax":1218.0219272076,
			      "label":"measure_32",
			      "step_length":241.0844272076,
			      "img_num":"2",
			      "img_staff_num":"3",
			      "staff_num":7,
			      "measure_num":"32"
			   },
			   {
			      "index":194,
			      "ballet":"coppelia_dawn",
			      "ymin":500.3679146778,
			      "ymax":742.0955399761,
			      "label":"measure_34",
			      "step_length":241.7276252983,
			      "img_num":"2",
			      "img_staff_num":"3",
			      "staff_num":7,
			      "measure_num":"34"
			   },
			   {
			      "index":195,
			      "ballet":"coppelia_dawn",
			      "ymin":740.8952863962,
			      "ymax":974.2441079952,
			      "label":"measure_33",
			      "step_length":233.348821599,
			      "img_num":"2",
			      "img_staff_num":"3",
			      "staff_num":7,
			      "measure_num":"33"
			   },
			   {
			      "index":237,
			      "ballet":"coppelia_dawn",
			      "ymin":260.236798926,
			      "ymax":493.8727625298,
			      "label":"measure_40",
			      "step_length":233.6359636038,
			      "img_num":"2",
			      "img_staff_num":"4",
			      "staff_num":8,
			      "measure_num":"40"
			   },
			   {
			      "index":238,
			      "ballet":"coppelia_dawn",
			      "ymin":497.3816378282,
			      "ymax":737.455325179,
			      "label":"measure_39",
			      "step_length":240.0736873508,
			      "img_num":"2",
			      "img_staff_num":"4",
			      "staff_num":8,
			      "measure_num":"39"
			   },
			   {
			      "index":239,
			      "ballet":"coppelia_dawn",
			      "ymin":738.178923031,
			      "ymax":974.9332488067,
			      "label":"measure_38",
			      "step_length":236.7543257757,
			      "img_num":"2",
			      "img_staff_num":"4",
			      "staff_num":8,
			      "measure_num":"38"
			   },
			   {
			      "index":240,
			      "ballet":"coppelia_dawn",
			      "ymin":975.8291318616,
			      "ymax":1216.7470167064,
			      "label":"measure_37",
			      "step_length":240.9178848449,
			      "img_num":"2",
			      "img_staff_num":"4",
			      "staff_num":8,
			      "measure_num":"37"
			   },
			   {
			      "index":241,
			      "ballet":"coppelia_dawn",
			      "ymin":23.0173031026,
			      "ymax":261.5519093079,
			      "label":"measure_41",
			      "step_length":238.5346062053,
			      "img_num":"2",
			      "img_staff_num":"4",
			      "staff_num":8,
			      "measure_num":"41"
			   }
			]
			
var coppelia_radArr = [];
var coppelia_dataArr = [];
var coppelia_data = [];
var coppelia_dataStyling = [];
var radialWrappercoppelia;
var circleWrappercoppelia; 
var coppeliaButton = document.getElementById("coppelia-play-button");
var coppeliaAudio = document.getElementById("coppelia-audio");

// if (!MOBILE)
d3.json(datapath+'coppelia_dawn'+".json", function(coppelia_data) {
	coppelia_dataset = coppelia_data;

	//SVG container
	coppelia_svg = d3.select("#coppelia-choreo-radial")
		.append("svg")
		// .attr("width", 200)
		// .attr("height", 200)
		.attr("viewBox", `0 0 400 400`)
		.append("g")
		.attr("transform", "translate(" + 200 + "," + 200 + ")");
		// .attr("transform", "translate(" + 150 + "," + 100 + ")");

	//Container for the gradients
	coppelia_defs = coppelia_svg.append("defs");

	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Create scales ////////////////////////////////
	///////////////////////////////////////////////////////////////////////////

	// Playback time
	// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
	coppelia_dataset.forEach(function(d, i) {
		measNum = +d.measure_num
		meas_ymin = coppelia_measures.filter(x=>+x.measure_num==measNum)[0].ymax
		step_ymin = +d.ymax
		d.playbackTime = (measNum + (step_ymin)/50) * 4
		d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
		d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
		tmp = coppelia_dataset.slice(0,i).map(x=>x.thetaRad)
		if (tmp.length > 0){
			tmp = tmp.reduce((a, b) => a + b) / tmp.length;
			d.weightDist = tmp
		}else {
			d.weightDist = 0
		}
	});
	
	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Radial line //////////////////////////////////
	///////////////////////////////////////////////////////////////////////////
	coppelia_dataset = coppelia_dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
	
	coppelia_radArr = coppelia_dataset.map(x=>(x.playbackTime)*radiusOutwardMult_coppelia)
	// Nonzero radii
	coppelia_radArr = coppelia_radArr.filter(x=>x>0)
	
	function findClosest(num, spoke){
		if (Math.abs(num[0] - spoke) <= 0.03) return 1
	}
	for (ii = 0; ii < coppelia_radArr.length; ii++) {
		if(coppelia_dataset[ii].body_movement!=null){
			coppelia_data = []
			for (i = 0; i <= 2+lineRes; i=i+lineRes) {
			if (randJitter) {coppelia_data.push([Math.PI * i, coppelia_radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
			if (!randJitter) {coppelia_data.push([Math.PI * i, coppelia_radArr[ii] ])}
			}
			coppelia_dataStyling.push({'body_movement' : coppelia_dataset[ii].body_movement,
							'step_length' : coppelia_dataset[ii].step_length * stepLengthMultipier,
							'playback_time': coppelia_dataset[ii].playbackTime,
							'weight_dist': coppelia_dataset[ii].weightDist})
			arr = spokeArrRad
			num = degrees_to_radians(coppelia_dataset[ii].theta)
			var closestSpoke = arr.reduce(function(prev, curr) {
				return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
			});
			
			// find theta closest to chosen spokeArr
			if (coppelia_dataset[ii].direction_movement!='place'){
				index = coppelia_data.findIndex(x => findClosest(x, closestSpoke));
				coppelia_data[index] = [coppelia_data[index][0], coppelia_radArr[ii]+coppelia_dataset[ii].step_length * radiusMult]
				coppelia_dataArr.push({coppelia_data})
			}
		}
	}
	
	coppelia_dataset.forEach(function(d, i) {
		d.slider_time = i;
	})

	radialWrappercoppelia = coppelia_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");
	circleWrappercoppelia = coppelia_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");

	for (i = 0; i < coppelia_dataArr.length; i++) {
		className = "coppelia"
		curRadialLineWidth = coppelia_dataStyling[i].step_length
		curPlaybackTime = coppelia_dataStyling[i].playback_time
		radialWrappercoppelia
			.append("path")
			.attr("d", lineRadial(coppelia_dataArr[i].coppelia_data))
			.attr("class", className)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", "black")
			.style("filter", "url(#glow)")
			.attr("opacity", 0.7)
		circleWrappercoppelia
			.append("circle")
				.attr("opacity", 0.5)
				.attr("class", className)
				.attr("cy", coppelia_dataArr[i].coppelia_data[0][1]*Math.sin(coppelia_dataStyling[i].weight_dist))
				.attr("cx", coppelia_dataArr[i].coppelia_data[0][1]*Math.cos(coppelia_dataStyling[i].weight_dist))
				.attr("r", weightCircleSize)
				.style("filter", "url(#glow)")
				.style('fill', weightCircleColor)
	}
	
	// NO DELAY, JUST CALL IMMEDIATELY TO SHOW THROUGH UPDATE. USE THE PLAYBACKTIME IN UPDATE CALL
	function update(timePoint) {
		if(timePoint == 1 || timePoint == 0){
			d3.selectAll('.coppelia')
				.remove()
		}
		// for (i = 0; i < artifact_dataArr.length; i++) {
		className = "coppelia"
		curRadialLineWidth = coppelia_dataStyling[timePoint].step_length
		curPlaybackTime = coppelia_dataStyling[timePoint].playback_time
		radialWrappercoppelia
			.append("path")
			.attr("d", lineRadial(coppelia_dataArr[timePoint].coppelia_data))
			.attr("class", className)
			.attr("opacity", 0)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", animateColor)
			.style("filter", "url(#glow)")
			.transition()
			// .delay( (curPlaybackTime-14)*900)
			// .delay( (curPlaybackTime-25))
				.duration( 1 )
				.attr("opacity", 0.7)
			// .transition()
			// 	.ease(d3.easeLinear)
			// 	.duration(200)
			// 	.attr("stroke", "black")
		circleWrappercoppelia
			.append("circle")
				.attr("opacity", 0)
				.attr("cy", coppelia_dataArr[timePoint].coppelia_data[0][1]*Math.sin(coppelia_dataStyling[timePoint].weight_dist))
				.attr("cx", coppelia_dataArr[timePoint].coppelia_data[0][1]*Math.cos(coppelia_dataStyling[timePoint].weight_dist))
				.attr("r", weightCircleSize)
				.attr("class", className)
				.style('fill', weightCircleColor)
				.transition()
				// .delay( (curPlaybackTime-14)*900)
				// .delay( (curPlaybackTime-25))
					.duration( 1 )
						.attr("opacity", 0.5)
	// }
	};

	//Run the update function when the slider is changed
	d3.select('#coppelia-slider').on('input', function() {
		update(this.value); // PASSING IN THE INDEX
	});

	var myTimer;
	var t = 0;
	d3.select("#coppelia-play-button").on("click", function() {
		$("#coppelia-play-button").addClass('button-enabled')
		$("#coppelia-pause-button").removeClass('button-enabled')
		coppeliaAudio.play();
		clearInterval (myTimer);
		myTimer = setInterval (function() {
			var b = d3.select("#coppelia-slider");
			t = (+b.property("value") + 1) % (+b.property("max") + 1);
			curPlaybackTime = (coppelia_dataset.filter(x=>x.slider_time==t)[0].playbackTime)*2000
			if (t == 0) { t = +b.property("min"); }
			if (t >= 139){
				$("#coppelia-pause-button").addClass('button-enabled')
				$("#coppelia-play-button").removeClass('button-enabled')
				clearInterval (myTimer);
				return
			}
			b.property("value", t);
			update (t);
		// }, 300);
		}, 520);
	});

	d3.select("#coppelia-pause-button").on("click", function() {
		$("#coppelia-pause-button").addClass('button-enabled')
		$("#coppelia-play-button").removeClass('button-enabled')
		clearInterval (myTimer);
		coppeliaAudio.pause();
	});
})


///////////////////////////////////////////////////////////////////////////
/////////////////////////// sleepingbeauty, Petipa //////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
var sleepingbeauty_dataset;
var sleepingbeauty_svg;
var sleepingbeauty_defs;
var radiusOutwardMult_sleepingbeauty = 0.8;
var sleepingbeauty_measures = [{"index": 0, "ballet": "sleepingbeauty_bluebird", "ymin": 26.9291408014, "ymax": 436.2625211625, "label": "measure_4", "step_length": 409.3333803612, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "4"}, {"index": 1, "ballet": "sleepingbeauty_bluebird", "ymin": 435.355530474, "ymax": 836.5064193002, "label": "measure_3", "step_length": 401.1508888262, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "3"}, {"index": 2, "ballet": "sleepingbeauty_bluebird", "ymin": 835.2144469526, "ymax": 1233.3442085214, "label": "measure_2", "step_length": 398.1297615688, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 3, "ballet": "sleepingbeauty_bluebird", "ymin": 1230.8320400677, "ymax": 1342.9922051354, "label": "measure_1", "step_length": 112.1601650677, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 56, "ballet": "sleepingbeauty_bluebird", "ymin": 846.4435136851, "ymax": 1252.9213988431, "label": "measure_5", "step_length": 406.477885158, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "5"}, {"index": 57, "ballet": "sleepingbeauty_bluebird", "ymin": 33.7876163939, "ymax": 446.6262697517, "label": "measure_7", "step_length": 412.8386533578, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "7"}, {"index": 58, "ballet": "sleepingbeauty_bluebird", "ymin": 448.7023137698, "ymax": 848.7675296275, "label": "measure_6", "step_length": 400.0652158578, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "6"}, {"index": 132, "ballet": "sleepingbeauty_bluebird", "ymin": 20.7155756208, "ymax": 422.8180727991, "label": "measure_10", "step_length": 402.1024971783, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "10"}, {"index": 133, "ballet": "sleepingbeauty_bluebird", "ymin": 424.7204077314, "ymax": 824.8978555305, "label": "measure_9", "step_length": 400.1774477991, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "9"}, {"index": 134, "ballet": "sleepingbeauty_bluebird", "ymin": 827.0386921558, "ymax": 1231.3047404063, "label": "measure_8", "step_length": 404.2660482506, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "8"}, {"index": 190, "ballet": "sleepingbeauty_bluebird", "ymin": 39.7340222912, "ymax": 479.2630149549, "label": "measure_13", "step_length": 439.5289926637, "img_num": "2", "img_staff_num": "1", "staff_num": 4, "measure_num": "13"}, {"index": 191, "ballet": "sleepingbeauty_bluebird", "ymin": 482.7102320824, "ymax": 876.6502186795, "label": "measure_12", "step_length": 393.9399865971, "img_num": "2", "img_staff_num": "1", "staff_num": 4, "measure_num": "12"}, {"index": 192, "ballet": "sleepingbeauty_bluebird", "ymin": 877.9774266366, "ymax": 1282.8756877822, "label": "measure_11", "step_length": 404.8982611456, "img_num": "2", "img_staff_num": "1", "staff_num": 4, "measure_num": "11"}, {"index": 251, "ballet": "sleepingbeauty_bluebird", "ymin": 34.1857100028, "ymax": 100.551504303, "label": "measure_17", "step_length": 66.3657943002, "img_num": "2", "img_staff_num": "2", "staff_num": 5, "measure_num": "17"}, {"index": 252, "ballet": "sleepingbeauty_bluebird", "ymin": 100.1972171275, "ymax": 496.8907660835, "label": "measure_16", "step_length": 396.693548956, "img_num": "2", "img_staff_num": "2", "staff_num": 5, "measure_num": "16"}, {"index": 253, "ballet": "sleepingbeauty_bluebird", "ymin": 498.3739683267, "ymax": 903.9006772009, "label": "measure_15", "step_length": 405.5267088742, "img_num": "2", "img_staff_num": "2", "staff_num": 5, "measure_num": "15"}, {"index": 254, "ballet": "sleepingbeauty_bluebird", "ymin": 905.3118210356, "ymax": 1304.3532731377, "label": "measure_14", "step_length": 399.0414521021, "img_num": "2", "img_staff_num": "2", "staff_num": 5, "measure_num": "14"}, {"index": 285, "ballet": "sleepingbeauty_bluebird", "ymin": 25.8961625282, "ymax": 429.0990759029, "label": "measure_20", "step_length": 403.2029133747, "img_num": "2", "img_staff_num": "3", "staff_num": 6, "measure_num": "20"}, {"index": 286, "ballet": "sleepingbeauty_bluebird", "ymin": 493.8099781321, "ymax": 889.1015801354, "label": "measure_18", "step_length": 395.2916020034, "img_num": "2", "img_staff_num": "3", "staff_num": 6, "measure_num": "18"}, {"index": 287, "ballet": "sleepingbeauty_bluebird", "ymin": 429.4404803894, "ymax": 493.1777476016, "label": "measure_19", "step_length": 63.7372672122, "img_num": "2", "img_staff_num": "3", "staff_num": 6, "measure_num": "19"}]
var sleepingbeauty_radArr = [];
var sleepingbeauty_dataArr = [];
var sleepingbeauty_data = [];
var sleepingbeauty_dataStyling = [];
var radialWrappersleepingbeauty;
var circleWrappersleepingbeauty; 
var sleepingbeautyButton = document.getElementById("sleepingbeauty-play-button");
var sleepingbeautyAudio = document.getElementById("sleepingbeauty-audio");


d3.json(datapath+'sleepingbeauty_bluebird'+".json", function(sleepingbeauty_data) {
	sleepingbeauty_dataset = sleepingbeauty_data;

	//SVG container
	sleepingbeauty_svg = d3.select("#sleepingbeauty-choreo-radial")
		.append("svg")
		// .attr("width", 200)
		// .attr("height", 200)
		.attr("viewBox", `0 0 400 400`)
		.append("g")
		.attr("transform", "translate(" + 200 + "," + 200 + ")");
		// .attr("transform", "translate(" + 150 + "," + 100 + ")");

	//Container for the gradients
	sleepingbeauty_defs = sleepingbeauty_svg.append("defs");

	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Create scales ////////////////////////////////
	///////////////////////////////////////////////////////////////////////////

	// Playback time
	// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
	sleepingbeauty_dataset.forEach(function(d, i) {
		measNum = +d.measure_num
		meas_ymin = sleepingbeauty_measures.filter(x=>+x.measure_num==measNum)[0].ymax
		step_ymin = +d.ymax
		d.playbackTime = (measNum + (step_ymin)/50) * 4
		d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
		d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
		tmp = sleepingbeauty_dataset.slice(0,i).map(x=>x.thetaRad)
		if (tmp.length > 0){
			tmp = tmp.reduce((a, b) => a + b) / tmp.length;
			d.weightDist = tmp
		}else {
			d.weightDist = 0
		}
	});
	
	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Radial line //////////////////////////////////
	///////////////////////////////////////////////////////////////////////////
	sleepingbeauty_dataset = sleepingbeauty_dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
	
	sleepingbeauty_radArr = sleepingbeauty_dataset.map(x=>(x.playbackTime)*radiusOutwardMult_sleepingbeauty)
	// Nonzero radii
	sleepingbeauty_radArr = sleepingbeauty_radArr.filter(x=>x>0)
	
	function findClosest(num, spoke){
		if (Math.abs(num[0] - spoke) <= 0.03) return 1
	}
	for (ii = 0; ii < sleepingbeauty_radArr.length; ii++) {
		if(sleepingbeauty_dataset[ii].body_movement!=null){
			sleepingbeauty_data = []
			for (i = 0; i <= 2+lineRes; i=i+lineRes) {
			if (randJitter) {sleepingbeauty_data.push([Math.PI * i, sleepingbeauty_radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
			if (!randJitter) {sleepingbeauty_data.push([Math.PI * i, sleepingbeauty_radArr[ii] ])}
			}
			sleepingbeauty_dataStyling.push({'body_movement' : sleepingbeauty_dataset[ii].body_movement,
							'step_length' : sleepingbeauty_dataset[ii].step_length * stepLengthMultipier,
							'playback_time': sleepingbeauty_dataset[ii].playbackTime,
							'weight_dist': sleepingbeauty_dataset[ii].weightDist})
			arr = spokeArrRad
			num = degrees_to_radians(sleepingbeauty_dataset[ii].theta)
			var closestSpoke = arr.reduce(function(prev, curr) {
				return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
			});
			
			// find theta closest to chosen spokeArr
			if (sleepingbeauty_dataset[ii].direction_movement!='place'){
				index = sleepingbeauty_data.findIndex(x => findClosest(x, closestSpoke));
				sleepingbeauty_data[index] = [sleepingbeauty_data[index][0], sleepingbeauty_radArr[ii]+sleepingbeauty_dataset[ii].step_length * radiusMult]
				sleepingbeauty_dataArr.push({sleepingbeauty_data})
			}
		}
	}
	
	sleepingbeauty_dataset.forEach(function(d, i) {
		d.slider_time = i;
	})

	radialWrappersleepingbeauty = sleepingbeauty_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");
	circleWrappersleepingbeauty = sleepingbeauty_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");

	for (i = 0; i < sleepingbeauty_dataArr.length; i++) {
		className = "sleepingbeauty"
		curRadialLineWidth = sleepingbeauty_dataStyling[i].step_length
		curPlaybackTime = sleepingbeauty_dataStyling[i].playback_time
		radialWrappersleepingbeauty
			.append("path")
			.attr("d", lineRadial(sleepingbeauty_dataArr[i].sleepingbeauty_data))
			.attr("class", className)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", "black")
			.style("filter", "url(#glow)")
			.attr("opacity", 0.7)
		circleWrappersleepingbeauty
			.append("circle")
				.attr("opacity", 0.5)
				.attr("class", className)
				.attr("cy", sleepingbeauty_dataArr[i].sleepingbeauty_data[0][1]*Math.sin(sleepingbeauty_dataStyling[i].weight_dist))
				.attr("cx", sleepingbeauty_dataArr[i].sleepingbeauty_data[0][1]*Math.cos(sleepingbeauty_dataStyling[i].weight_dist))
				.attr("r", weightCircleSize)
				.style("filter", "url(#glow)")
				.style('fill', weightCircleColor)
	}

	function update(timePoint) {
		if(timePoint == 1){
			d3.selectAll('.sleepingbeauty')
				.remove()
		}
		// for (i = 0; i < artifact_dataArr.length; i++) {
		className = "sleepingbeauty"
		curRadialLineWidth = sleepingbeauty_dataStyling[timePoint].step_length
		curPlaybackTime = sleepingbeauty_dataStyling[timePoint].playback_time
		radialWrappersleepingbeauty
			.append("path")
			.attr("d", lineRadial(sleepingbeauty_dataArr[timePoint].sleepingbeauty_data))
			.attr("class", className)
			.attr("opacity", 0)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", animateColor)
			.style("filter", "url(#glow)")
			.transition()
			// .delay( (curPlaybackTime-14)*900)
			.delay( (curPlaybackTime-25))
			.attr("opacity", 0.7)
			.transition()
				.ease(d3.easeLinear)
				.duration(200)
				.attr("stroke", "black")
		circleWrappersleepingbeauty
			.append("circle")
				.attr("opacity", 0)
				.attr("cy", sleepingbeauty_dataArr[timePoint].sleepingbeauty_data[0][1]*Math.sin(sleepingbeauty_dataStyling[timePoint].weight_dist))
				.attr("cx", sleepingbeauty_dataArr[timePoint].sleepingbeauty_data[0][1]*Math.cos(sleepingbeauty_dataStyling[timePoint].weight_dist))
				.attr("r", weightCircleSize)
				.attr("class", className)
				.style('fill', weightCircleColor)
				.transition()
				// .delay( (curPlaybackTime-14)*900)
				.delay( (curPlaybackTime-25))
					.attr("opacity", 0.5)
	// }
	};

	//Run the update function when the slider is changed
	d3.select('#sleepingbeauty-slider').on('input', function() {
		update(this.value);
	});

	var myTimer;
	var t = 0;
	d3.select("#sleepingbeauty-play-button").on("click", function() {
		$("#sleepingbeauty-play-button").addClass('button-enabled')
		$("#sleepingbeauty-pause-button").removeClass('button-enabled')
		sleepingbeautyAudio.play();
		clearInterval (myTimer);
		myTimer = setInterval (function() {
			var b = d3.select("#sleepingbeauty-slider");
			t = (+b.property("value") + 1) % (+b.property("max") + 1);
			curPlaybackTime = (sleepingbeauty_dataset.filter(x=>x.slider_time==t)[0].playbackTime)*2000
			if (t == 0) { t = +b.property("min"); }
			if (t >= 200){
				$("#sleepingbeauty-pause-button").addClass('button-enabled')
				$("#sleepingbeauty-play-button").removeClass('button-enabled')
				clearInterval (myTimer);
				return
			}
			b.property("value", t);
			update (t);
		}, 290);
	});

	d3.select("#sleepingbeauty-pause-button").on("click", function() {
		$("#sleepingbeauty-pause-button").addClass('button-enabled')
		$("#sleepingbeauty-play-button").removeClass('button-enabled')
		sleepingbeautyAudio.pause();
		clearInterval (myTimer);
	});
})



///////////////////////////////////////////////////////////////////////////
/////////////////////////// Raymonda, Petipa //////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
var raymonda_dataset;
var raymonda_svg;
var raymonda_defs;
var radiusOutwardMult_raymonda = 0.52;
var raymonda_measures = [{"index": 0, "ballet": "raymonda", "ymin": 969.2144242243, "ymax": 1132.6082935561, "label": "measure_2", "step_length": 163.3938693317, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 1, "ballet": "raymonda", "ymin": 7.8122016706, "ymax": 173.731727327, "label": "measure_8", "step_length": 165.9195256563, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "8"}, {"index": 2, "ballet": "raymonda", "ymin": 1133.0787589499, "ymax": 1302.9539081146, "label": "measure_1", "step_length": 169.8751491647, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 3, "ballet": "raymonda", "ymin": 648.7965393795, "ymax": 813.9608442721, "label": "measure_4", "step_length": 165.1643048926, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "4"}, {"index": 4, "ballet": "raymonda", "ymin": 489.2716288783, "ymax": 651.4212410501, "label": "measure_5", "step_length": 162.1496121718, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "5"}, {"index": 5, "ballet": "raymonda", "ymin": 812.4627834129, "ymax": 969.3506115752, "label": "measure_3", "step_length": 156.8878281623, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "3"}, {"index": 6, "ballet": "raymonda", "ymin": 334.7732696897, "ymax": 490.3549373508, "label": "measure_6", "step_length": 155.5816676611, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "6"}, {"index": 7, "ballet": "raymonda", "ymin": 173.7255369928, "ymax": 335.119928401, "label": "measure_7", "step_length": 161.3943914081, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "7"}, {"index": 42, "ballet": "raymonda", "ymin": 1136.6089461516, "ymax": 1298.4265643646, "label": "measure_9", "step_length": 161.817618213, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "9"}, {"index": 43, "ballet": "raymonda", "ymin": 336.2463454654, "ymax": 498.587867318, "label": "measure_14", "step_length": 162.3415218526, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "14"}, {"index": 44, "ballet": "raymonda", "ymin": 816.8468544899, "ymax": 976.3193802208, "label": "measure_11", "step_length": 159.4725257309, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "11"}, {"index": 45, "ballet": "raymonda", "ymin": 175.4640606354, "ymax": 337.2692049523, "label": "measure_15", "step_length": 161.8051443168, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "15"}, {"index": 46, "ballet": "raymonda", "ymin": 499.6543854415, "ymax": 657.3680918109, "label": "measure_13", "step_length": 157.7137063693, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "13"}, {"index": 47, "ballet": "raymonda", "ymin": 659.164332861, "ymax": 815.412356429, "label": "measure_12", "step_length": 156.248023568, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "12"}, {"index": 48, "ballet": "raymonda", "ymin": 19.5528322643, "ymax": 173.9859039379, "label": "measure_16", "step_length": 154.4330716736, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "16"}, {"index": 49, "ballet": "raymonda", "ymin": 975.9638741796, "ymax": 1132.6983796987, "label": "measure_10", "step_length": 156.7345055191, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "10"}, {"index": 94, "ballet": "raymonda", "ymin": 505.9311605012, "ymax": 660.0089498807, "label": "measure_21", "step_length": 154.0777893795, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "21"}, {"index": 95, "ballet": "raymonda", "ymin": 182.1328684368, "ymax": 338.3968526253, "label": "measure_23", "step_length": 156.2639841885, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "23"}, {"index": 96, "ballet": "raymonda", "ymin": 659.2258353222, "ymax": 819.5098075776, "label": "measure_20", "step_length": 160.2839722554, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "20"}, {"index": 97, "ballet": "raymonda", "ymin": 977.8555713007, "ymax": 1135.104974642, "label": "measure_18", "step_length": 157.2494033413, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "18"}, {"index": 98, "ballet": "raymonda", "ymin": 20.4458159308, "ymax": 182.6288409905, "label": "measure_24", "step_length": 162.1830250597, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "24"}, {"index": 99, "ballet": "raymonda", "ymin": 1133.5256936158, "ymax": 1380.5918108592, "label": "measure_17", "step_length": 247.0661172434, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "17"}, {"index": 100, "ballet": "raymonda", "ymin": 340.609151253, "ymax": 499.3007905728, "label": "measure_22", "step_length": 158.6916393198, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "22"}, {"index": 101, "ballet": "raymonda", "ymin": 823.216549821, "ymax": 976.7983666468, "label": "measure_19", "step_length": 153.5818168258, "img_num": "1", "img_staff_num": "3", "staff_num": 3, "measure_num": "19"}, {"index": 153, "ballet": "raymonda", "ymin": 1133.8679892601, "ymax": 1299.2442198687, "label": "measure_25", "step_length": 165.3762306086, "img_num": "1", "img_staff_num": "4", "staff_num": 4, "measure_num": "25"}, {"index": 154, "ballet": "raymonda", "ymin": 178.3272673031, "ymax": 335.9013648568, "label": "measure_31", "step_length": 157.5740975537, "img_num": "1", "img_staff_num": "4", "staff_num": 4, "measure_num": "31"}, {"index": 155, "ballet": "raymonda", "ymin": 657.7109934368, "ymax": 819.4697568616, "label": "measure_28", "step_length": 161.7587634248, "img_num": "1", "img_staff_num": "4", "staff_num": 4, "measure_num": "28"}, {"index": 156, "ballet": "raymonda", "ymin": 824.0514618138, "ymax": 971.8823463604, "label": "measure_27", "step_length": 147.8308845465, "img_num": "1", "img_staff_num": "4", "staff_num": 4, "measure_num": "27"}, {"index": 157, "ballet": "raymonda", "ymin": 18.049522673, "ymax": 175.8883129475, "label": "measure_32", "step_length": 157.8387902745, "img_num": "1", "img_staff_num": "4", "staff_num": 4, "measure_num": "32"}, {"index": 158, "ballet": "raymonda", "ymin": 500.4835173031, "ymax": 655.2846434964, "label": "measure_29", "step_length": 154.8011261933, "img_num": "1", "img_staff_num": "4", "staff_num": 4, "measure_num": "29"}, {"index": 159, "ballet": "raymonda", "ymin": 339.077677506, "ymax": 499.8974119928, "label": "measure_30", "step_length": 160.8197344869, "img_num": "1", "img_staff_num": "4", "staff_num": 4, "measure_num": "30"}, {"index": 160, "ballet": "raymonda", "ymin": 969.9475686158, "ymax": 1128.6308547136, "label": "measure_26", "step_length": 158.6832860979, "img_num": "1", "img_staff_num": "4", "staff_num": 4, "measure_num": "26"}, {"index": 223, "ballet": "raymonda", "ymin": 44.1173180191, "ymax": 211.8032331444, "label": "measure_41", "step_length": 167.6859151253, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "41"}, {"index": 224, "ballet": "raymonda", "ymin": 528.2848299523, "ymax": 688.1031566975, "label": "measure_38", "step_length": 159.8183267452, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "38"}, {"index": 225, "ballet": "raymonda", "ymin": 928.56927767, "ymax": 1085.7673031026, "label": "measure_35", "step_length": 157.1980254326, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "35"}, {"index": 226, "ballet": "raymonda", "ymin": 682.7890252088, "ymax": 774.2789845615, "label": "measure_37", "step_length": 91.4899593526, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "37"}, {"index": 227, "ballet": "raymonda", "ymin": 776.57174821, "ymax": 927.0519093079, "label": "measure_36", "step_length": 150.4801610979, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "36"}, {"index": 228, "ballet": "raymonda", "ymin": 212.5719439887, "ymax": 366.1670551163, "label": "measure_40", "step_length": 153.5951111277, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "40"}, {"index": 229, "ballet": "raymonda", "ymin": 1246.5214517452, "ymax": 1405.4975387828, "label": "measure_33", "step_length": 158.9760870376, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "33"}, {"index": 230, "ballet": "raymonda", "ymin": 1088.7151420794, "ymax": 1245.8262697643, "label": "measure_34", "step_length": 157.111127685, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "34"}, {"index": 231, "ballet": "raymonda", "ymin": 368.5801387232, "ymax": 523.5722982548, "label": "measure_39", "step_length": 154.9921595316, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "39"}, {"index": 311, "ballet": "raymonda", "ymin": 31.0698836516, "ymax": 191.5035799523, "label": "measure_49", "step_length": 160.4336963007, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "49"}, {"index": 312, "ballet": "raymonda", "ymin": 513.8924522673, "ymax": 671.6255220764, "label": "measure_46", "step_length": 157.7330698091, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "46"}, {"index": 313, "ballet": "raymonda", "ymin": 673.8887231504, "ymax": 823.7544749403, "label": "measure_45", "step_length": 149.86575179, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "45"}, {"index": 314, "ballet": "raymonda", "ymin": 987.6241795943, "ymax": 1149.4906026253, "label": "measure_43", "step_length": 161.866423031, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "43"}, {"index": 315, "ballet": "raymonda", "ymin": 1153.4147523866, "ymax": 1316.1433472554, "label": "measure_42", "step_length": 162.7285948687, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "42"}, {"index": 316, "ballet": "raymonda", "ymin": 190.8949880668, "ymax": 346.6501342482, "label": "measure_48", "step_length": 155.7551461814, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "48"}, {"index": 317, "ballet": "raymonda", "ymin": 350.2509695704, "ymax": 513.9495077566, "label": "measure_47", "step_length": 163.6985381862, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "47"}, {"index": 318, "ballet": "raymonda", "ymin": 827.4123657518, "ymax": 991.2186754177, "label": "measure_44", "step_length": 163.8063096659, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "44"}, {"index": 359, "ballet": "raymonda", "ymin": 174.0099287739, "ymax": 335.3244238514, "label": "measure_53", "step_length": 161.3144950776, "img_num": "2", "img_staff_num": "3", "staff_num": 7, "measure_num": "53"}, {"index": 360, "ballet": "raymonda", "ymin": 17.2464480161, "ymax": 173.716009099, "label": "measure_54", "step_length": 156.4695610829, "img_num": "2", "img_staff_num": "3", "staff_num": 7, "measure_num": "54"}, {"index": 361, "ballet": "raymonda", "ymin": 335.5993809666, "ymax": 493.6396740752, "label": "measure_52", "step_length": 158.0402931086, "img_num": "2", "img_staff_num": "3", "staff_num": 7, "measure_num": "52"}, {"index": 362, "ballet": "raymonda", "ymin": 496.6262772226, "ymax": 655.6052170346, "label": "measure_51", "step_length": 158.9789398121, "img_num": "2", "img_staff_num": "3", "staff_num": 7, "measure_num": "51"}]
var raymonda_radArr = [];
var raymonda_dataArr = [];
var raymonda_data = [];
var raymonda_dataStyling = [];
var radialWrapperraymonda;
var circleWrapperraymonda; 
var raymondaButton = document.getElementById("raymonda-play-button");
var raymondaAudio = document.getElementById("raymonda-audio");


d3.json(datapath+'raymonda'+".json", function(raymonda_data) {
	raymonda_dataset = raymonda_data;

	//SVG container
	raymonda_svg = d3.select("#raymonda-choreo-radial")
		.append("svg")
		// .attr("width", 200)
		// .attr("height", 200)
		.attr("viewBox", `0 0 400 400`)
		.append("g")
		.attr("transform", "translate(" + 200 + "," + 200 + ")");
		// .attr("transform", "translate(" + 150 + "," + 100 + ")");

	//Container for the gradients
	raymonda_defs = raymonda_svg.append("defs");

	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Create scales ////////////////////////////////
	///////////////////////////////////////////////////////////////////////////

	// Playback time
	// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
	raymonda_dataset.forEach(function(d, i) {
		measNum = +d.measure_num
		meas_ymin = raymonda_measures.filter(x=>+x.measure_num==measNum)[0].ymax
		step_ymin = +d.ymax
		d.playbackTime = (measNum + (step_ymin)/50) * 4
		d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
		d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
		tmp = raymonda_dataset.slice(0,i).map(x=>x.thetaRad)
		if (tmp.length > 0){
			tmp = tmp.reduce((a, b) => a + b) / tmp.length;
			d.weightDist = tmp
		}else {
			d.weightDist = 0
		}
	});
	
	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Radial line //////////////////////////////////
	///////////////////////////////////////////////////////////////////////////
	raymonda_dataset = raymonda_dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
	
	raymonda_radArr = raymonda_dataset.map(x=>(x.playbackTime)*radiusOutwardMult_raymonda)
	// Nonzero radii
	raymonda_radArr = raymonda_radArr.filter(x=>x>0)
	
	function findClosest(num, spoke){
		if (Math.abs(num[0] - spoke) <= 0.03) return 1
	}
	for (ii = 0; ii < raymonda_radArr.length; ii++) {
		if(raymonda_dataset[ii].body_movement!=null){
			raymonda_data = []
			for (i = 0; i <= 2+lineRes; i=i+lineRes) {
			if (randJitter) {raymonda_data.push([Math.PI * i, raymonda_radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
			if (!randJitter) {raymonda_data.push([Math.PI * i, raymonda_radArr[ii] ])}
			}
			raymonda_dataStyling.push({'body_movement' : raymonda_dataset[ii].body_movement,
							'step_length' : raymonda_dataset[ii].step_length * stepLengthMultipier,
							'playback_time': raymonda_dataset[ii].playbackTime,
							'weight_dist': raymonda_dataset[ii].weightDist})
			arr = spokeArrRad
			num = degrees_to_radians(raymonda_dataset[ii].theta)
			var closestSpoke = arr.reduce(function(prev, curr) {
				return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
			});
			
			// find theta closest to chosen spokeArr
			if (raymonda_dataset[ii].direction_movement!='place'){
				index = raymonda_data.findIndex(x => findClosest(x, closestSpoke));
				raymonda_data[index] = [raymonda_data[index][0], raymonda_radArr[ii]+raymonda_dataset[ii].step_length * radiusMult]
				raymonda_dataArr.push({raymonda_data})
			}
		}
	}
	
	raymonda_dataset.forEach(function(d, i) {
		d.slider_time = i;
	})

	radialWrapperraymonda = raymonda_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");
	circleWrapperraymonda = raymonda_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");

	for (i = 0; i < raymonda_dataArr.length; i++) {
		className = "raymonda"
		curRadialLineWidth = raymonda_dataStyling[i].step_length
		curPlaybackTime = raymonda_dataStyling[i].playback_time
		radialWrapperraymonda
			.append("path")
			.attr("d", lineRadial(raymonda_dataArr[i].raymonda_data))
			.attr("class", className)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", "black")
			.style("filter", "url(#glow)")
			.attr("opacity", 0.7)
		circleWrapperraymonda
			.append("circle")
				.attr("opacity", 0.5)
				.attr("class", className)
				.attr("cy", raymonda_dataArr[i].raymonda_data[0][1]*Math.sin(raymonda_dataStyling[i].weight_dist))
				.attr("cx", raymonda_dataArr[i].raymonda_data[0][1]*Math.cos(raymonda_dataStyling[i].weight_dist))
				.attr("r", weightCircleSize)
				.style("filter", "url(#glow)")
				.style('fill', weightCircleColor)
	}

	function update(timePoint) {
		if(timePoint == 1){
			d3.selectAll('.raymonda')
				.remove()
		}
		// for (i = 0; i < artifact_dataArr.length; i++) {
		className = "raymonda"
		curRadialLineWidth = raymonda_dataStyling[timePoint].step_length
		curPlaybackTime = raymonda_dataStyling[timePoint].playback_time
		radialWrapperraymonda
			.append("path")
			.attr("d", lineRadial(raymonda_dataArr[timePoint].raymonda_data))
			.attr("class", className)
			.attr("opacity", 0)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", animateColor)
			.style("filter", "url(#glow)")
			.transition()
			// .delay( (curPlaybackTime-14)*900)
			.delay( (curPlaybackTime-25))
			.attr("opacity", 0.7)
			// .transition()
			// 	.ease(d3.easeLinear)
			// 	.duration(200)
			// 	.attr("stroke", "black")
		circleWrapperraymonda
			.append("circle")
				.attr("opacity", 0)
				.attr("cy", raymonda_dataArr[timePoint].raymonda_data[0][1]*Math.sin(raymonda_dataStyling[timePoint].weight_dist))
				.attr("cx", raymonda_dataArr[timePoint].raymonda_data[0][1]*Math.cos(raymonda_dataStyling[timePoint].weight_dist))
				.attr("r", weightCircleSize)
				.attr("class", className)
				.style('fill', weightCircleColor)
				.transition()
				// .delay( (curPlaybackTime-14)*900)
				.delay( (curPlaybackTime-25))
					.attr("opacity", 0.5)
	// }
	};

	//Run the update function when the slider is changed
	d3.select('#raymonda-slider').on('input', function() {
		update(this.value);
	});

	var myTimer;
	var t = 0;
	d3.select("#raymonda-play-button").on("click", function() {
		$("#raymonda-play-button").addClass('button-enabled')
		$("#raymonda-pause-button").removeClass('button-enabled')
		raymondaAudio.play();
		clearInterval (myTimer);
		myTimer = setInterval (function() {
			var b = d3.select("#raymonda-slider");
			t = (+b.property("value") + 1) % (+b.property("max") + 1);
			curPlaybackTime = (raymonda_dataset.filter(x=>x.slider_time==t)[0].playbackTime)*2000
			if (t == 0) { t = +b.property("min"); }
			if (t >= 211){
				$("#raymonda-pause-button").addClass('button-enabled')
				$("#raymonda-play-button").removeClass('button-enabled')
				clearInterval (myTimer);
				return
			}
			b.property("value", t);
			update (t);
		// }, 300);
		}, 720);
	});

	d3.select("#raymonda-pause-button").on("click", function() {
		$("#raymonda-pause-button").addClass('button-enabled')
		$("#raymonda-play-button").removeClass('button-enabled')
		raymondaAudio.pause();
		clearInterval (myTimer);
	});
})


///////////////////////////////////////////////////////////////////////////
////////////////////////// Artifact, Forsythe /////////////////////////////
///////////////////////////////////////////////////////////////////////////
	var artifact_dataset;
	var artifact_svg;
	var artifact_defs;
	var radiusOutwardMult_artifact = 1.4;
	// var radiusOutwardMult_artifact = .8;
	var artifact_measures = [{"index": 0, "ballet": "artifact", "ymin": 838.7689439141, "ymax": 1642.1331947345, "label": "measure_1", "step_length": 803.3642508204, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 1, "ballet": "artifact", "ymin": 33.6271162739, "ymax": 845.6937649165, "label": "measure_2", "step_length": 812.0666486426, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 39, "ballet": "artifact", "ymin": 8.1598672434, "ymax": 809.4435784606, "label": "measure_4", "step_length": 801.2837112172, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "4"}, {"index": 40, "ballet": "artifact", "ymin": 810.2366870525, "ymax": 1625.0795047733, "label": "measure_3", "step_length": 814.8428177208, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "3"}, {"index": 59, "ballet": "artifact", "ymin": 0.0, "ymax": 790.9936977924, "label": "measure_6", "step_length": 790.9936977924, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "6"}, {"index": 60, "ballet": "artifact", "ymin": 797.224138574, "ymax": 1604.0982529087, "label": "measure_5", "step_length": 806.8741143347, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "5"}, {"index": 79, "ballet": "artifact", "ymin": 826.0875400641, "ymax": 1638.8237179487, "label": "measure_7", "step_length": 812.7361778846, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "7"}, {"index": 80, "ballet": "artifact", "ymin": 4.3413461538, "ymax": 822.4697516026, "label": "measure_8", "step_length": 818.1284054487, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "8"}]

	var artifact_radArr = [];
	var artifact_dataArr = [];
	var artifact_data = [];
	var artifact_dataStyling = [];
	var radialWrapperartifact;
	var circleWrapperartifact; 

	var artifactButton = document.getElementById("artifact-play-button");
	var artifactAudio = document.getElementById("artifact-audio");

	d3.json(datapath+'artifact'+".json", function(artifact_data) {
			artifact_dataset = artifact_data;

				//SVG container
				artifact_svg = d3.select("#artifact-choreo-radial")
					.append("svg")
					// .attr("width", 200)
					// .attr("height", 200)
					.attr("viewBox", `0 0 400 400`)
					.append("g")
					.attr("transform", "translate(" + 200 + "," + 200 + ")");
					// .attr("transform", "translate(" + 150 + "," + 100 + ")");



				//Container for the gradients
				artifact_defs = artifact_svg.append("defs");
				//Filter for the outside glow
				var filter = artifact_defs.append("filter")
					.attr("id","glow");
				filter.append("feGaussianBlur")
					.attr("stdDeviation","1.5")
					.attr("result","coloredBlur");
				var feMerge = filter.append("feMerge");
				feMerge.append("feMergeNode")
					.attr("in","coloredBlur");
				feMerge.append("feMergeNode")
					.attr("in","SourceGraphic");

				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Create scales ////////////////////////////////
				///////////////////////////////////////////////////////////////////////////

				// Playback time
				// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
				artifact_dataset.forEach(function(d, i) {
					measNum = +d.measure_num
					meas_ymin = artifact_measures.filter(x=>+x.measure_num==measNum)[0].ymax
					step_ymin = +d.ymax
					d.playbackTime = (measNum + (step_ymin)/100) * 4
					d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
					d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
					tmp = artifact_dataset.slice(0,i).map(x=>x.thetaRad)
					if (tmp.length > 0){
						tmp = tmp.reduce((a, b) => a + b) / tmp.length;
						d.weightDist = tmp
					}else {
						d.weightDist = 0
					}
				});
				
				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Radial line //////////////////////////////////
				///////////////////////////////////////////////////////////////////////////
				artifact_dataset = artifact_dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
				
				artifact_radArr = artifact_dataset.map(x=>(x.playbackTime)*radiusOutwardMult_artifact)
				// Nonzero radii
				artifact_radArr = artifact_radArr.filter(x=>x>0)
				
				function findClosest(num, spoke){
					if (Math.abs(num[0] - spoke) <= 0.03) return 1
				}
				for (ii = 0; ii < artifact_radArr.length; ii++) {
					if(artifact_dataset[ii].body_movement!=null){
						artifact_data = []
						for (i = 0; i <= 2+lineRes; i=i+lineRes) {
						if (randJitter) {artifact_data.push([Math.PI * i, artifact_radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
						if (!randJitter) {artifact_data.push([Math.PI * i, artifact_radArr[ii] ])}
						}
						artifact_dataStyling.push({'body_movement' : artifact_dataset[ii].body_movement,
										'step_length' : artifact_dataset[ii].step_length * stepLengthMultipier,
										'playback_time': artifact_dataset[ii].playbackTime,
										'weight_dist': artifact_dataset[ii].weightDist})
						arr = spokeArrRad
						num = degrees_to_radians(artifact_dataset[ii].theta)
						var closestSpoke = arr.reduce(function(prev, curr) {
							return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
						});
						
						// find theta closest to chosen spokeArr
						if (artifact_dataset[ii].direction_movement!='place'){
							index = artifact_data.findIndex(x => findClosest(x, closestSpoke));
							artifact_data[index] = [artifact_data[index][0], artifact_radArr[ii]+artifact_dataset[ii].step_length * radiusMult]
							artifact_dataArr.push({artifact_data})
						}
					}
				}
				
				artifact_dataset.forEach(function(d, i) {
					d.slider_time = i;
				})

				
				radialWrapperartifact = artifact_svg.append("g")
					.attr("transform", "translate(" + 0 + "," + 0 + ")");
				circleWrapperartifact = artifact_svg.append("g")
					.attr("transform", "translate(" + 0 + "," + 0 + ")");

				for (i = 0; i < artifact_dataArr.length; i++) {
					className = "artifact"
					curRadialLineWidth = artifact_dataStyling[i].step_length
					curPlaybackTime = artifact_dataStyling[i].playback_time
					radialWrapperartifact
						.append("path")
						.attr("d", lineRadial(artifact_dataArr[i].artifact_data))
						.attr("class", className)
						.attr("transform", "rotate(" + ( -55 ) + ")")
						.attr("fill", "none")
						.attr("stroke-width", curRadialLineWidth/2)
						.attr("stroke", "black")
						.style("filter", "url(#glow)")
						.attr("opacity", 0.7)
					circleWrapperartifact
						.append("circle")
							.attr("opacity", 0.5)
							.attr("class", className)
							.attr("cy", artifact_dataArr[i].artifact_data[0][1]*Math.sin(artifact_dataStyling[i].weight_dist))
							.attr("cx", artifact_dataArr[i].artifact_data[0][1]*Math.cos(artifact_dataStyling[i].weight_dist))
							.attr("r", weightCircleSize)
							.style("filter", "url(#glow)")
							.style('fill', weightCircleColor)
				}

				function update(timePoint) {
					if(timePoint == 1){
						d3.selectAll('.artifact')
							.remove()
					}
					// for (i = 0; i < artifact_dataArr.length; i++) {
					className = "artifact"
					curRadialLineWidth = artifact_dataStyling[timePoint].step_length
					curPlaybackTime = artifact_dataStyling[timePoint].playback_time
					radialWrapperartifact
						.append("path")
						.attr("d", lineRadial(artifact_dataArr[timePoint].artifact_data))
						.attr("class", className)
						.attr("opacity", 0)
						.attr("transform", "rotate(" + ( -55 ) + ")")
						.attr("fill", "none")
						.attr("stroke-width", curRadialLineWidth/2)
						.attr("stroke", animateColor)
						.style("filter", "url(#glow)")
						.transition()
						// .delay( (curPlaybackTime-14)*900)
						.delay( (curPlaybackTime-25))
						.attr("opacity", 0.7)
						// .transition()
						// 	.ease(d3.easeLinear)
						// 	.duration(200)
						// 	.attr("stroke", "black")
					circleWrapperartifact
						.append("circle")
							.attr("opacity", 0)
							.attr("cy", artifact_dataArr[timePoint].artifact_data[0][1]*Math.sin(artifact_dataStyling[timePoint].weight_dist))
							.attr("cx", artifact_dataArr[timePoint].artifact_data[0][1]*Math.cos(artifact_dataStyling[timePoint].weight_dist))
							.attr("r", weightCircleSize)
							.attr("class", className)
							.style('fill', weightCircleColor)
							.transition()
							// .delay( (curPlaybackTime-14)*900)
							.delay( (curPlaybackTime-25))
								.attr("opacity", 0.5)
				// }
				};

				//Run the update function when the slider is changed
				d3.select('#artifact-slider').on('input', function() {
					update(this.value);
				});

				var myTimer;
				var t = 0;
				d3.select("#artifact-play-button").on("click", function() {
					$("#artifact-play-button").addClass('button-enabled')
					$("#artifact-pause-button").removeClass('button-enabled')
					artifactAudio.play();
					clearInterval (myTimer);
					myTimer = setInterval (function() {
						var b = d3.select("#artifact-slider");
						t = (+b.property("value") + 1) % (+b.property("max") + 1);
						curPlaybackTime = (artifact_dataset.filter(x=>x.slider_time==t)[0].playbackTime)*2000
						if (t == 0) { t = +b.property("min"); }
						if (t >= 61){
							$("#artifact-pause-button").addClass('button-enabled')
							$("#artifact-play-button").removeClass('button-enabled')
							// artifactAudio.pause();
							clearInterval (myTimer);
							return
						}
						b.property("value", t);
						update (t);
					}, 950);
				});

				d3.select("#artifact-pause-button").on("click", function() {
					$("#artifact-pause-button").addClass('button-enabled')
					$("#artifact-play-button").removeClass('button-enabled')
					artifactAudio.pause();
					clearInterval (myTimer);
				});
			})


///////////////////////////////////////////////////////////////////////////
//////////////////////////// Songs, Anthony ///////////////////////////////
///////////////////////////////////////////////////////////////////////////
	var songs_dataset;
	var songs_svg;
	var songs_defs;
	var radiusOutwardMult_songs = 0.9;
	var songs_measures = [{"index": 0, "ballet": "songs", "ymin": 34.0487954952, "ymax": 638.5292828908, "label": "measure_3", "step_length": 604.4804873956, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "3"}, {"index": 1, "ballet": "songs", "ymin": 1236.1019820257, "ymax": 1351.0379064737, "label": "measure_1", "step_length": 114.9359244481, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 2, "ballet": "songs", "ymin": 639.4572922882, "ymax": 1242.8006414081, "label": "measure_2", "step_length": 603.3433491199, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 21, "ballet": "songs", "ymin": 643.6398418854, "ymax": 1251.5226170943, "label": "measure_4", "step_length": 607.8827752088, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "4"}, {"index": 22, "ballet": "songs", "ymin": 23.0015848747, "ymax": 642.5905802506, "label": "measure_5", "step_length": 619.5889953759, "img_num": "1", "img_staff_num": "2", "staff_num": 2, "measure_num": "5"}, {"index": 61, "ballet": "songs", "ymin": 641.0, "ymax": 1272.6895323687, "label": "measure_6", "step_length": 631.6895323687, "img_num": "2", "img_staff_num": "1", "staff_num": 3, "measure_num": "6"}, {"index": 62, "ballet": "songs", "ymin": 30.8058155579, "ymax": 639.2968656772, "label": "measure_7", "step_length": 608.4910501193, "img_num": "2", "img_staff_num": "1", "staff_num": 3, "measure_num": "7"}, {"index": 111, "ballet": "songs", "ymin": 45.1976051072, "ymax": 665.3705558691, "label": "measure_9", "step_length": 620.1729507619, "img_num": "2", "img_staff_num": "2", "staff_num": 4, "measure_num": "9"}, {"index": 112, "ballet": "songs", "ymin": 662.5951079289, "ymax": 1272.1298321106, "label": "measure_8", "step_length": 609.5347241817, "img_num": "2", "img_staff_num": "2", "staff_num": 4, "measure_num": "8"}, {"index": 151, "ballet": "songs", "ymin": 634.8149689616, "ymax": 1254.9913409989, "label": "measure_10", "step_length": 620.1763720372, "img_num": "3", "img_staff_num": "1", "staff_num": 5, "measure_num": "10"}, {"index": 152, "ballet": "songs", "ymin": 20.0345125564, "ymax": 635.5286223194, "label": "measure_11", "step_length": 615.494109763, "img_num": "3", "img_staff_num": "1", "staff_num": 5, "measure_num": "11"}, {"index": 189, "ballet": "songs", "ymin": 440.0932562077, "ymax": 833.080549873, "label": "measure_13", "step_length": 392.9872936653, "img_num": "3", "img_staff_num": "2", "staff_num": 6, "measure_num": "13"}, {"index": 190, "ballet": "songs", "ymin": 14.2452207957, "ymax": 436.316027088, "label": "measure_14", "step_length": 422.0708062923, "img_num": "3", "img_staff_num": "2", "staff_num": 6, "measure_num": "14"}, {"index": 191, "ballet": "songs", "ymin": 832.3723194131, "ymax": 1246.4395457111, "label": "measure_12", "step_length": 414.067226298, "img_num": "3", "img_staff_num": "2", "staff_num": 6, "measure_num": "12"}, {"index": 254, "ballet": "songs", "ymin": 661.3766489137, "ymax": 958.0045146727, "label": "measure_16", "step_length": 296.627865759, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "16"}, {"index": 255, "ballet": "songs", "ymin": 960.9796839729, "ymax": 1268.9097065463, "label": "measure_15", "step_length": 307.9300225734, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "15"}, {"index": 256, "ballet": "songs", "ymin": 358.9843926354, "ymax": 658.5002645316, "label": "measure_17", "step_length": 299.5158718962, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "17"}, {"index": 257, "ballet": "songs", "ymin": 45.7722823787, "ymax": 353.7313593397, "label": "measure_18", "step_length": 307.9590769611, "img_num": "4", "img_staff_num": "1", "staff_num": 7, "measure_num": "18"}]
	var songs_radArr = [];
	var songs_dataArr = [];
	var songs_data = [];
	var songs_dataStyling = [];
	var radialWrappersongs;
	var circleWrappersongs; 
	var songsButton = document.getElementById("songs-play-button");
	var songsAudio = document.getElementById("songs-audio");

	d3.json(datapath+'songs'+".json", function(songs_data) {
			songs_dataset = songs_data;

				//SVG container
				songs_svg = d3.select("#songs-choreo-radial")
					.append("svg")
					// .attr("width", 200)
					// .attr("height", 200)
					.attr("viewBox", `0 0 400 400`)
					.append("g")
					.attr("transform", "translate(" + 200 + "," + 200 + ")");
					// .attr("transform", "translate(" + 150 + "," + 100 + ")");



				//Container for the gradients
				songs_defs = songs_svg.append("defs");
				//Filter for the outside glow
				var filter = songs_defs.append("filter")
					.attr("id","glow");
				filter.append("feGaussianBlur")
					.attr("stdDeviation","1.5")
					.attr("result","coloredBlur");
				var feMerge = filter.append("feMerge");
				feMerge.append("feMergeNode")
					.attr("in","coloredBlur");
				feMerge.append("feMergeNode")
					.attr("in","SourceGraphic");

				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Create scales ////////////////////////////////
				///////////////////////////////////////////////////////////////////////////

				// Playback time
				// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
				songs_dataset.forEach(function(d, i) {
					measNum = +d.measure_num
					meas_ymin = songs_measures.filter(x=>+x.measure_num==measNum)[0].ymax
					step_ymin = +d.ymax
					d.playbackTime = (measNum + (step_ymin)/50) * 4
					d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
					d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
					tmp = songs_dataset.slice(0,i).map(x=>x.thetaRad)
					if (tmp.length > 0){
						tmp = tmp.reduce((a, b) => a + b) / tmp.length;
						d.weightDist = tmp
					}else {
						d.weightDist = 0
					}
				});
				
				///////////////////////////////////////////////////////////////////////////
				//////////////////////////// Radial line //////////////////////////////////
				///////////////////////////////////////////////////////////////////////////
				songs_dataset = songs_dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
				
				songs_radArr = songs_dataset.map(x=>(x.playbackTime)*radiusOutwardMult_songs)
				// Nonzero radii
				songs_radArr = songs_radArr.filter(x=>x>0)
				
				function findClosest(num, spoke){
					if (Math.abs(num[0] - spoke) <= 0.03) return 1
				}
				for (ii = 0; ii < songs_radArr.length; ii++) {
					if(songs_dataset[ii].body_movement!=null){
						songs_data = []
						for (i = 0; i <= 2+lineRes; i=i+lineRes) {
						if (randJitter) {songs_data.push([Math.PI * i, songs_radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
						if (!randJitter) {songs_data.push([Math.PI * i, songs_radArr[ii] ])}
						}
						songs_dataStyling.push({'body_movement' : songs_dataset[ii].body_movement,
										'step_length' : songs_dataset[ii].step_length * stepLengthMultipier,
										'playback_time': songs_dataset[ii].playbackTime,
										'weight_dist': songs_dataset[ii].weightDist})
						arr = spokeArrRad
						num = degrees_to_radians(songs_dataset[ii].theta)
						var closestSpoke = arr.reduce(function(prev, curr) {
							return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
						});
						
						// find theta closest to chosen spokeArr
						if (songs_dataset[ii].direction_movement!='place'){
							index = songs_data.findIndex(x => findClosest(x, closestSpoke));
							songs_data[index] = [songs_data[index][0], songs_radArr[ii]+songs_dataset[ii].step_length * radiusMult]
							songs_dataArr.push({songs_data})
						}
					}
				}
				
				songs_dataset.forEach(function(d, i) {
					d.slider_time = i;
				})

				radialWrappersongs = songs_svg.append("g")
					.attr("transform", "translate(" + 0 + "," + 0 + ")");
				circleWrappersongs = songs_svg.append("g")
					.attr("transform", "translate(" + 0 + "," + 0 + ")");

				for (i = 0; i < songs_dataArr.length; i++) {
					className = "songs"
					curRadialLineWidth = songs_dataStyling[i].step_length
					curPlaybackTime = songs_dataStyling[i].playback_time
					radialWrappersongs
						.append("path")
						.attr("d", lineRadial(songs_dataArr[i].songs_data))
						.attr("class", className)
						.attr("transform", "rotate(" + ( -55 ) + ")")
						.attr("fill", "none")
						.attr("stroke-width", curRadialLineWidth/2)
						.attr("stroke", "black")
						.style("filter", "url(#glow)")
						.attr("opacity", 0.7)
					circleWrappersongs
						.append("circle")
							.attr("opacity", 0.5)
							.attr("class", className)
							.attr("cy", songs_dataArr[i].songs_data[0][1]*Math.sin(songs_dataStyling[i].weight_dist))
							.attr("cx", songs_dataArr[i].songs_data[0][1]*Math.cos(songs_dataStyling[i].weight_dist))
							.attr("r", weightCircleSize)
							.style("filter", "url(#glow)")
							.style('fill', weightCircleColor)
				}

				function update(timePoint) {
					if(timePoint == 1){
						d3.selectAll('.songs')
							.remove()
					}
					// for (i = 0; i < artifact_dataArr.length; i++) {
					className = "songs"
					curRadialLineWidth = songs_dataStyling[timePoint].step_length
					curPlaybackTime = songs_dataStyling[timePoint].playback_time
					radialWrappersongs
						.append("path")
						.attr("d", lineRadial(songs_dataArr[timePoint].songs_data))
						.attr("class", className)
						.attr("opacity", 0)
						.attr("transform", "rotate(" + ( -55 ) + ")")
						.attr("fill", "none")
						.attr("stroke-width", curRadialLineWidth/2)
						.attr("stroke", animateColor)
						.style("filter", "url(#glow)")
						.transition()
						// .delay( (curPlaybackTime-14)*900)
						.delay( (curPlaybackTime-25))
						.attr("opacity", 0.7)
						// .transition()
						// 	.ease(d3.easeLinear)
						// 	.duration(200)
						// 	.attr("stroke", "black")
					circleWrappersongs
						.append("circle")
							.attr("opacity", 0)
							.attr("cy", songs_dataArr[timePoint].songs_data[0][1]*Math.sin(songs_dataStyling[timePoint].weight_dist))
							.attr("cx", songs_dataArr[timePoint].songs_data[0][1]*Math.cos(songs_dataStyling[timePoint].weight_dist))
							.attr("r", weightCircleSize)
							.attr("class", className)
							.style('fill', weightCircleColor)
							.transition()
							// .delay( (curPlaybackTime-14)*900)
							.delay( (curPlaybackTime-25))
								.attr("opacity", 0.5)
				// }
				};

				//Run the update function when the slider is changed
				d3.select('#songs-slider').on('input', function() {
					update(this.value);
				});

				var myTimer;
				var t = 0;
				d3.select("#songs-play-button").on("click", function() {
					$("#songs-play-button").addClass('button-enabled')
					$("#songs-pause-button").removeClass('button-enabled')
					songsAudio.play();
					clearInterval (myTimer);
					myTimer = setInterval (function() {
						var b = d3.select("#songs-slider");
						t = (+b.property("value") + 1) % (+b.property("max") + 1);
						curPlaybackTime = (songs_dataset.filter(x=>x.slider_time==t)[0].playbackTime)*2000
						if (t == 0) { t = +b.property("min"); }
						if (t >= 174){
							$("#songs-pause-button").addClass('button-enabled')
							$("#songs-play-button").removeClass('button-enabled')
							clearInterval (myTimer);
							return
						}
						b.property("value", t);
						update (t);
					}, 500);
				});

				d3.select("#songs-pause-button").on("click", function() {
					$("#songs-pause-button").addClass('button-enabled')
					$("#songs-play-button").removeClass('button-enabled')
					songsAudio.pause();
					clearInterval (myTimer);
				});
			})

///////////////////////////////////////////////////////////////////////////
/////////////////////////// En Dolor, Winter ///////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
var endolor_dataset;
var endolor_svg;
var endolor_defs;
var radiusOutwardMult_endolor = 0.9;
var endolor_measures = [{"index": 0, "ballet": "endolor", "ymin": 36.6393376129, "ymax": 337.4905826749, "label": "measure_4", "step_length": 300.8512450621, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "4"}, {"index": 1, "ballet": "endolor", "ymin": 635.6952772291, "ymax": 928.7115018341, "label": "measure_2", "step_length": 293.016224605, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "2"}, {"index": 2, "ballet": "endolor", "ymin": 335.9765095937, "ymax": 637.0247072517, "label": "measure_3", "step_length": 301.048197658, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "3"}, {"index": 3, "ballet": "endolor", "ymin": 934.0107576185, "ymax": 1347.2726968115, "label": "measure_1", "step_length": 413.261939193, "img_num": "1", "img_staff_num": "1", "staff_num": 1, "measure_num": "1"}, {"index": 35, "ballet": "endolor", "ymin": 32.4303047404, "ymax": 335.881489842, "label": "measure_8", "step_length": 303.4511851016, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "8"}, {"index": 36, "ballet": "endolor", "ymin": 928.8529909707, "ymax": 1236.2979683973, "label": "measure_5", "step_length": 307.4449774266, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "5"}, {"index": 37, "ballet": "endolor", "ymin": 333.7957110609, "ymax": 632.085778781, "label": "measure_7", "step_length": 298.2900677201, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "7"}, {"index": 38, "ballet": "endolor", "ymin": 634.4856094808, "ymax": 929.6173814898, "label": "measure_6", "step_length": 295.131772009, "img_num": "2", "img_staff_num": "1", "staff_num": 5, "measure_num": "6"}, {"index": 85, "ballet": "endolor", "ymin": 252.4544123871, "ymax": 550.50560807, "label": "measure_11", "step_length": 298.0511956828, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "11"}, {"index": 86, "ballet": "endolor", "ymin": 549.1168171558, "ymax": 845.3348088318, "label": "measure_10", "step_length": 296.2179916761, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "10"}, {"index": 87, "ballet": "endolor", "ymin": 48.1299379233, "ymax": 251.4267071106, "label": "measure_12", "step_length": 203.2967691874, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "12"}, {"index": 88, "ballet": "endolor", "ymin": 846.1458627257, "ymax": 1148.9078371896, "label": "measure_9", "step_length": 302.7619744639, "img_num": "2", "img_staff_num": "2", "staff_num": 6, "measure_num": "9"}, {"index": 113, "ballet": "endolor", "ymin": 742.7405033155, "ymax": 939.7297545147, "label": "measure_14", "step_length": 196.9892511992, "img_num": "3", "img_staff_num": "1", "staff_num": 9, "measure_num": "14"}, {"index": 114, "ballet": "endolor", "ymin": 937.3291214024, "ymax": 1142.9650465576, "label": "measure_13", "step_length": 205.6359251552, "img_num": "3", "img_staff_num": "1", "staff_num": 9, "measure_num": "13"}, {"index": 115, "ballet": "endolor", "ymin": 149.5534001129, "ymax": 446.2156197094, "label": "measure_16", "step_length": 296.6622195965, "img_num": "3", "img_staff_num": "1", "staff_num": 9, "measure_num": "16"}, {"index": 116, "ballet": "endolor", "ymin": 444.9905826749, "ymax": 739.8949015942, "label": "measure_15", "step_length": 294.9043189193, "img_num": "3", "img_staff_num": "1", "staff_num": 9, "measure_num": "15"}, {"index": 138, "ballet": "endolor", "ymin": 328.9226156885, "ymax": 629.2440480389, "label": "measure_19", "step_length": 300.3214323505, "img_num": "3", "img_staff_num": "2", "staff_num": 10, "measure_num": "19"}, {"index": 139, "ballet": "endolor", "ymin": 924.9057033014, "ymax": 1226.3740653217, "label": "measure_17", "step_length": 301.4683620203, "img_num": "3", "img_staff_num": "2", "staff_num": 10, "measure_num": "17"}, {"index": 140, "ballet": "endolor", "ymin": 626.0734780615, "ymax": 925.5482241112, "label": "measure_18", "step_length": 299.4747460497, "img_num": "3", "img_staff_num": "2", "staff_num": 10, "measure_num": "18"}, {"index": 141, "ballet": "endolor", "ymin": 24.7520633465, "ymax": 331.8349763685, "label": "measure_20", "step_length": 307.082913022, "img_num": "3", "img_staff_num": "2", "staff_num": 10, "measure_num": "20"}]
var endolor_radArr = [];
var endolor_dataArr = [];
var endolor_data = [];
var endolor_dataStyling = [];
var radialWrapperendolor;
var circleWrapperendolor; 
var endolorButton = document.getElementById("endolor-play-button");
var endolorAudio = document.getElementById("endolor-audio");

d3.json(datapath+'endolor'+".json", function(endolor_data) {
	endolor_dataset = endolor_data;

	//SVG container
	endolor_svg = d3.select("#endolor-choreo-radial")
		.append("svg")
		// .attr("width", 200)
		// .attr("height", 200)
		.attr("viewBox", `0 0 400 400`)
		.append("g")
		.attr("transform", "translate(" + 200 + "," + 200 + ")");
		// .attr("transform", "translate(" + 150 + "," + 100 + ")");



	//Container for the gradients
	endolor_defs = endolor_svg.append("defs");

	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Create scales ////////////////////////////////
	///////////////////////////////////////////////////////////////////////////

	// Playback time
	// get the ymin of the same measure, subtract it from the step ymin, then add difference to measure num
	endolor_dataset.forEach(function(d, i) {
		measNum = +d.measure_num
		meas_ymin = endolor_measures.filter(x=>+x.measure_num==measNum)[0].ymax
		step_ymin = +d.ymax
		d.playbackTime = (measNum + (step_ymin)/50) * 4
		d.theta = bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50
		d.thetaRad = degrees_to_radians( bodyDirectionToTheta(d.body_movement, d.direction_movement) + 50 )
		tmp = endolor_dataset.slice(0,i).map(x=>x.thetaRad)
		if (tmp.length > 0){
			tmp = tmp.reduce((a, b) => a + b) / tmp.length;
			d.weightDist = tmp
		}else {
			d.weightDist = 0
		}
	});
	
	///////////////////////////////////////////////////////////////////////////
	//////////////////////////// Radial line //////////////////////////////////
	///////////////////////////////////////////////////////////////////////////
	endolor_dataset = endolor_dataset.sort(({playbackTime:a}, {playbackTime:b}) => a-b);
	
	endolor_radArr = endolor_dataset.map(x=>(x.playbackTime)*radiusOutwardMult_endolor)
	// Nonzero radii
	endolor_radArr = endolor_radArr.filter(x=>x>0)
	
	function findClosest(num, spoke){
		if (Math.abs(num[0] - spoke) <= 0.03) return 1
	}
	for (ii = 0; ii < endolor_radArr.length; ii++) {
		if(endolor_dataset[ii].body_movement!=null){
			endolor_data = []
			for (i = 0; i <= 2+lineRes; i=i+lineRes) {
			if (randJitter) {endolor_data.push([Math.PI * i, endolor_radArr[ii] + getRandomNumber(-3.5, 3.5) ])}
			if (!randJitter) {endolor_data.push([Math.PI * i, endolor_radArr[ii] ])}
			}
			endolor_dataStyling.push({'body_movement' : endolor_dataset[ii].body_movement,
							'step_length' : endolor_dataset[ii].step_length * stepLengthMultipier,
							'playback_time': endolor_dataset[ii].playbackTime,
							'weight_dist': endolor_dataset[ii].weightDist})
			arr = spokeArrRad
			num = degrees_to_radians(endolor_dataset[ii].theta)
			var closestSpoke = arr.reduce(function(prev, curr) {
				return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);
			});
			
			// find theta closest to chosen spokeArr
			if (endolor_dataset[ii].direction_movement!='place'){
				index = endolor_data.findIndex(x => findClosest(x, closestSpoke));
				endolor_data[index] = [endolor_data[index][0], endolor_radArr[ii]+endolor_dataset[ii].step_length * radiusMult]
				endolor_dataArr.push({endolor_data})
			}
		}
	}
	
	endolor_dataset.forEach(function(d, i) {
		d.slider_time = i;
	})

	radialWrapperendolor = endolor_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");
	circleWrapperendolor = endolor_svg.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");

	for (i = 0; i < endolor_dataArr.length; i++) {
		className = "endolor"
		curRadialLineWidth = endolor_dataStyling[i].step_length
		curPlaybackTime = endolor_dataStyling[i].playback_time
		radialWrapperendolor
			.append("path")
			.attr("d", lineRadial(endolor_dataArr[i].endolor_data))
			.attr("class", className)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", "black")
			.style("filter", "url(#glow)")
			.attr("opacity", 0.7)
		circleWrapperendolor
			.append("circle")
				.attr("opacity", 0.5)
				.attr("class", className)
				.attr("cy", endolor_dataArr[i].endolor_data[0][1]*Math.sin(endolor_dataStyling[i].weight_dist))
				.attr("cx", endolor_dataArr[i].endolor_data[0][1]*Math.cos(endolor_dataStyling[i].weight_dist))
				.attr("r", weightCircleSize)
				.style("filter", "url(#glow)")
				.style('fill', weightCircleColor)
	}

	function update(timePoint) {
		if(timePoint == 1){
			d3.selectAll('.endolor')
				.remove()
		}
		// for (i = 0; i < artifact_dataArr.length; i++) {
		className = "endolor"
		curRadialLineWidth = endolor_dataStyling[timePoint].step_length
		curPlaybackTime = endolor_dataStyling[timePoint].playback_time
		radialWrapperendolor
			.append("path")
			.attr("d", lineRadial(endolor_dataArr[timePoint].endolor_data))
			.attr("class", className)
			.attr("opacity", 0)
			.attr("transform", "rotate(" + ( -55 ) + ")")
			.attr("fill", "none")
			.attr("stroke-width", curRadialLineWidth/2)
			.attr("stroke", animateColor)
			.style("filter", "url(#glow)")
			.transition()
			// .delay( (curPlaybackTime-14)*900)
			.delay( (curPlaybackTime-25))
			.attr("opacity", 0.7)
			// .transition()
			// 	.ease(d3.easeLinear)
			// 	.duration(200)
			// 	.attr("stroke", "black")
		circleWrapperendolor
			.append("circle")
				.attr("opacity", 0)
				.attr("cy", endolor_dataArr[timePoint].endolor_data[0][1]*Math.sin(endolor_dataStyling[timePoint].weight_dist))
				.attr("cx", endolor_dataArr[timePoint].endolor_data[0][1]*Math.cos(endolor_dataStyling[timePoint].weight_dist))
				.attr("r", weightCircleSize)
				.attr("class", className)
				.style('fill', weightCircleColor)
				.transition()
				// .delay( (curPlaybackTime-14)*900)
				.delay( (curPlaybackTime-25))
					.attr("opacity", 0.5)
	// }
	};

	//Run the update function when the slider is changed
	d3.select('#endolor-slider').on('input', function() {
		update(this.value);
	});

	var myTimer;
	var t = 0;
	d3.select("#endolor-play-button").on("click", function() {
		$("#endolor-play-button").addClass('button-enabled')
		$("#endolor-pause-button").removeClass('button-enabled')
		endolorAudio.play();
		clearInterval (myTimer);
		myTimer = setInterval (function() {
			var b = d3.select("#endolor-slider");
			t = (+b.property("value") + 1) % (+b.property("max") + 1);
			curPlaybackTime = (endolor_dataset.filter(x=>x.slider_time==t)[0].playbackTime)*2000
			if (t == 0) { t = +b.property("min"); }
			if (t >= 80){
				$("#endolor-pause-button").addClass('button-enabled')
				$("#endolor-play-button").removeClass('button-enabled')
				clearInterval (myTimer);
				return
			}
			b.property("value", t);
			update (t);
		}, 700);
	});

	d3.select("#endolor-pause-button").on("click", function() {
		$("#endolor-pause-button").addClass('button-enabled')
		$("#endolor-play-button").removeClass('button-enabled')
		endolorAudio.pause();
		clearInterval (myTimer);
	});
})
	

</script>
</html>
